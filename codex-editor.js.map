{"version":3,"sources":["webpack:///webpack/bootstrap a41e1ed0708db88bb48a","webpack:///./index.js","webpack:///./editor.js","webpack:///./modules/core.js","webpack:///./modules/ui.js","webpack:///./modules/transport.js","webpack:///./modules/renderer.js","webpack:///./modules/saver.js","webpack:///./modules/content.js","webpack:///./modules/toolbar/toolbar.js","webpack:///./modules/toolbar/settings.js","webpack:///./modules/toolbar/inline.js","webpack:///./modules/toolbar/toolbox.js","webpack:///./modules/tools.js","webpack:///./modules/callbacks.js","webpack:///./modules/draw.js","webpack:///./modules/caret.js","webpack:///./modules/notifications.js","webpack:///./modules/parser.js","webpack:///./modules/sanitizer/sanitize.js","webpack:///./modules/sanitizer/config/basic.js","webpack:///./modules/sanitizer/config/relaxed.js","webpack:///./modules/sanitizer/config/restricted.js"],"names":["editor","require","module","exports","codex","init","core","ui","transport","renderer","saver","content","toolbar","tools","callback","draw","caret","notifications","parser","sanitizer","version","settings","textareaId","uploadImagesUrl","initialBlockPlugin","nodes","textarea","wrapper","inlineToolbar","buttons","actions","toolbox","plusButton","showSettingsButton","showTrashButton","blockSettings","pluginSettings","defaultSettings","toolbarButtons","redactor","state","jsonOutput","blocks","inputs","start","userSettings","prepare","then","make","addTools","bindEvents","preparePlugins","makeBlocksFromData","saveInputs","catch","error","log","Promise","resolve","reject","data","document","getElementById","undefined","Error","msg","type","arg","window","console","e","insertAfter","target","element","parentNode","insertBefore","nextSibling","nodeTypes","TAG","TEXT","COMMENT","keys","BACKSPACE","TAB","ENTER","SHIFT","CTRL","ALT","ESC","SPACE","LEFT","UP","DOWN","RIGHT","DELETE","META","isDomNode","el","nodeType","ajax","url","XMLHTTP","XMLHttpRequest","ActiveXObject","success_function","params","obj","async","success","test","encodeURIComponent","withCredentials","beforeSend","call","open","setRequestHeader","onreadystatechange","readyState","status","responseText","send","importScript","scriptPath","instanceName","script","createElement","src","defer","id","head","appendChild","className","BLOCK_CLASSNAME","BLOCK_CONTENT","BLOCK_STRETCHED","BLOCK_HIGHLIGHTED","BLOCK_IN_FEED_MODE","SETTINGS_ITEM","toolbarContent","ceBlock","blockButtons","alertsHolder","body","settingsButton","makeRemoveBlockButton","pluginsSettings","makeInlineToolbar","addDefaultSettings","container","inlineToolbarButtons","inlineToolbarActions","tool","tool_button","name","displayInToolbox","iconClassname","toolbarButton","addInlineToolbarTools","bold","icon","command","italic","underline","link","toolButton","toolbarButtonInline","setInlineToolbarButtonBehaviour","addEventListener","errorMsg","lineNumber","errorThrown","event","globalKeydown","globalKeyup","redactorClicked","plusButtonClicked","showSettingsButtonClicked","redactorInputEvent","button","toolbarButtonClicked","addBlockHandlers","block","blockKeydown","blockPaste","inline","show","elements","querySelectorAll","addInitialBlock","initialBlockType","initialBlock","render","setAttribute","insertBlock","workingNodeChanged","toolClicked","input","arguments","fileSelected","clearInput","files","filesLength","length","formdData","FormData","file","i","append","selectAndUpload","args","click","xhr","onload","items","appendBlocks","nodeSequence","index","appendNodeAtIndex","getNodeAsync","createBlockFromData","blockData","blocksList","pluginName","cover","stretched","isStretched","saveBlocks","html","innerHTML","childNodes","makeQueue","queue","getBlockData","makeFormDataFromBlocks","dataset","save","blockContent","pluginsContent","savedData","output","classList","contains","push","currentNode","sync","getNodeFocused","selection","getSelection","focused","anchorNode","focusNode","parentElement","isFirstLevelBlock","parent","markBlock","add","clearMark","remove","getFirstLevelBlock","node","targetNode","replaceBlock","function_name","targetBlock","newBlock","replaceChild","needPlaceCaret","workingBlock","newBlockContent","blockType","composeNewBlock","currentInputIndex","getCurrentInputIndex","editableElement","querySelector","emptyText","createTextNode","set","move","showPlusButton","setTimeout","setToNextBlock","switchBlock","blockToReplace","newBlockComposed","getDeepestTextNodeFromPosition","position","blockChilds","text","textContent","trim","removeChild","looking_from_start","getRange","getRangeAt","splitBlock","inputIndex","anchorNodeText","caretOffset","anchorOffset","textBeforeCaret","textNodeBeforeCaret","textAfterCaret","textNodeAfterCaret","currentBlock","substring","previousChilds","nextChilds","reachedCurrent","child","previousChildsLength","nextChildsLength","newNode","NEW_BLOCK_TYPE","mergeBlocks","targetInputIndex","targetInput","currentInputContent","paste","mutation","workingNode","allowedToPaste","sanitize","addedNodes","pasteTextContent","textNode","Config","BASIC","clearHTML","clean_node","setToPreviousBlock","defaultToolbarHeight","defaultOffset","opened","current","close","toggle","hidePlusButton","toolbarHeight","clientHeight","newYCoordinate","offsetTop","style","transform","Math","floor","hideRemoveActions","setting","toolType","feedModeToggler","makeFeedModeToggler","isFeedModeActivated","updateFeedMode","removeBlockWrapper","settingButton","actionWrapper","confirmAction","cancelAction","removeButtonClicked","confirmRemovingRequest","cancelRemovingRequest","action","showRemoveActions","firstLevelBlocksCount","buttonsOpened","actionsOpened","wrappersOffset","storedSelection","selectedText","getSelectionText","showButtons","getWrappersOffset","coords","getSelectionCoords","newCoordinateX","newCoordinateY","offsetHeight","x","left","y","scrollY","top","closeButtons","closeAction","createLinkAction","defaultToolAction","forEach","hightlight","offset","getOffset","_x","_y","isNaN","offsetLeft","clientLeft","clientTop","offsetParent","sel","range","createRange","collapse","boundingLeft","boundingTop","rangeCount","cloneRange","getClientRects","rect","toString","showActions","isActive","isLinkActive","editable","saveSelection","restoreSelection","inputForLink","focus","preventDefault","keyCode","setAnchor","value","stopImmediatePropagation","clearRange","dataType","execCommand","containerEl","preSelectionRange","selectNodeContents","setEnd","startContainer","startOffset","end","savedSel","charIndex","setStart","nodeStack","foundStart","stop","nextCharIndex","pop","removeAllRanges","addRange","queryCommandState","setButtonHighlighted","removeButtonsHighLight","tag","tagName","leaf","currentTool","Object","barButtons","nextToolIndex","hiddenToolsAmount","toolToSelect","indexOf","toolIsLastInToolbox","UNREPLACEBLE_TOOLS","appendCallback","setToBlock","callbacks","redactorSyncTimeout","tabKeyPressed","enterKeyPressed","escapeKeyPressed","defaultKeyPressed","arrowKeyPressed","firstLevelBlocksArea","clickedOnFirstLevelBlockArea","enterPressedOnBlock","contentEditable","saveCurrentInputIndex","isEnterPressedOnToolbar","enableLineBreaks","shiftKey","isLastTextNode","currentSelection","currentSelectedNode","caretAtTheEndOfText","atTheEnd","isTextNodeHasParentBetweenContenteditable","indexOfLastInput","firstLevelBlock","inputIsEmpty","currentNodeType","flag","clearTimeout","blockRightOrDownArrowPressed","backspacePressed","blockLeftOrUpArrowPressed","focusedNode","focusedNodeHolder","editableElementIndex","caretInLastChild","lastChild","deepestTextnode","caretInFirstChild","caretAtTheBeginning","firstChild","selectionLength","endOffset","atStart","_blockPaste","observer","MutationObserver","handlePasteEvents","config","attributes","childList","characterData","observe","mutations","currentToolType","bar","placeholder","div","toggler","classname","tool_icon","tool_title","properties","pluginsRender","cEditor","focusedNodeIndex","childs","nodeToSet","nextInput","emptyTextElement","assert","previousInput","lastChildNode","lengthOfLastChildNode","isFirstNode","isOffsetZero","message","notification","getSeparatedTextFromContent","split","insertPastedContent","parsedTextContent","parseTextareaContent","initialContent","getNodesFromString","appendNodesToRedactor","inputString","contentHolder","createBlockByDomNode","nodeList","item","storeBlockType","parentBlock","nodeContent","isPlainTextNode","replace","Sanitize","options","ALL","allow_comments","allowed_elements","protocols","add_attributes","dom","remove_element_contents","remove_all_contents","remove_contents","Array","transformers","REGEX_PROTOCOL","RELATIVE","prototype","fragment","createDocumentFragment","current_element","whitelist_nodes","_array_index","needle","haystack","_merge_arrays_uniq","result","uniq_hash","j","_clean","elem","clone","_clean_element","cloneNode","parent_element","allowed_attributes","attr","attr_name","attr_node","del","attr_ok","_transform_element","nodeName","toLowerCase","whitelist","attrs","attr_whitelist","match","createAttribute","setAttributeNode","normalize","node_name","define","RELAXED","RESTRICTED"],"mappings":"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","file":"codex-editor.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap a41e1ed0708db88bb48a","/**\n *\n */\n\n'use strict';\n\nvar editor = require('./editor');\nmodule.exports = editor;\n\n\n\n// WEBPACK FOOTER //\n// ./index.js","/**\n *\n * Codex Editor\n *\n * @author Codex Team\n * @version 1.0.6\n */\n\nvar codex = (function(codex){\n\n    var init = function() {\n        codex.core          = require('./modules/core');\n        codex.ui            = require('./modules/ui');\n        codex.transport     = require('./modules/transport');\n        codex.renderer      = require('./modules/renderer');\n        codex.saver         = require('./modules/saver');\n        codex.content       = require('./modules/content');\n        codex.toolbar       = require('./modules/toolbar/toolbar');\n        codex.tools         = require('./modules/tools');\n        codex.callback      = require('./modules/callbacks');\n        codex.draw          = require('./modules/draw');\n        codex.caret         = require('./modules/caret');\n        codex.notifications = require('./modules/notifications');\n        codex.parser        = require('./modules/parser');\n        codex.sanitizer     = require('./modules/sanitizer/sanitize');\n    };\n\n    codex.version = VERSION;\n\n    /**\n     * @public\n     *\n     * holds initial settings\n     */\n    codex.settings = {\n        tools     : ['paragraph', 'header', 'picture', 'list', 'quote', 'code', 'twitter', 'instagram', 'smile'],\n        textareaId: 'codex-editor',\n        uploadImagesUrl: '/editor/transport/',\n\n        // Type of block showing on empty editor\n        initialBlockPlugin: \"paragraph\"\n    };\n\n    /**\n     * public\n     *\n     * Static nodes\n     */\n    codex.nodes = {\n        textarea          : null,\n        wrapper           : null,\n        toolbar           : null,\n        inlineToolbar     : {\n            wrapper : null,\n            buttons : null,\n            actions : null\n        },\n        toolbox           : null,\n        notifications     : null,\n        plusButton        : null,\n        showSettingsButton: null,\n        showTrashButton   : null,\n        blockSettings     : null,\n        pluginSettings    : null,\n        defaultSettings   : null,\n        toolbarButtons    : {}, // { type : DomEl, ... }\n        redactor          : null\n    };\n\n    /**\n     * @public\n     *\n     * Output state\n     */\n    codex.state = {\n        jsonOutput: [],\n        blocks    : [],\n        inputs    : []\n    };\n\n    /**\n     * Initialization\n     * @uses Promise cEditor.core.prepare\n     * @param {} userSettings are :\n     *          - tools [],\n     *          - textareaId String\n     *          ...\n     *\n     * Load user defined tools\n     * Tools must contain this important objects :\n     *  @param {String} type - this is a type of plugin. It can be used as plugin name\n     *  @param {String} iconClassname - this a icon in toolbar\n     *  @param {Object} make - what should plugin do, when it is clicked\n     *  @param {Object} appendCallback - callback after clicking\n     *  @param {Element} settings - what settings does it have\n     *  @param {Object} render - plugin get JSON, and should return HTML\n     *  @param {Object} save - plugin gets HTML content, returns JSON\n     *  @param {Boolean} displayInToolbox - will be displayed in toolbox. Default value is TRUE\n     *  @param {Boolean} enableLineBreaks - inserts new block or break lines. Default value is FALSE\n     *\n     * @example\n     *   -  type             : 'header',\n     *   -  iconClassname    : 'ce-icon-header',\n     *   -  make             : headerTool.make,\n     *   -  appendCallback   : headerTool.appendCallback,\n     *   -  settings         : headerTool.makeSettings(),\n     *   -  render           : headerTool.render,\n     *   -  save             : headerTool.save,\n     *   -  displayInToolbox : true,\n     *   -  enableLineBreaks : false\n     */\n    codex.start = function (userSettings) {\n\n        init();\n\n        this.core.prepare(userSettings)\n\n        // If all ok, make UI, bind events and parse initial-content\n            .then(this.ui.make)\n            .then(this.ui.addTools)\n            .then(this.ui.bindEvents)\n            .then(this.ui.preparePlugins)\n            .then(this.transport.prepare)\n            .then(this.renderer.makeBlocksFromData)\n            .then(this.ui.saveInputs)\n            .catch(function (error) {\n                codex.core.log('Initialization failed with error: %o', 'warn', error);\n            });\n\n    };\n\n    return codex;\n\n})({});\n\nmodule.exports = codex;\n\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./editor.js","/**\n * Codex Editor Core\n *\n * @author Codex Team\n * @version 1.0\n */\n\nvar core = (function(core) {\n\n    /**\n     * @public\n     *\n     * Editor preparing method\n     * @return Promise\n     */\n    core.prepare = function (userSettings) {\n\n        return new Promise(function(resolve, reject) {\n\n            if ( userSettings ){\n\n                codex.settings.tools = userSettings.tools || codex.settings.tools;\n\n            }\n\n            if (userSettings.data) {\n                codex.state.blocks = userSettings.data;\n            }\n\n            codex.nodes.textarea = document.getElementById(userSettings.textareaId || codex.settings.textareaId);\n\n            if (typeof codex.nodes.textarea === undefined || codex.nodes.textarea === null) {\n                reject(Error(\"Textarea wasn't found by ID: #\" + userSettings.textareaId));\n            } else {\n                resolve();\n            }\n\n        });\n\n    };\n\n    /**\n     * Logging method\n     * @param type = ['log', 'info', 'warn']\n     */\n    core.log = function (msg, type, arg) {\n\n        type = type || 'log';\n\n        if (!arg) {\n            arg  = msg || 'undefined';\n            msg  = '[codex-editor]:      %o';\n        } else {\n            msg  = '[codex-editor]:      ' + msg;\n        }\n\n        try{\n            if ( 'console' in window && console[ type ] ){\n                if ( arg ) console[ type ]( msg , arg );\n                else console[ type ]( msg );\n            }\n\n        }catch(e){}\n\n    };\n\n    /**\n     * @protected\n     *\n     * Helper for insert one element after another\n     */\n    core.insertAfter = function (target, element) {\n        target.parentNode.insertBefore(element, target.nextSibling);\n    };\n\n    /**\n     * @const\n     *\n     * Readable DOM-node types map\n     */\n    core.nodeTypes = {\n        TAG     : 1,\n        TEXT    : 3,\n        COMMENT : 8\n    };\n\n    /**\n     * @const\n     * Readable keys map\n     */\n    core.keys = { BACKSPACE: 8, TAB: 9, ENTER: 13, SHIFT: 16, CTRL: 17, ALT: 18, ESC: 27, SPACE: 32, LEFT: 37, UP: 38, DOWN: 40, RIGHT: 39, DELETE: 46, META: 91 };\n\n    /**\n     * @protected\n     *\n     * Check object for DOM node\n     */\n    core.isDomNode = function (el) {\n        return el && typeof el === 'object' && el.nodeType && el.nodeType == this.nodeTypes.TAG;\n    };\n\n    /**\n     * Native Ajax\n     */\n    core.ajax = function (data) {\n\n        if (!data || !data.url){\n            return;\n        }\n\n        var XMLHTTP          = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject(\"Microsoft.XMLHTTP\"),\n            success_function = function(){},\n            params = '',\n            obj;\n\n        data.async           = true;\n        data.type            = data.type || 'GET';\n        data.data            = data.data || '';\n        data['content-type'] = data['content-type'] || 'application/json; charset=utf-8';\n        success_function     = data.success || success_function ;\n\n        if (data.type == 'GET' && data.data) {\n\n            data.url = /\\?/.test(data.url) ? data.url + '&' + data.data : data.url + '?' + data.data;\n\n        } else {\n\n            for(obj in data.data) {\n                params += (obj + '=' + encodeURIComponent(data.data[obj]) + '&');\n            }\n        }\n\n        if (data.withCredentials) {\n            XMLHTTP.withCredentials = true;\n        }\n\n        if (data.beforeSend && typeof data.beforeSend == 'function') {\n            data.beforeSend.call();\n        }\n\n        XMLHTTP.open( data.type, data.url, data.async );\n        XMLHTTP.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n        XMLHTTP.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n\n        XMLHTTP.onreadystatechange = function() {\n            if (XMLHTTP.readyState == 4 && XMLHTTP.status == 200) {\n                success_function(XMLHTTP.responseText);\n            }\n        };\n\n        XMLHTTP.send(params);\n    };\n\n    /** Appends script to head of document */\n    core.importScript = function(scriptPath, instanceName) {\n\n        /** Script is already loaded */\n        if ( !instanceName || (instanceName && document.getElementById('ce-script-' + instanceName)) ) {\n            codex.core.log(\"Instance name of script is missed or script is already loaded\", \"warn\");\n            return;\n        }\n\n\n        var script   = document.createElement('SCRIPT');\n        script.type = \"text/javascript\";\n        script.src = scriptPath;\n        script.async = true;\n        script.defer = true;\n\n        if (instanceName) {\n            script.id = \"ce-script-\" + instanceName;\n        }\n\n        document.head.appendChild(script);\n        return script;\n    };\n\n    return core;\n\n})({});\n\nmodule.exports = core;\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./modules/core.js","/**\n * Codex Editor UI module\n *\n * @author Codex Team\n * @version 1.0\n */\n\nvar ui = (function(ui){\n\n    /**\n     * Basic editor classnames\n     */\n    ui.className = {\n\n        /**\n         * @const {string} BLOCK_CLASSNAME - redactor blocks name\n         */\n        BLOCK_CLASSNAME : 'ce-block',\n\n            /**\n             * @const {String} wrapper for plugins content\n             */\n            BLOCK_CONTENT : 'ce-block__content',\n\n            /**\n             * @const {String} BLOCK_STRETCHED - makes block stretched\n             */\n            BLOCK_STRETCHED : 'ce-block--stretched',\n\n            /**\n             * @const {String} BLOCK_HIGHLIGHTED - adds background\n             */\n            BLOCK_HIGHLIGHTED : 'ce-block--focused',\n\n            /**\n             * @const {String} - highlights covered blocks\n             */\n            BLOCK_IN_FEED_MODE : 'ce-block--feed-mode',\n\n            /**\n             * @const {String} - for all default settings\n             */\n            SETTINGS_ITEM : 'ce-settings__item'\n\n    };\n\n    /**\n     * @protected\n     *\n     * Making main interface\n     */\n    ui.make = function () {\n\n        var wrapper,\n            toolbar,\n            toolbarContent,\n            inlineToolbar,\n            redactor,\n            ceBlock,\n            notifications,\n            blockButtons,\n            blockSettings,\n            showSettingsButton,\n            showTrashButton,\n            toolbox,\n            plusButton;\n\n        /** Make editor wrapper */\n        wrapper = codex.draw.wrapper();\n\n        /** Append editor wrapper after initial textarea */\n        codex.core.insertAfter(codex.nodes.textarea, wrapper);\n\n        /** Append block with notifications to the document */\n        notifications = codex.draw.alertsHolder();\n        codex.nodes.notifications = document.body.appendChild(notifications);\n\n        /** Make toolbar and content-editable redactor */\n        toolbar               = codex.draw.toolbar();\n        toolbarContent        = codex.draw.toolbarContent();\n        inlineToolbar         = codex.draw.inlineToolbar();\n        plusButton            = codex.draw.plusButton();\n        showSettingsButton    = codex.draw.settingsButton();\n        showTrashButton       = codex.toolbar.settings.makeRemoveBlockButton();\n        blockSettings         = codex.draw.blockSettings();\n        blockButtons          = codex.draw.blockButtons();\n        toolbox               = codex.draw.toolbox();\n        redactor              = codex.draw.redactor();\n\n        /** settings */\n        var defaultSettings = codex.draw.defaultSettings(),\n            pluginSettings  = codex.draw.pluginsSettings();\n\n        /** Add default and plugins settings */\n        blockSettings.appendChild(pluginSettings);\n        blockSettings.appendChild(defaultSettings);\n\n        /** Make blocks buttons\n         * This block contains settings button and remove block button\n         */\n        blockButtons.appendChild(showSettingsButton);\n        blockButtons.appendChild(showTrashButton);\n        blockButtons.appendChild(blockSettings);\n\n        /** Append plus button */\n        toolbarContent.appendChild(plusButton);\n\n        /** Appending toolbar tools */\n        toolbarContent.appendChild(toolbox);\n\n        /** Appending first-level block buttons */\n        toolbar.appendChild(blockButtons);\n\n        /** Append toolbarContent to toolbar */\n        toolbar.appendChild(toolbarContent);\n\n        wrapper.appendChild(toolbar);\n\n        wrapper.appendChild(redactor);\n\n        /** Save created ui-elements to static nodes state */\n        codex.nodes.wrapper            = wrapper;\n        codex.nodes.toolbar            = toolbar;\n        codex.nodes.plusButton         = plusButton;\n        codex.nodes.toolbox            = toolbox;\n        codex.nodes.blockSettings      = blockSettings;\n        codex.nodes.pluginSettings     = pluginSettings;\n        codex.nodes.defaultSettings    = defaultSettings;\n        codex.nodes.showSettingsButton = showSettingsButton;\n        codex.nodes.showTrashButton    = showTrashButton;\n\n        codex.nodes.redactor = redactor;\n\n        codex.ui.makeInlineToolbar(inlineToolbar);\n\n        /** fill in default settings */\n        codex.toolbar.settings.addDefaultSettings();\n    };\n\n    ui.makeInlineToolbar = function(container) {\n\n        /** Append to redactor new inline block */\n        codex.nodes.inlineToolbar.wrapper = container;\n\n        /** Draw toolbar buttons */\n        codex.nodes.inlineToolbar.buttons = codex.draw.inlineToolbarButtons();\n\n        /** Buttons action or settings */\n        codex.nodes.inlineToolbar.actions = codex.draw.inlineToolbarActions();\n\n        /** Append to inline toolbar buttons as part of it */\n        codex.nodes.inlineToolbar.wrapper.appendChild(codex.nodes.inlineToolbar.buttons);\n        codex.nodes.inlineToolbar.wrapper.appendChild(codex.nodes.inlineToolbar.actions);\n\n        codex.nodes.wrapper.appendChild(codex.nodes.inlineToolbar.wrapper);\n    };\n\n    /**\n     * @private\n     * Append tools passed in codex.tools\n     */\n    ui.addTools = function () {\n\n        var tool,\n            tool_button;\n\n        for(var name in codex.settings.tools) {\n            tool = codex.settings.tools[name];\n            codex.tools[name] = tool;;\n        }\n\n        /** Make toolbar buttons */\n        for (var name in codex.tools){\n\n            tool = codex.tools[name];\n\n            if (!tool.displayInToolbox) {\n                continue;\n            }\n\n            if (!tool.iconClassname) {\n                codex.core.log('Toolbar icon classname missed. Tool %o skipped', 'warn', name);\n                continue;\n            }\n\n            if (typeof tool.make != 'function') {\n                codex.core.log('make method missed. Tool %o skipped', 'warn', name);\n                continue;\n            }\n\n            /**\n             * if tools is for toolbox\n             */\n            tool_button = codex.draw.toolbarButton(name, tool.iconClassname);\n\n            codex.nodes.toolbox.appendChild(tool_button);\n\n            /** Save tools to static nodes */\n            codex.nodes.toolbarButtons[name] = tool_button;\n        }\n\n\n        /**\n         * Add inline toolbar tools\n         */\n        codex.ui.addInlineToolbarTools();\n\n\n    };\n\n    ui.addInlineToolbarTools = function() {\n\n        var tools = {\n\n            bold: {\n                icon    : 'ce-icon-bold',\n                command : 'bold'\n            },\n\n            italic: {\n                icon    : 'ce-icon-italic',\n                command : 'italic'\n            },\n\n            underline: {\n                icon    : 'ce-icon-underline',\n                command : 'underline'\n            },\n\n            link: {\n                icon    : 'ce-icon-link',\n                command : 'createLink',\n            }\n        };\n\n        var toolButton,\n            tool;\n\n        for(var name in tools) {\n\n            tool = tools[name];\n\n            toolButton = codex.draw.toolbarButtonInline(name, tool.icon);\n\n            codex.nodes.inlineToolbar.buttons.appendChild(toolButton);\n            /**\n             * Add callbacks to this buttons\n             */\n            codex.ui.setInlineToolbarButtonBehaviour(toolButton, tool.command);\n        }\n\n    };\n\n    /**\n     * @private\n     * Bind editor UI events\n     */\n    ui.bindEvents = function () {\n\n        codex.core.log('ui.bindEvents fired', 'info');\n\n        window.addEventListener('error', function (errorMsg, url, lineNumber) {\n            codex.notifications.errorThrown(errorMsg, event);\n        }, false );\n\n        /** All keydowns on Document */\n        codex.nodes.redactor.addEventListener('keydown', codex.callback.globalKeydown, false );\n\n        /** All keydowns on Document */\n        document.addEventListener('keyup', codex.callback.globalKeyup, false );\n\n        /**\n         * Mouse click to radactor\n         */\n        codex.nodes.redactor.addEventListener('click', codex.callback.redactorClicked, false );\n\n        /**\n         * Clicks to the Plus button\n         */\n        codex.nodes.plusButton.addEventListener('click', codex.callback.plusButtonClicked, false);\n\n        /**\n         * Clicks to SETTINGS button in toolbar\n         */\n        codex.nodes.showSettingsButton.addEventListener('click', codex.callback.showSettingsButtonClicked, false );\n        /**\n         *  @deprecated ( but now in use for syncronization );\n         *  Any redactor changes: keyboard input, mouse cut/paste, drag-n-drop text\n         */\n        codex.nodes.redactor.addEventListener('input', codex.callback.redactorInputEvent, false );\n\n        /** Bind click listeners on toolbar buttons */\n        for (var button in codex.nodes.toolbarButtons){\n            codex.nodes.toolbarButtons[button].addEventListener('click', codex.callback.toolbarButtonClicked, false);\n        }\n\n    };\n\n    /**\n     * Initialize plugins before using\n     * Ex. Load scripts or call some internal methods\n     */\n    ui.preparePlugins = function() {\n\n        for(var tool in codex.tools) {\n\n            if (typeof codex.tools[tool].prepare != 'function')\n                continue;\n\n            codex.tools[tool].prepare();\n        }\n    };\n\n    ui.addBlockHandlers = function(block) {\n\n        if (!block) return;\n\n        /**\n         * Block keydowns\n         */\n        block.addEventListener('keydown', function(event) {\n            codex.callback.blockKeydown(event, block);\n        }, false);\n\n        /**\n         * Pasting content from another source\n         */\n        block.addEventListener('paste', function (event) {\n            codex.callback.blockPaste(event);\n        }, false);\n\n        block.addEventListener('mouseup', function(){\n            codex.toolbar.inline.show();\n        }, false);\n\n    };\n\n    /** getting all contenteditable elements */\n    ui.saveInputs = function() {\n\n        var redactor = codex.nodes.redactor,\n            elements = [];\n\n        /** Save all inputs in global variable state */\n        codex.state.inputs = redactor.querySelectorAll('[contenteditable], input');\n    };\n\n    /**\n     * Adds first initial block on empty redactor\n     */\n    ui.addInitialBlock = function(){\n\n        var initialBlockType = codex.settings.initialBlockPlugin,\n            initialBlock;\n\n        if ( !codex.tools[initialBlockType] ){\n            codex.core.log('Plugin %o was not implemented and can\\'t be used as initial block', 'warn', initialBlockType);\n            return;\n        }\n\n        initialBlock = codex.tools[initialBlockType].render();\n\n        initialBlock.setAttribute('data-placeholder', 'Write your story...');\n\n        codex.content.insertBlock({\n            type  : initialBlockType,\n            block : initialBlock\n        });\n\n        codex.content.workingNodeChanged(initialBlock);\n\n    };\n\n    ui.setInlineToolbarButtonBehaviour = function(button, type) {\n\n        button.addEventListener('mousedown', function(event) {\n\n            codex.toolbar.inline.toolClicked(event, type);\n\n        }, false);\n    };\n\n    return ui;\n\n})({});\n\nmodule.exports = ui;\n\n\n// WEBPACK FOOTER //\n// ./modules/ui.js","/**\n *\n * Codex.Editor Transport Module\n *\n * @author Codex Team\n * @version 1.0\n */\n\nvar transport = (function(transport){\n\n    transport.input = null;\n\n    /**\n     * @property {Object} arguments - keep plugin settings and defined callbacks\n     */\n    transport.arguments = null;\n\n    transport.prepare = function(){\n\n        var input = document.createElement('INPUT');\n\n        input.type = 'file';\n        input.addEventListener('change', codex.transport.fileSelected);\n\n        codex.transport.input = input;\n\n    };\n\n    /** Clear input when files is uploaded */\n    transport.clearInput = function() {\n\n        /** Remove old input */\n        this.input = null;\n\n        /** Prepare new one */\n        this.prepare();\n    };\n\n    /**\n     * Callback for file selection\n     */\n    transport.fileSelected = function(event){\n\n        var input       = this,\n            files       = input.files,\n            filesLength = files.length,\n            formdData   = new FormData(),\n            file,\n            i;\n\n        formdData.append('files', files[0], files[0].name);\n\n        codex.transport.ajax({\n            data : formdData,\n            beforeSend : codex.transport.arguments.beforeSend,\n            success    : codex.transport.arguments.success,\n            error      : codex.transport.arguments.error\n        });\n    };\n\n    /**\n     * Use plugin callbacks\n     * @protected\n     */\n    transport.selectAndUpload = function (args) {\n\n        this.arguments = args;\n        this.input.click();\n\n    };\n\n    /**\n     * Ajax requests module\n     */\n    transport.ajax = function(params){\n\n        var xhr = new XMLHttpRequest(),\n            beforeSend = typeof params.beforeSend == 'function' ? params.beforeSend : function(){},\n            success    = typeof params.success    == 'function' ? params.success : function(){},\n            error      = typeof params.error      == 'function' ? params.error   : function(){};\n\n        beforeSend();\n\n        xhr.open('POST', codex.settings.uploadImagesUrl, true);\n\n        xhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n\n        xhr.onload = function () {\n            if (xhr.status === 200) {\n                success(xhr.responseText);\n            } else {\n                console.log(\"request error: %o\", xhr);\n                error();\n            }\n        };\n\n        xhr.send(params.data);\n        this.clearInput();\n\n    };\n\n    return transport;\n\n})({});\n\nmodule.exports  = transport;\n\n\n// WEBPACK FOOTER //\n// ./modules/transport.js","/**\n * Codex Editor Renderer Module\n *\n * @author Codex Team\n * @version 1.0\n */\n\nvar renderer = (function(renderer) {\n\n    /**\n     * Asyncronously parses input JSON to redactor blocks\n     */\n    renderer.makeBlocksFromData = function () {\n\n        /**\n         * If redactor is empty, add first paragraph to start writing\n         */\n        if (!codex.state.blocks.items.length) {\n\n            codex.ui.addInitialBlock();\n            return;\n\n        }\n\n        Promise.resolve()\n\n        /** First, get JSON from state */\n            .then(function() {\n                return codex.state.blocks;\n            })\n\n            /** Then, start to iterate they */\n            .then(codex.renderer.appendBlocks)\n\n            /** Write log if something goes wrong */\n            .catch(function(error) {\n                codex.core.log('Error while parsing JSON: %o', 'error', error);\n            });\n\n    };\n\n    /**\n     * Parses JSON to blocks\n     * @param {object} data\n     * @return Primise -> nodeList\n     */\n    renderer.appendBlocks = function (data) {\n\n        var blocks = data.items;\n\n        /**\n         * Sequence of one-by-one blocks appending\n         * Uses to save blocks order after async-handler\n         */\n        var nodeSequence = Promise.resolve();\n\n        for (var index = 0; index < blocks.length ; index++ ) {\n\n            /** Add node to sequence at specified index */\n            codex.renderer.appendNodeAtIndex(nodeSequence, blocks, index);\n\n        }\n\n    };\n\n    /**\n     * Append node at specified index\n     */\n    renderer.appendNodeAtIndex = function (nodeSequence, blocks, index) {\n\n        /** We need to append node to sequence */\n        nodeSequence\n\n        /** first, get node async-aware */\n            .then(function() {\n\n                return codex.renderer.getNodeAsync(blocks , index);\n\n            })\n\n            /**\n             * second, compose editor-block from JSON object\n             */\n            .then(codex.renderer.createBlockFromData)\n\n            /**\n             * now insert block to redactor\n             */\n            .then(function(blockData){\n\n                /**\n                 * blockData has 'block', 'type' and 'stretched' information\n                 */\n                codex.content.insertBlock(blockData);\n\n                /** Pass created block to next step */\n                return blockData.block;\n\n            })\n\n            /** Log if something wrong with node */\n            .catch(function(error) {\n                codex.core.log('Node skipped while parsing because %o', 'error', error);\n            });\n\n    };\n\n    /**\n     * Asynchronously returns block data from blocksList by index\n     * @return Promise to node\n     */\n    renderer.getNodeAsync = function (blocksList, index) {\n\n        return Promise.resolve().then(function() {\n\n            return blocksList[index];\n\n        });\n    };\n\n    /**\n     * Creates editor block by JSON-data\n     *\n     * @uses render method of each plugin\n     *\n     * @param {object} blockData looks like\n     *                            { header : {\n     *                                            text: '',\n     *                                            type: 'H3', ...\n     *                                        }\n     *                            }\n     * @return {object} with type and Element\n     */\n    renderer.createBlockFromData = function (blockData) {\n\n        /** New parser */\n        var pluginName = blockData.type,\n            cover      = blockData.cover;\n\n        /** Get first key of object that stores plugin name */\n        // for (var pluginName in blockData) break;\n\n        /** Check for plugin existance */\n        if (!codex.tools[pluginName]) {\n            throw Error(`Plugin ${pluginName} not found`);\n        }\n\n        /** Check for plugin having render method */\n        if (typeof codex.tools[pluginName].render != 'function') {\n\n            throw Error(`Plugin ${pluginName} must have render method`);\n        }\n\n        /** New Parser */\n        var block = codex.tools[pluginName].render(blockData.data);\n\n        /** is first-level block stretched */\n        var stretched = codex.tools[pluginName].isStretched || false;\n\n        /** Retrun type and block */\n        return {\n            type      : pluginName,\n            block     : block,\n            stretched : stretched,\n            cover     : cover\n        };\n\n    };\n\n    return renderer;\n\n})({});\n\nmodule.exports = renderer;\n\n\n// WEBPACK FOOTER //\n// ./modules/renderer.js","/**\n * Codex Editor Saver\n *\n * @author Codex Team\n * @version 1.0\n */\n\nvar saver = (function(saver) {\n\n    /**\n     * Saves blocks\n     * @private\n     */\n    saver.saveBlocks = function () {\n\n        /** Save html content of redactor to memory */\n        codex.state.html = codex.nodes.redactor.innerHTML;\n\n        /** Empty jsonOutput state */\n        codex.state.jsonOutput = [];\n\n        Promise.resolve()\n\n            .then(function() {\n                return codex.nodes.redactor.childNodes;\n            })\n            /** Making a sequence from separate blocks */\n            .then(codex.saver.makeQueue)\n\n            .then(function() {\n                // codex.nodes.textarea.innerHTML = codex.state.html;\n            })\n\n            .catch( function(error) {\n                console.log('Something happend');\n            });\n\n    };\n\n    saver.makeQueue = function(blocks) {\n\n        var queue = Promise.resolve();\n\n        for(var index = 0; index < blocks.length; index++) {\n\n            /** Add node to sequence at specified index */\n            codex.saver.getBlockData(queue, blocks, index);\n\n        }\n\n    };\n\n    /** Gets every block and makes From Data */\n    saver.getBlockData = function(queue, blocks, index) {\n\n        queue.then(function() {\n            return codex.saver.getNodeAsync(blocks, index);\n        })\n\n            .then(codex.saver.makeFormDataFromBlocks);\n\n    };\n\n\n    /**\n     * Asynchronously returns block data from blocksList by index\n     * @return Promise to node\n     */\n    saver.getNodeAsync = function (blocksList, index) {\n\n        return Promise.resolve().then(function() {\n\n            return blocksList[index];\n\n        });\n    };\n\n    saver.makeFormDataFromBlocks = function(block) {\n\n        var pluginName = block.dataset.tool;\n\n        /** Check for plugin existance */\n        if (!codex.tools[pluginName]) {\n            throw Error(`Plugin ${pluginName} not found`);\n        }\n\n        /** Check for plugin having render method */\n        if (typeof codex.tools[pluginName].save != 'function') {\n\n            throw Error(`Plugin ${pluginName} must have save method`);\n        }\n\n        /** Result saver */\n        var blockContent   = block.childNodes[0],\n            pluginsContent = blockContent.childNodes[0],\n            savedData      = codex.tools[pluginName].save(pluginsContent),\n            output;\n\n\n        output = {\n            type: pluginName,\n            data: savedData\n        };\n\n        /** Marks Blocks that will be in main page */\n        output.cover = block.classList.contains(codex.ui.className.BLOCK_IN_FEED_MODE);\n\n        codex.state.jsonOutput.push(output);\n    };\n\n    return saver;\n\n})({});\n\nmodule.exports = saver;\n\n\n// WEBPACK FOOTER //\n// ./modules/saver.js","/**\n * Codex Editor Content Module\n * Works with DOM\n *\n * @author Codex Team\n * @version 1.1.2\n */\n\nvar content = (function(content) {\n\n    content.currentNode = null;\n\n    /**\n     * Synchronizes redactor with original textarea\n     */\n    content.sync = function () {\n\n        codex.core.log('syncing...');\n\n        /**\n         * Save redactor content to codex.state\n         */\n        codex.state.html = codex.nodes.redactor.innerHTML;\n\n    };\n\n    /**\n     * @deprecated\n     */\n    content.getNodeFocused = function() {\n\n        var selection = window.getSelection(),\n            focused;\n\n        if (selection.anchorNode === null) {\n            return null;\n        }\n\n        if ( selection.anchorNode.nodeType == codex.core.nodeTypes.TAG ) {\n            focused = selection.anchorNode;\n        } else {\n            focused = selection.focusNode.parentElement;\n        }\n\n        if ( !codex.parser.isFirstLevelBlock(focused) ) {\n\n            /** Iterate with parent nodes to find first-level*/\n            var parent = focused.parentNode;\n\n            while (parent && !codex.parser.isFirstLevelBlock(parent)){\n                parent = parent.parentNode;\n            }\n\n            focused = parent;\n        }\n\n        if (focused != codex.nodes.redactor){\n            return focused;\n        }\n\n        return null;\n\n    };\n\n    /**\n     * Appends background to the block\n     */\n    content.markBlock = function() {\n\n        codex.content.currentNode.classList.add(codex.ui.className.BLOCK_HIGHLIGHTED);\n    };\n\n    /**\n     * Clear background\n     */\n    content.clearMark = function() {\n\n        if (codex.content.currentNode) {\n            codex.content.currentNode.classList.remove(codex.ui.className.BLOCK_HIGHLIGHTED);\n        }\n\n    };\n\n    /**\n     * @private\n     *\n     * Finds first-level block\n     * @param {Element} node - selected or clicked in redactors area node\n     */\n    content.getFirstLevelBlock = function(node) {\n\n        if (!codex.core.isDomNode(node)) {\n            node = node.parentNode;\n        }\n\n        if (node === codex.nodes.redactor || node === document.body) {\n\n            return null;\n\n        } else {\n\n            while(!node.classList.contains(codex.ui.className.BLOCK_CLASSNAME)) {\n                node = node.parentNode;\n            }\n\n            return node;\n        }\n\n    };\n\n    /**\n     * Trigger this event when working node changed\n     * @param {Element} targetNode - first-level of this node will be current\n     * If targetNode is first-level then we set it as current else we look for parents to find first-level\n     */\n    content.workingNodeChanged = function (targetNode) {\n\n        /** Clear background from previous marked block before we change */\n        codex.content.clearMark();\n\n        if (!targetNode) {\n            return;\n        }\n\n        this.currentNode = this.getFirstLevelBlock(targetNode);\n\n    };\n\n    /**\n     * Replaces one redactor block with another\n     * @protected\n     * @param {Element} targetBlock - block to replace. Mostly currentNode.\n     * @param {Element} newBlock\n     * @param {string} newBlockType - type of new block; we need to store it to data-attribute\n     *\n     * [!] Function does not saves old block content.\n     *     You can get it manually and pass with newBlock.innerHTML\n     */\n    content.replaceBlock = function function_name(targetBlock, newBlock) {\n\n        if (!targetBlock || !newBlock){\n            codex.core.log('replaceBlock: missed params');\n            return;\n        }\n\n        /** If target-block is not a frist-level block, then we iterate parents to find it */\n        while(!targetBlock.classList.contains(codex.ui.className.BLOCK_CLASSNAME)) {\n            targetBlock = targetBlock.parentNode;\n        }\n\n        /** Replacing */\n        codex.nodes.redactor.replaceChild(newBlock, targetBlock);\n\n        /**\n         * Set new node as current\n         */\n        codex.content.workingNodeChanged(newBlock);\n\n        /**\n         * Add block handlers\n         */\n        codex.ui.addBlockHandlers(newBlock);\n\n        /**\n         * Save changes\n         */\n        codex.ui.saveInputs();\n\n    };\n\n    /**\n     * @private\n     *\n     * Inserts new block to redactor\n     * Wrapps block into a DIV with BLOCK_CLASSNAME class\n     *\n     * @param blockData          {object}\n     * @param blockData.block    {Element}   element with block content\n     * @param blockData.type     {string}    block plugin\n     * @param needPlaceCaret     {bool}      pass true to set caret in new block\n     *\n     */\n    content.insertBlock = function( blockData, needPlaceCaret ) {\n\n        var workingBlock    = codex.content.currentNode,\n            newBlockContent = blockData.block,\n            blockType       = blockData.type,\n            cover           = blockData.cover,\n            isStretched     = blockData.stretched;\n\n        var newBlock = codex.content.composeNewBlock(newBlockContent, blockType, isStretched);\n\n        if (cover === true) {\n            newBlock.classList.add(codex.ui.className.BLOCK_IN_FEED_MODE);\n        }\n\n        if (workingBlock) {\n\n            codex.core.insertAfter(workingBlock, newBlock);\n\n        } else {\n            /**\n             * If redactor is empty, append as first child\n             */\n            codex.nodes.redactor.appendChild(newBlock);\n\n        }\n\n        /**\n         * Block handler\n         */\n        codex.ui.addBlockHandlers(newBlock);\n\n        /**\n         * Set new node as current\n         */\n        codex.content.workingNodeChanged(newBlock);\n\n        /**\n         * Save changes\n         */\n        codex.ui.saveInputs();\n\n\n        if ( needPlaceCaret ) {\n\n            /**\n             * If we don't know input index then we set default value -1\n             */\n            var currentInputIndex = codex.caret.getCurrentInputIndex() || -1;\n\n\n            if (currentInputIndex == -1) {\n\n\n                var editableElement = newBlock.querySelector('[contenteditable]'),\n                    emptyText       = document.createTextNode('');\n\n                editableElement.appendChild(emptyText);\n                codex.caret.set(editableElement, 0, 0);\n\n                codex.toolbar.move();\n                codex.toolbar.showPlusButton();\n\n\n            } else {\n\n                /** Timeout for browsers execution */\n                setTimeout(function () {\n\n                    /** Setting to the new input */\n                    codex.caret.setToNextBlock(currentInputIndex);\n                    codex.toolbar.move();\n                    codex.toolbar.open();\n\n                }, 10);\n\n            }\n\n        }\n\n    };\n\n    /**\n     * Replaces blocks with saving content\n     * @protected\n     * @param {Element} noteToReplace\n     * @param {Element} newNode\n     * @param {Element} blockType\n     */\n    content.switchBlock = function(blockToReplace, newBlock, tool){\n\n        var newBlockComposed = codex.content.composeNewBlock(newBlock, tool);\n\n        /** Replacing */\n        codex.content.replaceBlock(blockToReplace, newBlockComposed);\n\n        /** Save new Inputs when block is changed */\n        codex.ui.saveInputs();\n    };\n\n    /**\n     * Iterates between child noted and looking for #text node on deepest level\n     * @private\n     * @param {Element} block - node where find\n     * @param {int} postiton - starting postion\n     *      Example: childNodex.length to find from the end\n     *               or 0 to find from the start\n     * @return {Text} block\n     * @uses DFS\n     */\n    content.getDeepestTextNodeFromPosition = function (block, position) {\n\n        /**\n         * Clear Block from empty and useless spaces with trim.\n         * Such nodes we should remove\n         */\n        var blockChilds = block.childNodes,\n            index,\n            node,\n            text;\n\n        for(index = 0; index < blockChilds.length; index++)\n        {\n            node = blockChilds[index];\n\n            if (node.nodeType == codex.core.nodeTypes.TEXT) {\n\n                text = node.textContent.trim();\n\n                /** Text is empty. We should remove this child from node before we start DFS\n                 * decrease the quantity of childs.\n                 */\n                if (text === '') {\n\n                    block.removeChild(node);\n                    position--;\n                }\n            }\n        }\n\n        if (block.childNodes.length === 0) {\n            return document.createTextNode('');\n        }\n\n        /** Setting default position when we deleted all empty nodes */\n        if ( position < 0 )\n            position = 1;\n\n        var looking_from_start = false;\n\n        /** For looking from START */\n        if (position === 0) {\n            looking_from_start = true;\n            position = 1;\n        }\n\n        while ( position ) {\n\n            /** initial verticle of node. */\n            if ( looking_from_start ) {\n                block = block.childNodes[0];\n            } else {\n                block = block.childNodes[position - 1];\n            }\n\n            if ( block.nodeType == codex.core.nodeTypes.TAG ){\n\n                position = block.childNodes.length;\n\n            } else if (block.nodeType == codex.core.nodeTypes.TEXT ){\n\n                position = 0;\n            }\n\n        }\n\n        return block;\n    };\n\n    /**\n     * @private\n     */\n    content.composeNewBlock = function (block, tool, isStretched) {\n\n        var newBlock     = codex.draw.node('DIV', codex.ui.className.BLOCK_CLASSNAME, {}),\n            blockContent = codex.draw.node('DIV', codex.ui.className.BLOCK_CONTENT, {});\n\n        blockContent.appendChild(block);\n        newBlock.appendChild(blockContent);\n\n        if (isStretched) {\n            blockContent.classList.add(codex.ui.className.BLOCK_STRETCHED);\n        }\n\n        newBlock.dataset.tool = tool;\n        return newBlock;\n    };\n\n    /**\n     * Returns Range object of current selection\n     */\n    content.getRange = function() {\n\n        var selection = window.getSelection().getRangeAt(0);\n\n        return selection;\n    };\n\n    /**\n     * Divides block in two blocks (after and before caret)\n     * @private\n     * @param {Int} inputIndex - target input index\n     */\n    content.splitBlock = function(inputIndex) {\n\n        var selection      = window.getSelection(),\n            anchorNode     = selection.anchorNode,\n            anchorNodeText = anchorNode.textContent,\n            caretOffset    = selection.anchorOffset,\n            textBeforeCaret,\n            textNodeBeforeCaret,\n            textAfterCaret,\n            textNodeAfterCaret;\n\n        var currentBlock = codex.content.currentNode.querySelector('[contentEditable]');\n\n\n        textBeforeCaret     = anchorNodeText.substring(0, caretOffset);\n        textAfterCaret      = anchorNodeText.substring(caretOffset);\n\n        textNodeBeforeCaret = document.createTextNode(textBeforeCaret);\n\n        if (textAfterCaret) {\n            textNodeAfterCaret  = document.createTextNode(textAfterCaret);\n        }\n\n        var previousChilds = [],\n            nextChilds     = [],\n            reachedCurrent = false;\n\n        if (textNodeAfterCaret) {\n            nextChilds.push(textNodeAfterCaret);\n        }\n\n        for ( var i = 0, child; !!(child = currentBlock.childNodes[i]); i++) {\n\n            if ( child != anchorNode ) {\n                if ( !reachedCurrent ){\n                    previousChilds.push(child);\n                } else {\n                    nextChilds.push(child);\n                }\n            } else {\n                reachedCurrent = true;\n            }\n\n        }\n\n        /** Clear current input */\n        codex.state.inputs[inputIndex].innerHTML = '';\n\n        /**\n         * Append all childs founded before anchorNode\n         */\n        var previousChildsLength = previousChilds.length;\n\n        for(i = 0; i < previousChildsLength; i++) {\n            codex.state.inputs[inputIndex].appendChild(previousChilds[i]);\n        }\n\n        codex.state.inputs[inputIndex].appendChild(textNodeBeforeCaret);\n\n        /**\n         * Append text node which is after caret\n         */\n        var nextChildsLength = nextChilds.length,\n            newNode          = document.createElement('div');\n\n        for(i = 0; i < nextChildsLength; i++) {\n            newNode.appendChild(nextChilds[i]);\n        }\n\n        newNode = newNode.innerHTML;\n\n        /** This type of block creates when enter is pressed */\n        var NEW_BLOCK_TYPE = 'paragraph';\n\n        /**\n         * Make new paragraph with text after caret\n         */\n        codex.content.insertBlock({\n            type  : NEW_BLOCK_TYPE,\n            block : codex.tools[NEW_BLOCK_TYPE].render({\n                text : newNode\n            })\n        }, true );\n\n    };\n\n    /**\n     * Merges two blocks  current and target\n     * If target index is not exist, then previous will be as target\n     */\n    content.mergeBlocks = function(currentInputIndex, targetInputIndex) {\n\n        /** If current input index is zero, then prevent method execution */\n        if (currentInputIndex === 0) {\n            return;\n        }\n\n        var targetInput,\n            currentInputContent = codex.state.inputs[currentInputIndex].innerHTML;\n\n        if (!targetInputIndex) {\n\n            targetInput = codex.state.inputs[currentInputIndex - 1];\n\n        } else {\n\n            targetInput = codex.state.inputs[targetInputIndex];\n\n        }\n\n        targetInput.innerHTML += currentInputContent;\n    };\n\n    /**\n     * @private\n     *\n     * Callback for HTML Mutations\n     * @param {Array} mutation - Mutation Record\n     */\n    content.paste = function(mutation) {\n\n        var workingNode = codex.content.currentNode,\n            tool        = workingNode.dataset.tool;\n\n        if (codex.tools[tool].allowedToPaste) {\n            codex.content.sanitize(mutation.addedNodes);\n        } else {\n            codex.content.pasteTextContent(mutation.addedNodes);\n        }\n\n    };\n\n    /**\n     * @private\n     *\n     * gets only text/plain content of node\n     * @param {Element} target - HTML node\n     */\n    content.pasteTextContent = function(nodes) {\n\n        var node     = nodes[0],\n            textNode = document.createTextNode(node.textContent);\n\n        if (codex.core.isDomNode(node)) {\n            node.parentNode.replaceChild(textNode, node);\n        }\n    };\n\n    /**\n     * @private\n     *\n     * Sanitizes HTML content\n     * @param {Element} target - inserted element\n     * @uses Sanitize library and BASIC configuration\n     * @todo Fix caret positioning\n     */\n    content.sanitize = function(target) {\n\n        if (!target) {\n            return;\n        }\n\n        var sanitizer = new codex.sanitizer(codex.sanitizer.Config.BASIC);\n        var clearHTML = sanitizer.clean_node(codex.content.currentNode.childNodes[0]);\n\n        target.innerHTML = \"\";\n        target.appendChild(clearHTML);\n\n        /**\n         * Preliminary solution:\n         * Always set caret at the end of input\n         */\n        var inputIndex = codex.caret.getCurrentInputIndex();\n\n        /**\n         * setting to current block:\n         * (index + 1) minus 1 is current\n         */\n        codex.caret.setToPreviousBlock(inputIndex + 1);\n\n    };\n\n    return content;\n\n})({});\n\nmodule.exports = content;\n\n\n// WEBPACK FOOTER //\n// ./modules/content.js","/**\n * Codex Editor toolbar module\n *\n * Contains:\n *  - Inline toolbox\n *  - Toolbox within plus button\n *  - Settings section\n *\n * @author Codex Team\n * @version 1.0\n */\nvar toolbar = (function(toolbar) {\n\n    toolbar.init = function() {\n        toolbar.settings = require('./settings');\n        toolbar.inline   = require('./inline');\n        toolbar.toolbox  = require('./toolbox');\n    };\n\n    /**\n     * Margin between focused node and toolbar\n     */\n    toolbar.defaultToolbarHeight = 49;\n\n    toolbar.defaultOffset = 34;\n\n    toolbar.opened = false;\n\n    toolbar.current = null;\n\n    /**\n     * @protected\n     */\n    toolbar.open = function (){\n\n        codex.nodes.toolbar.classList.add('opened');\n        this.opened = true;\n\n    };\n\n    /**\n     * @protected\n     */\n    toolbar.close = function(){\n\n        codex.nodes.toolbar.classList.remove('opened');\n\n        toolbar.opened  = false;\n        toolbar.current = null;\n\n        for (var button in codex.nodes.toolbarButtons){\n            codex.nodes.toolbarButtons[button].classList.remove('selected');\n        }\n\n        /** Close toolbox when toolbar is not displayed */\n        codex.toolbar.toolbox.close();\n        codex.toolbar.settings.close();\n\n    };\n\n    toolbar.toggle = function(){\n\n        if ( !this.opened ){\n\n            this.open();\n\n        } else {\n\n            this.close();\n\n        }\n\n    };\n\n    toolbar.hidePlusButton = function() {\n        codex.nodes.plusButton.classList.add('hide');\n    };\n\n    toolbar.showPlusButton = function() {\n        codex.nodes.plusButton.classList.remove('hide');\n    };\n\n    /**\n     * Moving toolbar to the specified node\n     */\n    toolbar.move = function() {\n\n        /** Close Toolbox when we move toolbar */\n        codex.toolbar.toolbox.close();\n\n        if (!codex.content.currentNode) {\n            return;\n        }\n\n        var toolbarHeight = codex.nodes.toolbar.clientHeight || codex.toolbar.defaultToolbarHeight,\n            newYCoordinate = codex.content.currentNode.offsetTop - (codex.toolbar.defaultToolbarHeight / 2) + codex.toolbar.defaultOffset;\n\n        codex.nodes.toolbar.style.transform = `translate3D(0, ${Math.floor(newYCoordinate)}px, 0)`;\n\n        /** Close trash actions */\n        codex.toolbar.settings.hideRemoveActions();\n\n    };\n\n    return toolbar;\n\n})({});\n\ntoolbar.init();\n\nmodule.exports = toolbar;\n\n\n\n\n// WEBPACK FOOTER //\n// ./modules/toolbar/toolbar.js","var settings = (function(settings) {\n\n    settings.init = function() {\n        require('../content');\n    };\n\n    settings.opened = false;\n\n    settings.setting = null;\n    settings.actions = null;\n\n    settings.cover = null;\n\n    /**\n     * Append and open settings\n     */\n    settings.open = function(toolType){\n\n        /**\n         * Append settings content\n         * It's stored in tool.settings\n         */\n        if (!codex.tools[toolType] || !codex.core.isDomNode(codex.tools[toolType].settings) ) {\n\n            codex.core.log(`Plugin ${toolType} has no settings`, 'warn');\n            // codex.nodes.pluginSettings.innerHTML = ` ${toolType}   `;\n\n        } else {\n\n            codex.nodes.pluginSettings.appendChild(codex.tools[toolType].settings);\n\n        }\n\n        var currentBlock = codex.content.currentNode;\n\n        /** Open settings block */\n        codex.nodes.blockSettings.classList.add('opened');\n        codex.toolbar.settings.addDefaultSettings();\n        this.opened = true;\n    };\n\n    /**\n     * Close and clear settings\n     */\n    settings.close = function(){\n\n        codex.nodes.blockSettings.classList.remove('opened');\n        codex.nodes.pluginSettings.innerHTML = '';\n\n        this.opened = false;\n\n    };\n\n    /**\n     * @param {string} toolType - plugin type\n     */\n    settings.toggle = function( toolType ){\n\n        if ( !this.opened ){\n\n            this.open(toolType);\n\n        } else {\n\n            this.close();\n\n        }\n\n    };\n\n    /**\n     * This function adds default core settings\n     */\n    settings.addDefaultSettings = function() {\n\n        /** list of default settings */\n        var feedModeToggler;\n\n        /** Clear block and append initialized settings */\n        codex.nodes.defaultSettings.innerHTML = '';\n\n\n        /** Init all default setting buttons */\n        feedModeToggler = codex.toolbar.settings.makeFeedModeToggler();\n\n        /**\n         * Fill defaultSettings\n         */\n\n        /**\n         * Button that enables/disables Feed-mode\n         * Feed-mode means that block will be showed in articles-feed like cover\n         */\n        codex.nodes.defaultSettings.appendChild(feedModeToggler);\n\n    };\n\n    /**\n     * Cover setting.\n     * This tune highlights block, so that it may be used for showing target block on main page\n     * Draw different setting when block is marked for main page\n     * If TRUE, then we show button that removes this selection\n     * Also defined setting \"Click\" events will be listened and have separate callbacks\n     *\n     * @return {Element} node/button that we place in default settings block\n     */\n    settings.makeFeedModeToggler = function() {\n\n        var isFeedModeActivated = codex.toolbar.settings.isFeedModeActivated(),\n            setting,\n            data;\n\n        if (!isFeedModeActivated) {\n\n            data = {\n                innerHTML : '<i class=\"ce-icon-newspaper\"></i>  '\n            };\n\n        } else {\n\n            data = {\n                innerHTML : '<i class=\"ce-icon-newspaper\"></i>   '\n            };\n\n        }\n\n        setting = codex.draw.node('DIV', codex.ui.className.SETTINGS_ITEM, data);\n        setting.addEventListener('click', codex.toolbar.settings.updateFeedMode, false);\n\n        return setting;\n    };\n\n    /**\n     * Updates Feed-mode\n     */\n    settings.updateFeedMode = function() {\n\n        var currentNode = codex.content.currentNode;\n\n        currentNode.classList.toggle(codex.ui.className.BLOCK_IN_FEED_MODE);\n\n        codex.toolbar.settings.close();\n    };\n\n    settings.isFeedModeActivated = function() {\n\n        var currentBlock = codex.content.currentNode;\n\n        if (currentBlock) {\n            return currentBlock.classList.contains(codex.ui.className.BLOCK_IN_FEED_MODE);\n        } else {\n            return false;\n        }\n    };\n\n    /**\n     * Here we will draw buttons and add listeners to components\n     */\n    settings.makeRemoveBlockButton = function() {\n\n        var removeBlockWrapper  = codex.draw.node('SPAN', 'ce-toolbar__remove-btn', {}),\n            settingButton = codex.draw.node('SPAN', 'ce-toolbar__remove-setting', { innerHTML : '<i class=\"ce-icon-trash\"></i>' }),\n            actionWrapper = codex.draw.node('DIV', 'ce-toolbar__remove-confirmation', {}),\n            confirmAction = codex.draw.node('DIV', 'ce-toolbar__remove-confirm', { textContent : ' ' }),\n            cancelAction  = codex.draw.node('DIV', 'ce-toolbar__remove-cancel', { textContent : ' ' });\n\n        settingButton.addEventListener('click', codex.toolbar.settings.removeButtonClicked, false);\n\n        confirmAction.addEventListener('click', codex.toolbar.settings.confirmRemovingRequest, false);\n\n        cancelAction.addEventListener('click', codex.toolbar.settings.cancelRemovingRequest, false);\n\n        actionWrapper.appendChild(confirmAction);\n        actionWrapper.appendChild(cancelAction);\n\n        removeBlockWrapper.appendChild(settingButton);\n        removeBlockWrapper.appendChild(actionWrapper);\n\n        /** Save setting */\n        codex.toolbar.settings.setting = settingButton;\n        codex.toolbar.settings.actions = actionWrapper;\n\n        return removeBlockWrapper;\n\n    };\n\n    settings.removeButtonClicked = function() {\n\n        var action = codex.toolbar.settings.actions;\n\n        if (action.classList.contains('opened')) {\n            codex.toolbar.settings.hideRemoveActions();\n        } else {\n            codex.toolbar.settings.showRemoveActions();\n        }\n\n        codex.toolbar.toolbox.close();\n        codex.toolbar.settings.close();\n\n    };\n\n    settings.cancelRemovingRequest = function() {\n\n        codex.toolbar.settings.actions.classList.remove('opened');\n    };\n\n    settings.confirmRemovingRequest = function() {\n\n        var currentBlock = codex.content.currentNode,\n            firstLevelBlocksCount;\n\n        currentBlock.remove();\n\n        firstLevelBlocksCount = codex.nodes.redactor.childNodes.length;\n\n        /**\n         * If all blocks are removed\n         */\n        if (firstLevelBlocksCount === 0) {\n\n            /** update currentNode variable */\n            codex.content.currentNode = null;\n\n            /** Inserting new empty initial block */\n            codex.ui.addInitialBlock();\n        }\n\n        codex.ui.saveInputs();\n\n        codex.toolbar.close();\n    };\n\n    settings.showRemoveActions = function() {\n        codex.toolbar.settings.actions.classList.add('opened');\n    };\n\n    settings.hideRemoveActions = function() {\n        codex.toolbar.settings.actions.classList.remove('opened');\n    };\n\n    return settings;\n\n})({});\n\nsettings.init();\n\nmodule.exports = settings;\n\n\n// WEBPACK FOOTER //\n// ./modules/toolbar/settings.js","/**\n * Inline toolbar\n *\n * Contains from tools:\n * Bold, Italic, Underline and Anchor\n *\n * @author Codex Team\n * @version 1.0\n */\nvar inline = (function(inline) {\n\n    inline.init = function() {\n\n    };\n\n    inline.buttonsOpened = null;\n    inline.actionsOpened = null;\n    inline.wrappersOffset = null;\n\n    /**\n     * saving selection that need for execCommand for styling\n     *\n     */\n    inline.storedSelection = null,\n\n    /**\n     * @protected\n     *\n     * Open inline toobar\n     */\n    inline.show = function() {\n\n        var selectedText = this.getSelectionText(),\n            toolbar      = codex.nodes.inlineToolbar.wrapper,\n            buttons      = codex.nodes.inlineToolbar.buttons;\n\n        if (selectedText.length > 0) {\n\n            /** Move toolbar and open */\n            codex.toolbar.inline.move();\n\n            /** Open inline toolbar */\n            toolbar.classList.add('opened');\n\n            /** show buttons of inline toolbar */\n            codex.toolbar.inline.showButtons();\n        }\n\n    };\n\n    /**\n     * @protected\n     *\n     * Closes inline toolbar\n     */\n    inline.close = function() {\n        var toolbar = codex.nodes.inlineToolbar.wrapper;\n        toolbar.classList.remove('opened');\n    };\n\n    /**\n     * @private\n     *\n     * Moving toolbar\n     */\n    inline.move = function() {\n\n        if (!this.wrappersOffset) {\n            this.wrappersOffset = this.getWrappersOffset();\n        }\n\n        var coords          = this.getSelectionCoords(),\n            defaultOffset   = 0,\n            toolbar         = codex.nodes.inlineToolbar.wrapper,\n            newCoordinateX,\n            newCoordinateY;\n\n        if (toolbar.offsetHeight === 0) {\n            defaultOffset = 40;\n        }\n\n        newCoordinateX = coords.x - this.wrappersOffset.left;\n        newCoordinateY = coords.y + window.scrollY - this.wrappersOffset.top - defaultOffset - toolbar.offsetHeight;\n\n        toolbar.style.transform = `translate3D(${Math.floor(newCoordinateX)}px, ${Math.floor(newCoordinateY)}px, 0)`;\n\n        /** Close everything */\n        codex.toolbar.inline.closeButtons();\n        codex.toolbar.inline.closeAction();\n\n    };\n\n    /**\n     * @private\n     *\n     * Tool Clicked\n     */\n\n    inline.toolClicked = function(event, type) {\n\n        /**\n         * For simple tools we use default browser function\n         * For more complicated tools, we should write our own behavior\n         */\n        switch (type) {\n            case 'createLink' : codex.toolbar.inline.createLinkAction(event, type); break;\n            default           : codex.toolbar.inline.defaultToolAction(type); break;\n        }\n\n        /**\n         * highlight buttons\n         * after making some action\n         */\n        codex.nodes.inlineToolbar.buttons.childNodes.forEach(codex.toolbar.inline.hightlight);\n    };\n\n    /**\n     * @private\n     *\n     * Saving wrappers offset in DOM\n     */\n    inline.getWrappersOffset = function() {\n\n        var wrapper = codex.nodes.wrapper,\n            offset  = this.getOffset(wrapper);\n\n        this.wrappersOffset = offset;\n        return offset;\n\n    };\n\n    /**\n     * @private\n     *\n     * Calculates offset of DOM element\n     *\n     * @param el\n     * @returns {{top: number, left: number}}\n     */\n    inline.getOffset = function ( el ) {\n\n        var _x = 0;\n        var _y = 0;\n\n        while( el && !isNaN( el.offsetLeft ) && !isNaN( el.offsetTop ) ) {\n            _x += (el.offsetLeft + el.clientLeft);\n            _y += (el.offsetTop + el.clientTop);\n            el = el.offsetParent;\n        }\n        return { top: _y, left: _x };\n    };\n\n    /**\n     * @private\n     *\n     * Calculates position of selected text\n     * @returns {{x: number, y: number}}\n     */\n    inline.getSelectionCoords = function() {\n\n        var sel = document.selection, range;\n        var x = 0, y = 0;\n\n        if (sel) {\n\n            if (sel.type != \"Control\") {\n                range = sel.createRange();\n                range.collapse(true);\n                x = range.boundingLeft;\n                y = range.boundingTop;\n            }\n\n        } else if (window.getSelection) {\n\n            sel = window.getSelection();\n\n            if (sel.rangeCount) {\n\n                range = sel.getRangeAt(0).cloneRange();\n                if (range.getClientRects) {\n                    range.collapse(true);\n                    var rect = range.getClientRects()[0];\n                    x = rect.left;\n                    y = rect.top;\n                }\n\n            }\n        }\n        return { x: x, y: y };\n    };\n\n    /**\n     * @private\n     *\n     * Returns selected text as String\n     * @returns {string}\n     */\n    inline.getSelectionText = function getSelectionText(){\n\n        var selectedText = \"\";\n\n        if (window.getSelection){ // all modern browsers and IE9+\n            selectedText = window.getSelection().toString();\n        }\n\n        return selectedText;\n    };\n\n    /** Opens buttons block */\n    inline.showButtons = function() {\n\n        var buttons = codex.nodes.inlineToolbar.buttons;\n        buttons.classList.add('opened');\n\n        codex.toolbar.inline.buttonsOpened = true;\n\n        /** highlight buttons */\n        codex.nodes.inlineToolbar.buttons.childNodes.forEach(codex.toolbar.inline.hightlight);\n\n    };\n\n    /** Makes buttons disappear */\n    inline.closeButtons = function() {\n        var buttons = codex.nodes.inlineToolbar.buttons;\n        buttons.classList.remove('opened');\n\n        codex.toolbar.inline.buttonsOpened = false;\n    };\n\n    /** Open buttons defined action if exist */\n    inline.showActions = function() {\n        var action = codex.nodes.inlineToolbar.actions;\n        action.classList.add('opened');\n\n        codex.toolbar.inline.actionsOpened = true;\n    };\n\n    /** Close actions block */\n    inline.closeAction = function() {\n        var action = codex.nodes.inlineToolbar.actions;\n        action.innerHTML = '';\n        action.classList.remove('opened');\n        codex.toolbar.inline.actionsOpened = false;\n    };\n\n    /** Action for link creation or for setting anchor */\n    inline.createLinkAction = function(event, type) {\n\n        var isActive = this.isLinkActive();\n\n        var editable        = codex.content.currentNode,\n            storedSelection = codex.toolbar.inline.storedSelection;\n\n        if (isActive) {\n\n            var selection   = window.getSelection(),\n                anchorNode  = selection.anchorNode;\n\n            storedSelection = codex.toolbar.inline.saveSelection(editable);\n\n            /**\n             * Changing stored selection. if we want to remove anchor from word\n             * we should remove anchor from whole word, not only selected part.\n             * The solution is than we get the length of current link\n             * Change start position to - end of selection minus length of anchor\n             */\n            codex.toolbar.inline.restoreSelection(editable, storedSelection);\n\n            codex.toolbar.inline.defaultToolAction('unlink');\n\n        } else {\n\n            /** Create input and close buttons */\n            var action = codex.draw.inputForLink();\n            codex.nodes.inlineToolbar.actions.appendChild(action);\n\n            codex.toolbar.inline.closeButtons();\n            codex.toolbar.inline.showActions();\n\n            storedSelection = codex.toolbar.inline.saveSelection(editable);\n\n            /**\n             * focus to input\n             * Solution: https://developer.mozilla.org/ru/docs/Web/API/HTMLElement/focus\n             * Prevents event after showing input and when we need to focus an input which is in unexisted form\n             */\n            action.focus();\n            event.preventDefault();\n\n            /** Callback to link action */\n            action.addEventListener('keydown', function(event){\n\n                if (event.keyCode == codex.core.keys.ENTER) {\n\n                    codex.toolbar.inline.restoreSelection(editable, storedSelection);\n                    codex.toolbar.inline.setAnchor(action.value);\n\n                    /**\n                     * Preventing events that will be able to happen\n                     */\n                    event.preventDefault();\n                    event.stopImmediatePropagation();\n\n                    codex.toolbar.inline.clearRange();\n                }\n\n            }, false);\n        }\n    };\n\n    inline.isLinkActive = function() {\n\n        var isActive = false;\n\n        codex.nodes.inlineToolbar.buttons.childNodes.forEach(function(tool) {\n            var dataType = tool.dataset.type;\n\n            if (dataType == 'link' && tool.classList.contains('hightlighted')) {\n                isActive = true;\n            }\n        });\n\n        return isActive;\n    };\n\n    /** default action behavior of tool */\n    inline.defaultToolAction = function(type) {\n        document.execCommand(type, false, null);\n    };\n\n    /**\n     * @private\n     *\n     * Sets URL\n     *\n     * @param {String} url - URL\n     */\n    inline.setAnchor = function(url) {\n\n        document.execCommand('createLink', false, url);\n\n        /** Close after URL inserting */\n        codex.toolbar.inline.closeAction();\n    };\n\n    /**\n     * @private\n     *\n     * Saves selection\n     */\n    inline.saveSelection = function(containerEl) {\n\n        var range = window.getSelection().getRangeAt(0),\n            preSelectionRange = range.cloneRange(),\n            start;\n\n        preSelectionRange.selectNodeContents(containerEl);\n        preSelectionRange.setEnd(range.startContainer, range.startOffset);\n\n        start = preSelectionRange.toString().length;\n\n        return {\n            start: start,\n            end: start + range.toString().length\n        };\n    };\n\n    /**\n     * @private\n     *\n     * Sets to previous selection (Range)\n     *\n     * @param {Element} containerEl - editable element where we restore range\n     * @param {Object} savedSel - range basic information to restore\n     */\n    inline.restoreSelection = function(containerEl, savedSel) {\n\n        var range     = document.createRange(),\n            charIndex = 0;\n\n        range.setStart(containerEl, 0);\n        range.collapse(true);\n\n        var nodeStack = [containerEl],\n            node,\n            foundStart = false,\n            stop = false,\n            nextCharIndex;\n\n        while (!stop && (node = nodeStack.pop())) {\n\n            if (node.nodeType == 3) {\n\n                nextCharIndex = charIndex + node.length;\n\n                if (!foundStart && savedSel.start >= charIndex && savedSel.start <= nextCharIndex) {\n                    range.setStart(node, savedSel.start - charIndex);\n                    foundStart = true;\n                }\n                if (foundStart && savedSel.end >= charIndex && savedSel.end <= nextCharIndex) {\n                    range.setEnd(node, savedSel.end - charIndex);\n                    stop = true;\n                }\n                charIndex = nextCharIndex;\n            } else {\n                var i = node.childNodes.length;\n                while (i--) {\n                    nodeStack.push(node.childNodes[i]);\n                }\n            }\n        }\n\n        var sel = window.getSelection();\n        sel.removeAllRanges();\n        sel.addRange(range);\n    };\n\n    /**\n     * @private\n     *\n     * Removes all ranges from window selection\n     */\n    inline.clearRange = function() {\n        var selection = window.getSelection();\n        selection.removeAllRanges();\n    };\n\n    /**\n     * @private\n     *\n     * sets or removes hightlight\n     */\n    inline.hightlight = function(tool) {\n        var dataType = tool.dataset.type;\n\n        if (document.queryCommandState(dataType)) {\n            codex.toolbar.inline.setButtonHighlighted(tool);\n        } else {\n            codex.toolbar.inline.removeButtonsHighLight(tool);\n        }\n\n        /**\n         *\n         * hightlight for anchors\n         */\n        var selection = window.getSelection(),\n            tag = selection.anchorNode.parentNode;\n\n        if (tag.tagName == 'A' && dataType == 'link') {\n            codex.toolbar.inline.setButtonHighlighted(tool);\n        }\n    };\n\n    /**\n     * @private\n     *\n     * Mark button if text is already executed\n     */\n    inline.setButtonHighlighted = function(button) {\n        button.classList.add('hightlighted');\n\n        /** At link tool we also change icon */\n        if (button.dataset.type == 'link') {\n            var icon = button.childNodes[0];\n            icon.classList.remove('ce-icon-link');\n            icon.classList.add('ce-icon-unlink');\n        }\n    };\n\n    /**\n     * @private\n     *\n     * Removes hightlight\n     */\n    inline.removeButtonsHighLight = function(button) {\n        button.classList.remove('hightlighted');\n\n        /** At link tool we also change icon */\n        if (button.dataset.type == 'link') {\n            var icon = button.childNodes[0];\n            icon.classList.remove('ce-icon-unlink');\n            icon.classList.add('ce-icon-link');\n        }\n    };\n\n\n    return inline;\n})({});\n\ninline.init();\n\nmodule.exports = inline;\n\n\n// WEBPACK FOOTER //\n// ./modules/toolbar/inline.js","/**\n * Codex Editor toolbox\n *\n * All tools be able to appended here\n *\n * @author Codex Team\n * @version 1.0\n */\nvar toolbox = (function(toolbox) {\n\n    toolbox.init = function () {\n\n        require('./toolbar');\n\n    };\n\n    toolbox.opened = false;\n\n    /** Shows toolbox */\n    toolbox.open = function() {\n\n        /** Close setting if toolbox is opened */\n        if (codex.toolbar.settings.opened) {\n\n            codex.toolbar.settings.close();\n\n        }\n\n        /** display toolbox */\n        codex.nodes.toolbox.classList.add('opened');\n\n        /** Animate plus button */\n        codex.nodes.plusButton.classList.add('clicked');\n\n        /** toolbox state */\n        codex.toolbar.toolbox.opened = true;\n\n    };\n\n    /** Closes toolbox */\n    toolbox.close = function() {\n\n        /** Makes toolbox disapear */\n        codex.nodes.toolbox.classList.remove('opened');\n\n        /** Rotate plus button */\n        codex.nodes.plusButton.classList.remove('clicked');\n\n        /** toolbox state */\n        codex.toolbar.toolbox.opened = false;\n\n    };\n\n    toolbox.leaf = function(){\n\n        var currentTool = codex.toolbar.current,\n            tools       = Object.keys(codex.tools),\n            barButtons  = codex.nodes.toolbarButtons,\n            nextToolIndex,\n            hiddenToolsAmount = 0,\n            toolToSelect;\n\n        /** Count toolbox hidden tools */\n        for( var tool in codex.tools ) {\n\n            if (!codex.tools[tool].displayInToolbox) {\n\n                hiddenToolsAmount ++;\n\n            }\n\n\n        }\n\n        if ( !currentTool ) {\n\n            /** Get first tool from object*/\n            for (toolToSelect in barButtons) break;\n\n        } else {\n\n            nextToolIndex = tools.indexOf(currentTool) + 1;\n\n            var toolIsLastInToolbox = nextToolIndex == tools.length - (hiddenToolsAmount - 2);\n\n            if ( toolIsLastInToolbox ) {\n\n                nextToolIndex = 0;\n\n                /** getting first displayed tool */\n                for( var tool in codex.tools ) {\n\n                    if (codex.tools[tool].displayInToolbox){\n\n                        break;\n\n                    }\n\n                    nextToolIndex ++;\n                }\n\n            }\n\n            toolToSelect = tools[nextToolIndex];\n\n        }\n\n        for (var button in barButtons) barButtons[button].classList.remove('selected');\n        barButtons[toolToSelect].classList.add('selected');\n        codex.toolbar.current = toolToSelect;\n\n    };\n\n    /**\n     * Transforming selected node type into selected toolbar element type\n     * @param {event} event\n     */\n    toolbox.toolClicked = function() {\n\n        /**\n         * UNREPLACEBLE_TOOLS this types of tools are forbidden to replace even they are empty\n         */\n        var UNREPLACEBLE_TOOLS = ['image', 'link', 'list', 'instagram', 'twitter'],\n            tool               = codex.tools[codex.toolbar.current],\n            workingNode        = codex.content.currentNode,\n            currentInputIndex  = codex.caret.inputIndex,\n            newBlockContent,\n            appendCallback,\n            blockData;\n\n        /** Make block from plugin */\n        newBlockContent = tool.make();\n\n        /** information about block */\n        blockData = {\n            block     : newBlockContent,\n            type      : tool.type,\n            stretched : false\n        };\n\n        if (\n            workingNode &&\n            UNREPLACEBLE_TOOLS.indexOf(workingNode.dataset.tool) === -1 &&\n            workingNode.textContent.trim() === ''\n        ){\n\n            /** Replace current block */\n            codex.content.switchBlock(workingNode, newBlockContent, tool.type);\n\n        } else {\n\n            /** Insert new Block from plugin */\n            codex.content.insertBlock(blockData);\n\n            /** increase input index */\n            currentInputIndex++;\n\n        }\n\n        /** Fire tool append callback  */\n        appendCallback = tool.appendCallback;\n\n        if (appendCallback && typeof appendCallback == 'function') {\n\n            appendCallback.call(event);\n\n        }\n\n        setTimeout(function() {\n\n            /** Set caret to current block */\n            codex.caret.setToBlock(currentInputIndex);\n\n        }, 10);\n\n\n        /**\n         * Changing current Node\n         */\n        codex.content.workingNodeChanged();\n\n        /**\n         * Move toolbar when node is changed\n         */\n        codex.toolbar.move();\n    };\n\n    return toolbox;\n\n})({});\n\ntoolbox.init();\n\nmodule.exports = toolbox;\n\n\n// WEBPACK FOOTER //\n// ./modules/toolbar/toolbox.js","/**\n * Codex Editor tools\n * This tools will be appended in toolbox\n *\n * @author Codex Team\n * @version 1.0\n */\nvar tools = (function(tools) {\n\n    return tools;\n\n})({});\n\nmodule.exports = tools;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/tools.js","/**\n * Codex Editor callbacks module\n *\n * @author Codex Team\n * @version 1.0\n */\n\nvar callbacks = (function(callbacks) {\n\n    callbacks.redactorSyncTimeout = null;\n\n    callbacks.globalKeydown = function(event){\n        switch (event.keyCode){\n            case codex.core.keys.TAB   : codex.callback.tabKeyPressed(event);       break;\n            case codex.core.keys.ENTER : codex.callback.enterKeyPressed(event);     break;\n            case codex.core.keys.ESC   : codex.callback.escapeKeyPressed(event);    break;\n            default                      : codex.callback.defaultKeyPressed(event);    break;\n        }\n    };\n\n    callbacks.globalKeyup = function(event){\n        switch (event.keyCode){\n            case codex.core.keys.UP    :\n            case codex.core.keys.LEFT  :\n            case codex.core.keys.RIGHT :\n            case codex.core.keys.DOWN  : codex.callback.arrowKeyPressed(event); break;\n        }\n    };\n\n    callbacks.tabKeyPressed = function(event){\n\n        if ( !codex.toolbar.opened ) {\n            codex.toolbar.open();\n        }\n\n        if (codex.toolbar.opened && !codex.toolbar.toolbox.opened) {\n            codex.toolbar.toolbox.open();\n        } else {\n            codex.toolbar.toolbox.leaf();\n        }\n\n        event.preventDefault();\n    };\n\n    /**\n     * ENTER key handler\n     * Makes new paragraph block\n     */\n    callbacks.enterKeyPressed = function(event){\n\n        /** Set current node */\n        var firstLevelBlocksArea = codex.callback.clickedOnFirstLevelBlockArea();\n\n        if (firstLevelBlocksArea) {\n            event.preventDefault();\n\n            /**\n             * it means that we lose input index, saved index before is not correct\n             * therefore we need to set caret when we insert new block\n             */\n            codex.caret.inputIndex = -1;\n\n            codex.callback.enterPressedOnBlock();\n            return;\n        }\n\n        if (event.target.contentEditable == 'true') {\n\n            /** Update input index */\n            codex.caret.saveCurrentInputIndex();\n        }\n\n        if (!codex.content.currentNode) {\n            /**\n             * Enter key pressed in first-level block area\n             */\n            codex.callback.enterPressedOnBlock(event);\n            return;\n        }\n\n\n        var currentInputIndex       = codex.caret.getCurrentInputIndex() || 0,\n            workingNode             = codex.content.currentNode,\n            tool                    = workingNode.dataset.tool,\n            isEnterPressedOnToolbar = codex.toolbar.opened &&\n                codex.toolbar.current &&\n                event.target == codex.state.inputs[currentInputIndex];\n\n        /** The list of tools which needs the default browser behaviour */\n        var enableLineBreaks = codex.tools[tool].enableLineBreaks;\n\n        /** This type of block creates when enter is pressed */\n        var NEW_BLOCK_TYPE = 'paragraph';\n\n        /**\n         * When toolbar is opened, select tool instead of making new paragraph\n         */\n        if ( isEnterPressedOnToolbar ) {\n\n            event.preventDefault();\n\n            codex.toolbar.toolbox.toolClicked(event);\n\n            codex.toolbar.close();\n\n            return;\n\n        }\n\n        /**\n         * Allow making new <p> in same block by SHIFT+ENTER and forbids to prevent default browser behaviour\n         */\n        if ( event.shiftKey && !enableLineBreaks) {\n            codex.callback.enterPressedOnBlock(codex.content.currentBlock, event);\n            event.preventDefault();\n\n        } else if ( (event.shiftKey && !enableLineBreaks) || (!event.shiftKey && enableLineBreaks) ){\n            /** XOR */\n            return;\n        }\n\n        var isLastTextNode = false,\n            currentSelection = window.getSelection(),\n            currentSelectedNode = currentSelection.anchorNode,\n            caretAtTheEndOfText = codex.caret.position.atTheEnd(),\n            isTextNodeHasParentBetweenContenteditable = false;\n\n        /**\n         * Workaround situation when caret at the Text node that has some wrapper Elements\n         * Split block cant handle this.\n         * We need to save default behavior\n         */\n        isTextNodeHasParentBetweenContenteditable = currentSelectedNode && currentSelectedNode.parentNode.contentEditable != \"true\";\n\n        /**\n         * Split blocks when input has several nodes and caret placed in textNode\n         */\n        if (\n            currentSelectedNode.nodeType == codex.core.nodeTypes.TEXT &&\n            !isTextNodeHasParentBetweenContenteditable &&\n            !caretAtTheEndOfText\n        ){\n\n            event.preventDefault();\n\n            codex.core.log('Splitting Text node...');\n\n            codex.content.splitBlock(currentInputIndex);\n\n            /** Show plus button when next input after split is empty*/\n            if (!codex.state.inputs[currentInputIndex + 1].textContent.trim()) {\n                codex.toolbar.showPlusButton();\n            }\n\n        } else {\n\n            if ( currentSelectedNode && currentSelectedNode.parentNode) {\n\n                isLastTextNode = !currentSelectedNode.parentNode.nextSibling;\n\n            }\n\n            if ( isLastTextNode && caretAtTheEndOfText ) {\n\n                event.preventDefault();\n\n                codex.core.log('ENTER clicked in last textNode. Create new BLOCK');\n\n                codex.content.insertBlock({\n                    type  : NEW_BLOCK_TYPE,\n                    block : codex.tools[NEW_BLOCK_TYPE].render()\n                }, true );\n\n                codex.toolbar.move();\n                codex.toolbar.open();\n\n                /** Show plus button with empty block */\n                codex.toolbar.showPlusButton();\n\n            } else {\n\n                codex.core.log('Default ENTER behavior.');\n\n            }\n\n        }\n\n        /** get all inputs after new appending block */\n        codex.ui.saveInputs();\n\n    };\n\n    callbacks.escapeKeyPressed = function(event){\n\n        /** Close all toolbar */\n        codex.toolbar.close();\n\n        /** Close toolbox */\n        codex.toolbar.toolbox.close();\n\n        event.preventDefault();\n\n    };\n\n    callbacks.arrowKeyPressed = function(event){\n\n        codex.content.workingNodeChanged();\n\n        /* Closing toolbar */\n        codex.toolbar.close();\n        codex.toolbar.move();\n\n    };\n\n    callbacks.defaultKeyPressed = function(event) {\n\n        codex.toolbar.close();\n\n        if (!codex.toolbar.inline.actionsOpened) {\n            codex.toolbar.inline.close();\n            codex.content.clearMark();\n        }\n    };\n\n    callbacks.redactorClicked = function (event) {\n\n        codex.content.workingNodeChanged(event.target);\n\n        codex.ui.saveInputs();\n\n        var selectedText = codex.toolbar.inline.getSelectionText();\n\n        /**\n         * If selection range took off, then we hide inline toolbar\n         */\n        if (selectedText.length === 0) {\n            codex.toolbar.inline.close();\n        }\n\n        /** Update current input index in memory when caret focused into existed input */\n        if (event.target.contentEditable == 'true') {\n\n            codex.caret.saveCurrentInputIndex();\n\n        }\n\n        if (codex.content.currentNode === null) {\n\n            /**\n             * If inputs in redactor does not exits, then we put input index 0 not -1\n             */\n            var indexOfLastInput = codex.state.inputs.length > 0 ? codex.state.inputs.length - 1 : 0;\n\n            /** If we have any inputs */\n            if (codex.state.inputs.length) {\n\n                /** getting firstlevel parent of input */\n                var firstLevelBlock  = codex.content.getFirstLevelBlock(codex.state.inputs[indexOfLastInput]);\n            }\n\n            /** If input is empty, then we set caret to the last input */\n            if (codex.state.inputs.length && codex.state.inputs[indexOfLastInput].textContent === '' && firstLevelBlock.dataset.tool == 'paragraph') {\n\n                codex.caret.setToBlock(indexOfLastInput);\n\n            } else {\n\n                /** Create new input when caret clicked in redactors area */\n                var NEW_BLOCK_TYPE = 'paragraph';\n\n                codex.content.insertBlock({\n                    type  : NEW_BLOCK_TYPE,\n                    block : codex.tools[NEW_BLOCK_TYPE].render()\n                });\n\n                /** If there is no inputs except inserted */\n                if (codex.state.inputs.length === 1) {\n\n                    codex.caret.setToBlock(indexOfLastInput);\n\n                } else {\n\n                    /** Set caret to this appended input */\n                    codex.caret.setToNextBlock(indexOfLastInput);\n                }\n            }\n\n            /**\n             * Move toolbar to the right position and open\n             */\n            codex.toolbar.move();\n\n\n            codex.toolbar.open();\n\n        } else {\n\n            /**\n             * Move toolbar to the new position and open\n             */\n            codex.toolbar.move();\n\n            codex.toolbar.open();\n\n            /** Close all panels */\n            codex.toolbar.settings.close();\n            codex.toolbar.toolbox.close();\n        }\n\n\n        var inputIsEmpty = !codex.content.currentNode.textContent.trim();\n\n        if (inputIsEmpty) {\n\n            /** Show plus button */\n            codex.toolbar.showPlusButton();\n\n        } else {\n\n            /** Hide plus buttons */\n            codex.toolbar.hidePlusButton();\n\n        }\n\n        var currentNodeType = codex.content.currentNode.dataset.tool;\n\n        /** Mark current block*/\n        if (currentNodeType != 'paragraph' || !inputIsEmpty) {\n\n            codex.content.markBlock();\n\n        }\n\n    };\n\n    /**\n     * This method allows to define, is caret in contenteditable element or not.\n     * Otherwise, if we get TEXT node from range container, that will means we have input index.\n     * In this case we use default browsers behaviour (if plugin allows that) or overwritten action.\n     * Therefore, to be sure that we've clicked first-level block area, we should have currentNode, which always\n     * specifies to the first-level block. Other cases we just ignore.\n     */\n    callbacks.clickedOnFirstLevelBlockArea = function() {\n\n        var selection  = window.getSelection(),\n            anchorNode = selection.anchorNode,\n            flag = false;\n\n\n        if (selection.rangeCount == 0) {\n\n            return true;\n\n        } else {\n\n            if (!codex.core.isDomNode(anchorNode)) {\n                anchorNode = anchorNode.parentNode;\n            }\n\n            /** Already founded, without loop */\n            if (anchorNode.contentEditable == 'true') {\n                flag = true;\n            }\n\n            while (anchorNode.contentEditable != 'true') {\n                anchorNode = anchorNode.parentNode;\n\n                if (anchorNode.contentEditable == 'true') {\n                    flag = true;\n                }\n\n                if (anchorNode == document.body) {\n                    break;\n                }\n            }\n\n            /** If editable element founded, flag is \"TRUE\", Therefore we return \"FALSE\" */\n            return flag ? false : true;\n        }\n\n    };\n\n    /**\n     * Toolbar button click handler\n     * @param this - cursor to the button\n     */\n    callbacks.toolbarButtonClicked = function (event) {\n\n        var button = this;\n\n        codex.toolbar.current = button.dataset.type;\n\n        codex.toolbar.toolbox.toolClicked(event);\n        codex.toolbar.close();\n\n    };\n\n    callbacks.redactorInputEvent = function (event) {\n\n        /**\n         * Clear previous sync-timeout\n         */\n        if (this.redactorSyncTimeout){\n            clearTimeout(this.redactorSyncTimeout);\n        }\n\n        /**\n         * Start waiting to input finish and sync redactor\n         */\n        this.redactorSyncTimeout = setTimeout(function() {\n\n            codex.content.sync();\n\n        }, 500);\n\n    };\n\n    /** Show or Hide toolbox when plus button is clicked */\n    callbacks.plusButtonClicked = function() {\n\n        if (!codex.nodes.toolbox.classList.contains('opened')) {\n\n            codex.toolbar.toolbox.open();\n\n        } else {\n\n            codex.toolbar.toolbox.close();\n\n        }\n    };\n\n    /**\n     * Block handlers for KeyDown events\n     */\n    callbacks.blockKeydown = function(event, block) {\n\n        switch (event.keyCode){\n\n            case codex.core.keys.DOWN:\n            case codex.core.keys.RIGHT:\n                codex.callback.blockRightOrDownArrowPressed(block);\n                break;\n\n            case codex.core.keys.BACKSPACE:\n                codex.callback.backspacePressed(block);\n                break;\n\n            case codex.core.keys.UP:\n            case codex.core.keys.LEFT:\n                codex.callback.blockLeftOrUpArrowPressed(block);\n                break;\n\n        }\n    };\n\n    /**\n     * RIGHT or DOWN keydowns on block\n     */\n    callbacks.blockRightOrDownArrowPressed = function (block) {\n\n        var selection   = window.getSelection(),\n            inputs      = codex.state.inputs,\n            focusedNode = selection.anchorNode,\n            focusedNodeHolder;\n\n        /** Check for caret existance */\n        if (!focusedNode){\n            return false;\n        }\n\n        /** Looking for closest (parent) contentEditable element of focused node */\n        while (focusedNode.contentEditable != 'true') {\n\n            focusedNodeHolder = focusedNode.parentNode;\n            focusedNode       = focusedNodeHolder;\n        }\n\n        /** Input index in DOM level */\n        var editableElementIndex = 0;\n        while (focusedNode != inputs[editableElementIndex]) {\n            editableElementIndex ++;\n        }\n\n        /**\n         * Founded contentEditable element doesn't have childs\n         * Or maybe New created block\n         */\n        if (!focusedNode.textContent)\n        {\n            codex.caret.setToNextBlock(editableElementIndex);\n            return;\n        }\n\n        /**\n         * Do nothing when caret doesn not reaches the end of last child\n         */\n        var caretInLastChild    = false,\n            caretAtTheEndOfText = false;\n\n        var lastChild,\n            deepestTextnode;\n\n        lastChild = focusedNode.childNodes[focusedNode.childNodes.length - 1 ];\n\n        if (codex.core.isDomNode(lastChild)) {\n\n            deepestTextnode = codex.content.getDeepestTextNodeFromPosition(lastChild, lastChild.childNodes.length);\n\n        } else {\n\n            deepestTextnode = lastChild;\n\n        }\n\n        caretInLastChild = selection.anchorNode == deepestTextnode;\n        caretAtTheEndOfText = deepestTextnode.length == selection.anchorOffset;\n\n        if ( !caretInLastChild  || !caretAtTheEndOfText ) {\n            codex.core.log('arrow [down|right] : caret does not reached the end');\n            return false;\n        }\n\n        codex.caret.setToNextBlock(editableElementIndex);\n\n    };\n\n    /**\n     * LEFT or UP keydowns on block\n     */\n    callbacks.blockLeftOrUpArrowPressed = function (block) {\n\n        var selection   = window.getSelection(),\n            inputs      = codex.state.inputs,\n            focusedNode = selection.anchorNode,\n            focusedNodeHolder;\n\n        /** Check for caret existance */\n        if (!focusedNode){\n            return false;\n        }\n\n        /**\n         * LEFT or UP not at the beginning\n         */\n        if ( selection.anchorOffset !== 0) {\n            return false;\n        }\n\n        /** Looking for parent contentEditable block */\n        while (focusedNode.contentEditable != 'true') {\n            focusedNodeHolder = focusedNode.parentNode;\n            focusedNode       = focusedNodeHolder;\n        }\n\n        /** Input index in DOM level */\n        var editableElementIndex = 0;\n        while (focusedNode != inputs[editableElementIndex]) {\n            editableElementIndex ++;\n        }\n\n        /**\n         * Do nothing if caret is not at the beginning of first child\n         */\n        var caretInFirstChild   = false,\n            caretAtTheBeginning = false;\n\n        var firstChild,\n            deepestTextnode;\n\n        /**\n         * Founded contentEditable element doesn't have childs\n         * Or maybe New created block\n         */\n        if (!focusedNode.textContent) {\n            codex.caret.setToPreviousBlock(editableElementIndex);\n            return;\n        }\n\n        firstChild = focusedNode.childNodes[0];\n\n        if (codex.core.isDomNode(firstChild)) {\n\n            deepestTextnode = codex.content.getDeepestTextNodeFromPosition(firstChild, 0);\n\n        } else {\n\n            deepestTextnode = firstChild;\n\n        }\n\n        caretInFirstChild   = selection.anchorNode == deepestTextnode;\n        caretAtTheBeginning = selection.anchorOffset === 0;\n\n        if ( caretInFirstChild && caretAtTheBeginning ) {\n\n            codex.caret.setToPreviousBlock(editableElementIndex);\n\n        }\n\n    };\n\n    /**\n     * Callback for enter key pressing in first-level block area\n     */\n    callbacks.enterPressedOnBlock = function (event) {\n\n        var NEW_BLOCK_TYPE  = 'paragraph';\n\n        codex.content.insertBlock({\n            type  : NEW_BLOCK_TYPE,\n            block : codex.tools[NEW_BLOCK_TYPE].render()\n        }, true );\n\n        codex.toolbar.move();\n        codex.toolbar.open();\n\n    };\n\n    callbacks.backspacePressed = function (block) {\n\n        var currentInputIndex = codex.caret.getCurrentInputIndex(),\n            range,\n            selectionLength,\n            firstLevelBlocksCount;\n\n        if (block.textContent.trim()) {\n\n            range           = codex.content.getRange();\n            selectionLength = range.endOffset - range.startOffset;\n\n\n            if (codex.caret.position.atStart() && !selectionLength && codex.state.inputs[currentInputIndex - 1]) {\n\n                codex.content.mergeBlocks(currentInputIndex);\n\n            } else {\n\n                return;\n\n            }\n        }\n\n        if (!selectionLength) {\n            block.remove();\n        }\n\n\n        firstLevelBlocksCount = codex.nodes.redactor.childNodes.length;\n\n        /**\n         * If all blocks are removed\n         */\n        if (firstLevelBlocksCount === 0) {\n\n            /** update currentNode variable */\n            codex.content.currentNode = null;\n\n            /** Inserting new empty initial block */\n            codex.ui.addInitialBlock();\n\n            /** Updating inputs state after deleting last block */\n            codex.ui.saveInputs();\n\n            /** Set to current appended block */\n            setTimeout(function () {\n\n                codex.caret.setToPreviousBlock(1);\n\n            }, 10);\n\n        } else {\n\n            if (codex.caret.inputIndex !== 0) {\n\n                /** Target block is not first */\n                codex.caret.setToPreviousBlock(codex.caret.inputIndex);\n\n            } else {\n\n                /** If we try to delete first block */\n                codex.caret.setToNextBlock(codex.caret.inputIndex);\n\n            }\n        }\n\n        codex.toolbar.move();\n\n        if (!codex.toolbar.opened) {\n            codex.toolbar.open();\n        }\n\n        /** Updating inputs state */\n        codex.ui.saveInputs();\n\n        /** Prevent default browser behaviour */\n        event.preventDefault();\n\n    };\n\n    callbacks.blockPaste = function(event) {\n\n        var currentInputIndex = codex.caret.getCurrentInputIndex(),\n            node = codex.state.inputs[currentInputIndex];\n\n        setTimeout(function() {\n\n            codex.content.sanitize(node);\n\n        }, 10);\n\n    };\n\n    callbacks._blockPaste = function(event) {\n\n        var currentInputIndex = codex.caret.getCurrentInputIndex();\n\n        /**\n         * create an observer instance\n         */\n        var observer = new MutationObserver(codex.callback.handlePasteEvents);\n\n        /**\n         * configuration of the observer:\n         */\n        var config = { attributes: true, childList: true, characterData: false };\n\n        // pass in the target node, as well as the observer options\n        observer.observe(codex.state.inputs[currentInputIndex], config);\n    };\n\n    /**\n     * Sends all mutations to paste handler\n     */\n    callbacks.handlePasteEvents = function(mutations) {\n        mutations.forEach(codex.content.paste);\n    };\n\n    /**\n     * Clicks on block settings button\n     */\n    callbacks.showSettingsButtonClicked = function(){\n\n        /**\n         * Get type of current block\n         * It uses to append settings from tool.settings property.\n         * ...\n         * Type is stored in data-type attribute on block\n         */\n        var currentToolType = codex.content.currentNode.dataset.tool;\n\n        codex.toolbar.settings.toggle(currentToolType);\n\n        /** Close toolbox when settings button is active */\n        codex.toolbar.toolbox.close();\n        codex.toolbar.settings.hideRemoveActions();\n\n    };\n\n    return callbacks;\n\n})({});\n\nmodule.exports  = callbacks;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/callbacks.js","/**\n * Codex Editor Draw module\n *\n * @author Codex Team\n * @version 1.0.\n */\n\nvar draw = (function(draw) {\n\n    /**\n     * Base editor wrapper\n     */\n    draw.wrapper = function () {\n\n        var wrapper = document.createElement('div');\n\n        wrapper.className += 'codex-editor';\n\n        return wrapper;\n\n    };\n\n    /**\n     * Content-editable holder\n     */\n    draw.redactor = function () {\n\n        var redactor = document.createElement('div');\n\n        redactor.className += 'ce-redactor';\n\n        return redactor;\n\n    };\n\n    draw.ceBlock = function() {\n\n        var block = document.createElement('DIV');\n\n        block.className += 'ce_block';\n\n        return block;\n\n    };\n\n    /**\n     * Empty toolbar with toggler\n     */\n    draw.toolbar = function () {\n\n        var bar = document.createElement('div');\n\n        bar.className += 'ce-toolbar';\n\n        return bar;\n    };\n\n    draw.toolbarContent = function() {\n\n        var wrapper = document.createElement('DIV');\n        wrapper.classList.add('ce-toolbar__content');\n\n        return wrapper;\n    };\n\n    /**\n     * Inline toolbar\n     */\n    draw.inlineToolbar = function() {\n\n        var bar = document.createElement('DIV');\n\n        bar.className += 'ce-toolbar-inline';\n\n        return bar;\n\n    };\n\n    /**\n     * Wrapper for inline toobar buttons\n     */\n    draw.inlineToolbarButtons = function() {\n\n        var wrapper = document.createElement('DIV');\n\n        wrapper.className += 'ce-toolbar-inline__buttons';\n\n        return wrapper;\n    };\n\n    /**\n     * For some actions\n     */\n    draw.inlineToolbarActions = function() {\n\n        var wrapper = document.createElement('DIV');\n\n        wrapper.className += 'ce-toolbar-inline__actions';\n\n        return wrapper;\n\n    };\n\n    draw.inputForLink = function() {\n\n        var input = document.createElement('INPUT');\n\n        input.type        = 'input';\n        input.className  += 'inputForLink';\n        input.placeholder = 'Type URL ...';\n        input.setAttribute('form', 'defaultForm');\n\n        input.setAttribute('autofocus', 'autofocus');\n\n        return input;\n\n    };\n\n    /**\n     * Block with notifications\n     */\n    draw.alertsHolder = function() {\n\n        var block = document.createElement('div');\n\n        block.classList.add('ce_notifications-block');\n\n        return block;\n\n    };\n\n    /**\n     * @todo Desc\n     */\n    draw.blockButtons = function() {\n\n        var block = document.createElement('div');\n\n        block.className += 'ce-toolbar__actions';\n\n        return block;\n    };\n\n    /**\n     * Block settings panel\n     */\n    draw.blockSettings = function () {\n\n        var settings = document.createElement('div');\n\n        settings.className += 'ce-settings';\n\n        return settings;\n    };\n\n    draw.defaultSettings = function() {\n\n        var div = document.createElement('div');\n\n        div.classList.add('ce-settings_default');\n\n        return div;\n    },\n\n    draw.pluginsSettings = function() {\n\n        var div = document.createElement('div');\n\n        div.classList.add('ce-settings_plugin');\n\n        return div;\n\n    };\n\n    draw.plusButton = function() {\n\n        var button = document.createElement('span');\n\n        button.className = 'ce-toolbar__plus';\n        // button.innerHTML = '<i class=\"ce-icon-plus\"></i>';\n\n        return button;\n    };\n\n    /**\n     * Settings button in toolbar\n     */\n    draw.settingsButton = function () {\n\n        var toggler = document.createElement('span');\n\n        toggler.className = 'ce-toolbar__settings-btn';\n\n        /** Toggler button*/\n        toggler.innerHTML = '<i class=\"ce-icon-cog\"></i>';\n\n        return toggler;\n    };\n\n    /**\n     * Redactor tools wrapper\n     */\n\n    draw.toolbox = function() {\n\n        var wrapper = document.createElement('div');\n\n        wrapper.className = 'ce-toolbar__tools';\n\n        return wrapper;\n    };\n\n    /**\n     * @protected\n     *\n     * Draws tool buttons for toolbox\n     *\n     * @param {String} type\n     * @param {String} classname\n     * @returns {Element}\n     */\n    draw.toolbarButton = function (type, classname) {\n\n        var button     = document.createElement(\"li\"),\n            tool_icon  = document.createElement(\"i\"),\n            tool_title = document.createElement(\"span\");\n\n        button.dataset.type = type;\n        button.setAttribute('title', type);\n\n        tool_icon.classList.add(classname);\n        tool_title.classList.add('ce_toolbar_tools--title');\n\n\n        button.appendChild(tool_icon);\n        button.appendChild(tool_title);\n\n        return button;\n\n    };\n\n    /**\n     * @protected\n     *\n     * Draws tools for inline toolbar\n     *\n     * @param {String} type\n     * @param {String} classname\n     */\n    draw.toolbarButtonInline = function(type, classname) {\n        var button     = document.createElement(\"BUTTON\"),\n            tool_icon  = document.createElement(\"I\");\n\n        button.type = \"button\";\n        button.dataset.type = type;\n        tool_icon.classList.add(classname);\n\n        button.appendChild(tool_icon);\n\n        return button;\n    };\n\n    /**\n     * Redactor block\n     */\n    draw.block = function (tagName, content) {\n\n        var node = document.createElement(tagName);\n\n        node.innerHTML = content || '';\n\n        return node;\n\n    };\n\n    /**\n     * Creates Node with passed tagName and className\n     * @param {string}  tagName\n     * @param {string} className\n     * @param {object} properties - allow to assign properties\n     */\n    draw.node = function( tagName , className , properties ){\n\n        var el = document.createElement( tagName );\n\n        if ( className ) el.className = className;\n\n        if ( properties ) {\n\n            for (var name in properties){\n                el[name] = properties[name];\n            }\n        }\n\n        return el;\n    };\n\n    draw.pluginsRender = function(type, content) {\n\n        return {\n            type  : type,\n            block : cEditor.tools[type].render({\n                text : content\n            })\n        };\n    };\n\n    return draw;\n\n})({});\n\nmodule.exports = draw;\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./modules/draw.js","/**\n * Codex Editor Caret Module\n *\n * @author Codex Team\n * @version 1.0\n */\n\nvar caret = (function(caret) {\n\n    /**\n     * @var {int} InputIndex - editable element in DOM\n     */\n    caret.inputIndex = null;\n\n    /**\n     * @var {int} offset - caret position in a text node.\n     */\n    caret.offset = null;\n\n    /**\n     * @var {int} focusedNodeIndex - we get index of child node from first-level block\n     */\n    caret.focusedNodeIndex = null;\n\n    /**\n     * Creates Document Range and sets caret to the element.\n     * @protected\n     * @uses caret.save  if you need to save caret position\n     * @param {Element} el - Changed Node.\n     */\n    caret.set = function( el , index, offset) {\n\n        offset = offset || this.offset || 0;\n        index  = index  || this.focusedNodeIndex || 0;\n\n        var childs = el.childNodes,\n            nodeToSet;\n\n        if ( childs.length === 0 ) {\n\n            nodeToSet = el;\n\n        } else {\n\n            nodeToSet = childs[index];\n\n        }\n\n        /** If Element is INPUT */\n        if (el.tagName == 'INPUT') {\n            el.focus();\n            return;\n        }\n\n        if (codex.core.isDomNode(nodeToSet)) {\n\n            nodeToSet = codex.content.getDeepestTextNodeFromPosition(nodeToSet, nodeToSet.childNodes.length);\n        }\n\n        var range     = document.createRange(),\n            selection = window.getSelection();\n\n        setTimeout(function() {\n\n            range.setStart(nodeToSet, offset);\n            range.setEnd(nodeToSet, offset);\n\n            selection.removeAllRanges();\n            selection.addRange(range);\n\n            codex.caret.saveCurrentInputIndex();\n\n        }, 20);\n    };\n\n    /**\n     * @protected\n     * Updates index of input and saves it in caret object\n     */\n    caret.saveCurrentInputIndex = function () {\n\n        /** Index of Input that we paste sanitized content */\n        var selection   = window.getSelection(),\n            inputs      = codex.state.inputs,\n            focusedNode = selection.anchorNode,\n            focusedNodeHolder;\n\n        if (!focusedNode){\n            return;\n        }\n\n        /** Looking for parent contentEditable block */\n        while (focusedNode.contentEditable != 'true') {\n            focusedNodeHolder = focusedNode.parentNode;\n            focusedNode       = focusedNodeHolder;\n        }\n\n        /** Input index in DOM level */\n        var editableElementIndex = 0;\n\n        while (focusedNode != inputs[editableElementIndex]) {\n            editableElementIndex ++;\n        }\n\n        this.inputIndex = editableElementIndex;\n    };\n\n    /**\n     * Returns current input index (caret object)\n     */\n    caret.getCurrentInputIndex = function() {\n        return this.inputIndex;\n    };\n\n    /**\n     * @param {int} index - index of first-level block after that we set caret into next input\n     */\n    caret.setToNextBlock = function(index) {\n\n        var inputs = codex.state.inputs,\n            nextInput = inputs[index + 1];\n\n        if (!nextInput) {\n            codex.core.log('We are reached the end');\n            return;\n        }\n\n        /**\n         * When new Block created or deleted content of input\n         * We should add some text node to set caret\n         */\n        if (!nextInput.childNodes.length) {\n            var emptyTextElement = document.createTextNode('');\n            nextInput.appendChild(emptyTextElement);\n        }\n\n        codex.caret.inputIndex = index + 1;\n        codex.caret.set(nextInput, 0, 0);\n        codex.content.workingNodeChanged(nextInput);\n\n    };\n\n    /**\n     * @param {int} index - index of target input.\n     * Sets caret to input with this index\n     */\n    caret.setToBlock = function(index) {\n\n        var inputs = codex.state.inputs,\n            targetInput = inputs[index];\n\n        console.assert( targetInput , 'caret.setToBlock: target input does not exists');\n\n        if ( !targetInput ) {\n            return;\n        }\n\n        /**\n         * When new Block created or deleted content of input\n         * We should add some text node to set caret\n         */\n        if (!targetInput.childNodes.length) {\n            var emptyTextElement = document.createTextNode('');\n            targetInput.appendChild(emptyTextElement);\n        }\n\n        codex.caret.inputIndex = index;\n        codex.caret.set(targetInput, 0, 0);\n        codex.content.workingNodeChanged(targetInput);\n\n    };\n\n    /**\n     * @param {int} index - index of input\n     */\n    caret.setToPreviousBlock = function(index) {\n\n        index = index || 0;\n\n        var inputs = codex.state.inputs,\n            previousInput = inputs[index - 1],\n            lastChildNode,\n            lengthOfLastChildNode,\n            emptyTextElement;\n\n\n        if (!previousInput) {\n            codex.core.log('We are reached first node');\n            return;\n        }\n\n        lastChildNode = codex.content.getDeepestTextNodeFromPosition(previousInput, previousInput.childNodes.length);\n        lengthOfLastChildNode = lastChildNode.length;\n\n        /**\n         * When new Block created or deleted content of input\n         * We should add some text node to set caret\n         */\n        if (!previousInput.childNodes.length) {\n\n            emptyTextElement = document.createTextNode('');\n            previousInput.appendChild(emptyTextElement);\n        }\n        codex.caret.inputIndex = index - 1;\n        codex.caret.set(previousInput, previousInput.childNodes.length - 1, lengthOfLastChildNode);\n        codex.content.workingNodeChanged(inputs[index - 1]);\n    };\n\n    caret.position = {\n\n        atStart : function() {\n\n            var selection       = window.getSelection(),\n                anchorOffset    = selection.anchorOffset,\n                anchorNode      = selection.anchorNode,\n                firstLevelBlock = codex.content.getFirstLevelBlock(anchorNode),\n                pluginsRender   = firstLevelBlock.childNodes[0];\n\n            if (!codex.core.isDomNode(anchorNode)) {\n                anchorNode = anchorNode.parentNode;\n            }\n\n            var isFirstNode  = anchorNode === pluginsRender.childNodes[0],\n                isOffsetZero = anchorOffset === 0;\n\n            return isFirstNode && isOffsetZero;\n\n        },\n\n        atTheEnd : function() {\n\n            var selection    = window.getSelection(),\n                anchorOffset = selection.anchorOffset,\n                anchorNode   = selection.anchorNode;\n\n            /** Caret is at the end of input */\n            return !anchorNode || !anchorNode.length || anchorOffset === anchorNode.length;\n        }\n    };\n\n    return caret;\n\n})({});\n\nmodule.exports = caret;\n\n\n// WEBPACK FOOTER //\n// ./modules/caret.js","/**\n * Codex Editor Notification Module\n *\n * @author Codex Team\n * @version 1.0\n */\n\nvar notifications = (function(notifications) {\n\n    /**\n     * Error notificator. Shows block with message\n     * @protected\n     */\n    notifications.errorThrown = function(errorMsg, event) {\n\n        codex.notifications.send('This action is not available currently', event.type, false);\n\n    };\n\n    /**\n     * Appends notification with different types\n     * @param message {string} - Error or alert message\n     * @param type {string} - Type of message notification. Ex: Error, Warning, Danger ...\n     * @param append {boolean} - can be True or False when notification should be inserted after\n     */\n    notifications.send = function(message, type, append) {\n\n        var notification = codex.draw.block('div');\n\n        notification.textContent = message;\n        notification.classList.add('ce_notification-item', 'ce_notification-' + type, 'flipInX');\n\n        if (!append) {\n            codex.nodes.notifications.innerHTML = '';\n        }\n\n        codex.nodes.notifications.appendChild(notification);\n\n        setTimeout(function () {\n            notification.remove();\n        }, 3000);\n\n    };\n\n    return notifications;\n\n})({});\n\nmodule.exports = notifications;\n\n\n// WEBPACK FOOTER //\n// ./modules/notifications.js","/**\n * Codex Editor Parser Module\n *\n * @author Codex Team\n * @version 1.0\n */\n\nvar parser = (function(parser) {\n\n    /**\n     * Splits content by `\\n` and returns blocks\n     */\n    parser.getSeparatedTextFromContent = function(content) {\n        return content.split('\\n');\n    };\n\n    /** inserting text */\n    parser.insertPastedContent = function(content) {\n\n        var blocks = this.getSeparatedTextFromContent(content),\n            i,\n            inputIndex = cEditor.caret.getCurrentInputIndex(),\n            textNode,\n            parsedTextContent;\n\n        for(i = 0; i < blocks.length; i++) {\n\n            blocks[i].trim();\n\n            if (blocks[i]) {\n                var data = cEditor.draw.pluginsRender('paragraph', blocks[i]);\n                cEditor.content.insertBlock(data);\n            }\n        }\n\n    };\n\n    /**\n     * Asynchronously parses textarea input string to HTML editor blocks\n     */\n    parser.parseTextareaContent = function () {\n\n        var initialContent = cEditor.nodes.textarea.value;\n\n        if ( initialContent.trim().length === 0 ) return true;\n\n\n        cEditor.parser\n\n        /** Get child nodes async-aware */\n            .getNodesFromString(initialContent)\n\n            /** Then append nodes to the redactor */\n            .then(cEditor.parser.appendNodesToRedactor)\n\n            /** Write log if something goes wrong */\n            .catch(function(error) {\n                cEditor.core.log('Error while parsing content: %o', 'warn', error);\n            });\n\n    };\n\n    /**\n     * Parses string to nodeList\n     * @param string inputString\n     * @return Primise -> nodeList\n     */\n    parser.getNodesFromString = function (inputString) {\n\n        return Promise.resolve().then(function() {\n\n            var contentHolder = document.createElement('div');\n\n            contentHolder.innerHTML = inputString;\n\n            /**\n             *    Returning childNodes will include:\n             *        - Elements (html-tags),\n             *        - Texts (empty-spaces or non-wrapped strings )\n             *        - Comments and other\n             */\n            return contentHolder.childNodes;\n\n        });\n    };\n\n    /**\n     * Appends nodes to the redactor\n     * @param nodeList nodes - list for nodes to append\n     */\n    parser.appendNodesToRedactor = function(nodes) {\n\n        /**\n         * Sequence of one-by-one nodes appending\n         * Uses to save blocks order after async-handler\n         */\n        var nodeSequence = Promise.resolve();\n\n\n        for (var index = 0; index < nodes.length ; index++ ) {\n\n            /** Add node to sequence at specified index */\n            cEditor.parser.appendNodeAtIndex(nodeSequence, nodes, index);\n\n        }\n\n    };\n\n    /**\n     * Append node at specified index\n     */\n    parser.appendNodeAtIndex = function (nodeSequence, nodes, index) {\n\n        /** We need to append node to sequence */\n        nodeSequence\n\n        /** first, get node async-aware */\n            .then(function() {\n\n                return cEditor.parser.getNodeAsync(nodes , index);\n\n            })\n\n            /**\n             *    second, compose editor-block from node\n             *    and append it to redactor\n             */\n            .then(function(node){\n\n                var block = cEditor.parser.createBlockByDomNode(node);\n\n                if ( cEditor.core.isDomNode(block) ) {\n\n                    block.contentEditable = \"true\";\n\n                    /** Mark node as redactor block*/\n                    block.classList.add('ce-block');\n\n                    /** Append block to the redactor */\n                    cEditor.nodes.redactor.appendChild(block);\n\n                    /** Save block to the cEditor.state array */\n                    cEditor.state.blocks.push(block);\n\n                    return block;\n\n                }\n                return null;\n            })\n\n            .then(cEditor.ui.addBlockHandlers)\n\n            /** Log if something wrong with node */\n            .catch(function(error) {\n                cEditor.core.log('Node skipped while parsing because %o', 'warn', error);\n            });\n\n    };\n\n    /**\n     * Asynchronously returns node from nodeList by index\n     * @return Promise to node\n     */\n    parser.getNodeAsync = function (nodeList, index) {\n\n        return Promise.resolve().then(function() {\n\n            return nodeList.item(index);\n\n        });\n    };\n\n    /**\n     * Creates editor block by DOM node\n     *\n     * First-level blocks (see cEditor.settings.blockTags) saves as-is,\n     * other wrapps with <p>-tag\n     *\n     * @param DOMnode node\n     * @return First-level node (paragraph)\n     */\n    parser.createBlockByDomNode = function (node) {\n\n        /** First level nodes already appears as blocks */\n        if ( cEditor.parser.isFirstLevelBlock(node) ){\n\n            /** Save plugin type in data-type */\n            node = this.storeBlockType(node);\n\n            return node;\n        }\n\n        /** Other nodes wraps into parent block (paragraph-tag) */\n        var parentBlock,\n            nodeContent     = node.textContent.trim(),\n            isPlainTextNode = node.nodeType != cEditor.core.nodeTypes.TAG;\n\n\n        /** Skip empty textNodes with space-symbols */\n        if (isPlainTextNode && !nodeContent.length) return null;\n\n        /** Make <p> tag */\n        parentBlock = cEditor.draw.block('P');\n\n        if (isPlainTextNode){\n            parentBlock.textContent = nodeContent.replace(/(\\s){2,}/, '$1'); // remove double spaces\n        } else {\n            parentBlock.appendChild(node);\n        }\n\n        /** Save plugin type in data-type */\n        parentBlock = this.storeBlockType(parentBlock);\n\n        return parentBlock;\n\n    };\n\n    /**\n     * It's a crutch\n     * - - - - - - -\n     * We need block type stored as data-attr\n     * Now supports only simple blocks : P, HEADER, QUOTE, CODE\n     * Remove it after updating parser module for the block-oriented structure:\n     *       - each block must have stored type\n     * @param {Element} node\n     */\n    parser.storeBlockType = function (node) {\n\n        switch (node.tagName) {\n            case 'P' :          node.dataset.tool = 'paragraph'; break;\n            case 'H1':\n            case 'H2':\n            case 'H3':\n            case 'H4':\n            case 'H5':\n            case 'H6':          node.dataset.tool = 'header'; break;\n            case 'BLOCKQUOTE':  node.dataset.tool = 'quote'; break;\n            case 'CODE':        node.dataset.tool = 'code'; break;\n        }\n\n        return node;\n\n    };\n\n    /**\n     * Check DOM node for display style: separated block or child-view\n     */\n    parser.isFirstLevelBlock = function (node) {\n\n        return node.nodeType == cEditor.core.nodeTypes.TAG &&\n            node.classList.contains(cEditor.ui.className.BLOCK_CLASSNAME);\n\n    };\n\n    return parser;\n\n})({});\n\nmodule.exports = parser;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/parser.js","/**\n * Copyright (c) 2010 by Gabriel Birke\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the 'Software'), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\nfunction Sanitize(){\n    var i, e, options;\n    options = arguments[0] || {};\n    this.config = {};\n    this.config.elements = options.elements ? options.elements : [];\n    this.config.attributes = options.attributes ? options.attributes : {};\n    this.config.attributes[Sanitize.ALL] = this.config.attributes[Sanitize.ALL] ? this.config.attributes[Sanitize.ALL] : [];\n    this.config.allow_comments = options.allow_comments ? options.allow_comments : false;\n    this.allowed_elements = {};\n    this.config.protocols = options.protocols ? options.protocols : {};\n    this.config.add_attributes = options.add_attributes ? options.add_attributes  : {};\n    this.dom = options.dom ? options.dom : document;\n    for(i=0;i<this.config.elements.length;i++) {\n        this.allowed_elements[this.config.elements[i]] = true;\n    }\n    this.config.remove_element_contents = {};\n    this.config.remove_all_contents = false;\n    if(options.remove_contents) {\n\n        if(options.remove_contents instanceof Array) {\n            for(i=0;i<options.remove_contents.length;i++) {\n                this.config.remove_element_contents[options.remove_contents[i]] = true;\n            }\n        }\n        else {\n            this.config.remove_all_contents = true;\n        }\n    }\n    this.transformers = options.transformers ? options.transformers : [];\n}\n\nSanitize.REGEX_PROTOCOL = /^([A-Za-z0-9\\+\\-\\.\\&\\;\\*\\s]*?)(?:\\:|&*0*58|&*x0*3a)/i;\n\n// emulate Ruby symbol with string constant\nSanitize.RELATIVE = '__RELATIVE__';\nSanitize.ALL = '__ALL__';\n\nSanitize.prototype.clean_node = function(container) {\n    var fragment = this.dom.createDocumentFragment();\n    this.current_element = fragment;\n    this.whitelist_nodes = [];\n\n\n\n    /**\n     * Utility function to check if an element exists in an array\n     */\n    function _array_index(needle, haystack) {\n        var i;\n        for(i=0; i < haystack.length; i++) {\n            if(haystack[i] == needle)\n                return i;\n        }\n        return -1;\n    }\n\n    function _merge_arrays_uniq() {\n        var result = [];\n        var uniq_hash = {};\n        var i,j;\n        for(i=0;i<arguments.length;i++) {\n            if(!arguments[i] || !arguments[i].length)\n                continue;\n            for(j=0;j<arguments[i].length;j++) {\n                if(uniq_hash[arguments[i][j]])\n                    continue;\n                uniq_hash[arguments[i][j]] = true;\n                result.push(arguments[i][j]);\n            }\n        }\n        return result;\n    }\n\n    /**\n     * Clean function that checks the different node types and cleans them up accordingly\n     * @param elem DOM Node to clean\n     */\n    function _clean(elem) {\n        var clone;\n        switch(elem.nodeType) {\n            // Element\n            case 1:\n                _clean_element.call(this, elem);\n                break;\n            // Text\n            case 3:\n                clone = elem.cloneNode(false);\n                this.current_element.appendChild(clone);\n                break;\n            // Entity-Reference (normally not used)\n            case 5:\n                clone = elem.cloneNode(false);\n                this.current_element.appendChild(clone);\n                break;\n            // Comment\n            case 8:\n                if(this.config.allow_comments) {\n                    clone = elem.cloneNode(false);\n                    this.current_element.appendChild(clone);\n                }\n                break;\n            default:\n                if (console && console.log) console.log(\"unknown node type\", elem.nodeType);\n                break;\n        }\n\n    }\n\n    function _clean_element(elem) {\n        var i, j, clone, parent_element, name, allowed_attributes, attr, attr_name, attr_node, protocols, del, attr_ok;\n        var transform = _transform_element.call(this, elem);\n\n        elem = transform.node;\n        name = elem.nodeName.toLowerCase();\n\n        // check if element itself is allowed\n        parent_element = this.current_element;\n        if(this.allowed_elements[name] || transform.whitelist) {\n            this.current_element = this.dom.createElement(elem.nodeName);\n            parent_element.appendChild(this.current_element);\n\n            // clean attributes\n            var attrs = this.config.attributes;\n            allowed_attributes = _merge_arrays_uniq(attrs[name], attrs[Sanitize.ALL], transform.attr_whitelist);\n            for(i=0;i<allowed_attributes.length;i++) {\n                attr_name = allowed_attributes[i];\n                attr = elem.attributes[attr_name];\n                if(attr) {\n                    attr_ok = true;\n                    // Check protocol attributes for valid protocol\n                    if(this.config.protocols[name] && this.config.protocols[name][attr_name]) {\n                        protocols = this.config.protocols[name][attr_name];\n                        del = attr.value.toLowerCase().match(Sanitize.REGEX_PROTOCOL);\n                        if(del) {\n                            attr_ok = (_array_index(del[1], protocols) != -1);\n                        }\n                        else {\n                            attr_ok = (_array_index(Sanitize.RELATIVE, protocols) != -1);\n                        }\n                    }\n                    if(attr_ok) {\n                        attr_node = document.createAttribute(attr_name);\n                        attr_node.value = attr.value;\n                        this.current_element.setAttributeNode(attr_node);\n                    }\n                }\n            }\n\n            // Add attributes\n            if(this.config.add_attributes[name]) {\n                for(attr_name in this.config.add_attributes[name]) {\n                    attr_node = document.createAttribute(attr_name);\n                    attr_node.value = this.config.add_attributes[name][attr_name];\n                    this.current_element.setAttributeNode(attr_node);\n                }\n            }\n        } // End checking if element is allowed\n        // If this node is in the dynamic whitelist array (built at runtime by\n        // transformers), let it live with all of its attributes intact.\n        else if(_array_index(elem, this.whitelist_nodes) != -1) {\n            this.current_element = elem.cloneNode(true);\n            // Remove child nodes, they will be sanitiazied and added by other code\n            while(this.current_element.childNodes.length > 0) {\n                this.current_element.removeChild(this.current_element.firstChild);\n            }\n            parent_element.appendChild(this.current_element);\n        }\n\n        // iterate over child nodes\n        if(!this.config.remove_all_contents && !this.config.remove_element_contents[name]) {\n            for(i=0;i<elem.childNodes.length;i++) {\n                _clean.call(this, elem.childNodes[i]);\n            }\n        }\n\n        // some versions of IE don't support normalize.\n        if(this.current_element.normalize) {\n            this.current_element.normalize();\n        }\n        this.current_element = parent_element;\n    } // END clean_element function\n\n    function _transform_element(node) {\n        var output = {\n            attr_whitelist:[],\n            node: node,\n            whitelist: false\n        };\n        var i, j, transform;\n        for(i=0;i<this.transformers.length;i++) {\n            transform = this.transformers[i]({\n                allowed_elements: this.allowed_elements,\n                config: this.config,\n                node: node,\n                node_name: node.nodeName.toLowerCase(),\n                whitelist_nodes: this.whitelist_nodes,\n                dom: this.dom\n            });\n            if (transform == null)\n                continue;\n            else if(typeof transform == 'object') {\n                if(transform.whitelist_nodes && transform.whitelist_nodes instanceof Array) {\n                    for(j=0;j<transform.whitelist_nodes.length;j++) {\n                        if(_array_index(transform.whitelist_nodes[j], this.whitelist_nodes) == -1) {\n                            this.whitelist_nodes.push(transform.whitelist_nodes[j]);\n                        }\n                    }\n                }\n                output.whitelist = transform.whitelist ? true : false;\n                if(transform.attr_whitelist) {\n                    output.attr_whitelist = _merge_arrays_uniq(output.attr_whitelist, transform.attr_whitelist);\n                }\n                output.node = transform.node ? transform.node : output.node;\n            }\n            else {\n                throw new Error(\"transformer output must be an object or null\");\n            }\n        }\n        return output;\n    }\n\n\n\n    for(i=0;i<container.childNodes.length;i++) {\n        _clean.call(this, container.childNodes[i]);\n    }\n\n    if(fragment.normalize) {\n        fragment.normalize();\n    }\n\n    return fragment;\n\n};\n\nif ( typeof define === \"function\" ) {\n    define( \"sanitize\", [], function () { return Sanitize; } );\n}\n\nrequire('./config/basic');\nrequire('./config/relaxed');\nrequire('./config/restricted');\n\nmodule.exports = Sanitize;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/sanitizer/sanitize.js","var Sanitize = require('../sanitize');\n\nif (!Sanitize.Config) {\n    Sanitize.Config = {};\n}\n\nSanitize.Config.BASIC = {\n    elements: [\n        'a', 'b', 'blockquote', 'br', 'cite', 'code', 'dd', 'dl', 'dt', 'em',\n        'i', 'li', 'ol', 'p', 'pre', 'q', 'small', 'strike', 'strong', 'sub',\n        'sup', 'u', 'ul'],\n    attributes: {\n        'a'         : ['href'],\n        'blockquote': ['cite'],\n        'q'         : ['cite']\n    },\n\n    add_attributes: {\n        'a': {'rel': 'nofollow'}\n    },\n\n    protocols: {\n        'a'         : {'href': ['ftp', 'http', 'https', 'mailto', Sanitize.RELATIVE]},\n        'blockquote': {'cite': ['http', 'https', Sanitize.RELATIVE]},\n        'q'         : {'cite': ['http', 'https', Sanitize.RELATIVE]}\n    }\n};\n\ncodex.sanitizer = Sanitize;\n\n\n// WEBPACK FOOTER //\n// ./modules/sanitizer/config/basic.js","var Sanitize = require('../sanitize');\n\nif (!Sanitize.Config) {\n    Sanitize.Config = {};\n}\n\nSanitize.Config.RELAXED = {\n    elements: ['a', 'b', 'blockquote', 'br', 'caption', 'cite', 'code', 'col',\n        'colgroup', 'dd', 'dl', 'dt', 'em', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',\n        'i', 'img', 'li', 'ol', 'p', 'pre', 'q', 'small', 'strike', 'strong',\n        'sub', 'sup', 'table', 'tbody', 'td', 'tfoot', 'th', 'thead', 'tr', 'u',\n        'ul'],\n    attributes: {\n        'a'         : ['href', 'title'],\n        'blockquote': ['cite'],\n        'col'       : ['span', 'width'],\n        'colgroup'  : ['span', 'width'],\n        'img'       : ['align', 'alt', 'height', 'src', 'title', 'width'],\n        'ol'        : ['start', 'type'],\n        'q'         : ['cite'],\n        'table'     : ['summary', 'width'],\n        'td'        : ['abbr', 'axis', 'colspan', 'rowspan', 'width'],\n        'th'        : ['abbr', 'axis', 'colspan', 'rowspan', 'scope',\n                         'width'],\n        'ul'        : ['type']\n    },\n    protocols: {\n        'a'         : {'href': ['ftp', 'http', 'https', 'mailto', Sanitize.RELATIVE]},\n        'blockquote': {'cite': ['http', 'https', Sanitize.RELATIVE]},\n        'img'       : {'src' : ['http', 'https', Sanitize.RELATIVE]},\n        'q'         : {'cite': ['http', 'https', Sanitize.RELATIVE]}\n    }\n};\n\ncodex.sanitizer = Sanitize;\n\n\n// WEBPACK FOOTER //\n// ./modules/sanitizer/config/relaxed.js","var Sanitize = require('../sanitize');\n\nif (!Sanitize.Config) {\n    Sanitize.Config = {};\n}\n\nSanitize.Config.RESTRICTED = {\n    elements: ['a', 'b', 'em', 'i', 'strong', 'u']\n};\n\ncodex.sanitizer = Sanitize;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/sanitizer/config/restricted.js"],"sourceRoot":""}