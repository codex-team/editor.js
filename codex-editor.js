var codex=codex||{};codex.editor=function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";e.exports=function(e){e.version="1.4.8",e.currentHash=null;var t=function(){e.core=n(1),e.tools=n(2),e.ui=n(3),e.transport=n(4),e.renderer=n(5),e.saver=n(6),e.content=n(7),e.toolbar=n(8),e.callback=n(12),e.draw=n(13),e.caret=n(14),e.notifications=n(15),e.parser=n(16),e.sanitizer=n(17),e.anchors=n(19)};return e.settings={tools:["paragraph","header","picture","list","quote","code","twitter","instagram","smile"],textareaId:"codex-editor",uploadImagesUrl:"/editor/transport/",initialBlockPlugin:"paragraph"},e.nodes={textarea:null,wrapper:null,toolbar:null,inlineToolbar:{wrapper:null,buttons:null,actions:null},toolbox:null,notifications:null,plusButton:null,showSettingsButton:null,showTrashButton:null,blockSettings:null,pluginSettings:null,defaultSettings:null,toolbarButtons:{},redactor:null},e.state={jsonOutput:[],savingDate:null,hash:null,blocks:[],inputs:[]},e.tools={},e.start=function(n){t(),e.core.prepare(n).then(e.ui.make).then(e.ui.addTools).then(e.ui.bindEvents).then(e.tools.prepare).then(e.transport.prepare).then(e.renderer.makeBlocksFromData).then(e.ui.saveInputs).catch(function(t){e.core.log("Initialization failed with error: %o","warn",t)})},e}({})},function(e,t){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=codex.editor;e.exports=function(e){return e.prepare=function(e){return new Promise(function(t,r){e&&(o.settings.tools=e.tools||o.settings.tools),e.data&&(o.state.blocks=e.data,o.currentHash=e.data.hash||+new Date),e.initialBlockPlugin&&(o.settings.initialBlockPlugin=e.initialBlockPlugin),e.uploadImagesUrl&&(o.settings.uploadImagesUrl=e.uploadImagesUrl),o.nodes.textarea=document.getElementById(e.textareaId||o.settings.textareaId),void 0===n(o.nodes.textarea)||null===o.nodes.textarea?r(Error("Textarea wasn't found by ID: #"+e.textareaId)):t()})},e.log=function(e,t,n){t=t||"log",n?e="[codex-editor]:      "+e:(n=e||"undefined",e="[codex-editor]:      %o");try{"console"in window&&window.console[t]&&(n?window.console[t](e,n):window.console[t](e))}catch(e){}},e.insertAfter=function(e,t){e.parentNode.insertBefore(t,e.nextSibling)},e.nodeTypes={TAG:1,TEXT:3,COMMENT:8},e.keys={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,LEFT:37,UP:38,DOWN:40,RIGHT:39,DELETE:46,META:91},e.isDomNode=function(e){return e&&"object"===("undefined"==typeof e?"undefined":n(e))&&e.nodeType&&e.nodeType==this.nodeTypes.TAG},e.isEmpty=function(e){return 0===Object.keys(e).length},e.ajax=function(e){if(e&&e.url){var t,n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),o=function(){},r="";if(e.async=!0,e.type=e.type||"GET",e.data=e.data||"",e["content-type"]=e["content-type"]||"application/json; charset=utf-8",o=e.success||o,"GET"==e.type&&e.data)e.url=/\?/.test(e.url)?e.url+"&"+e.data:e.url+"?"+e.data;else for(t in e.data)r+=t+"="+encodeURIComponent(e.data[t])+"&";e.withCredentials&&(n.withCredentials=!0),e.beforeSend&&"function"==typeof e.beforeSend&&e.beforeSend.call(),n.open(e.type,e.url,e.async),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){4==n.readyState&&200==n.status&&o(n.responseText)},n.send(r)}},e.importScript=function(e,t){return new Promise(function(n,o){var r="cdx-script-",i=void 0;t?document.getElementById(r+t)&&n(e):o("Instance name is missed"),i=document.createElement("SCRIPT"),i.async=!0,i.defer=!0,i.id=r+t,i.onload=function(){n(e)},i.onerror=function(){o(e)},i.src=e,document.head.appendChild(i)})},e}({})},function(e,t){"use strict";e.exports=function(){function e(){return new Promise(function(e,o){Promise.resolve().then(function(){var t=[],o=n.tools;for(var r in o){var i=o[r];i.prepare&&"function"!=typeof i.prepare||!i.prepare||t.push(i)}return t.length||e(),t}).then(t).then(function(){n.core.log("Plugins loaded","info"),e()}).catch(function(e){o(e)})})}function t(e){return new Promise(function(t){e.reduce(function(r,i,a){return r.then(function(){return new Promise(function(r){o(i).then(r).then(function(){i.available=!0}).catch(function(e){n.core.log("Plugin «"+i.type+"» was not loaded. Preparation failed because %o","warn",e),i.available=!1,i.loadingMessage=e,r()}).then(function(){a==e.length-1&&t()})})})},Promise.resolve())})}var n=codex.editor,o=function(e){return e.prepare(e.config||{})};return{prepare:e}}()},function(e,t){"use strict";var n=codex.editor;e.exports=function(e){return e.className={BLOCK_CLASSNAME:"ce-block",BLOCK_CONTENT:"ce-block__content",BLOCK_STRETCHED:"ce-block--stretched",BLOCK_HIGHLIGHTED:"ce-block--focused",BLOCK_IN_FEED_MODE:"ce-block--feed-mode",BLOCK_WITH_ANCHOR:"ce-block--anchor",SETTINGS_ITEM:"ce-settings__item"},e.make=function(){var e,t,o,r,i,a,s,c,l,d;e=n.draw.wrapper(),n.core.insertAfter(n.nodes.textarea,e),n.notifications.createHolder(),t=n.draw.toolbar(),o=n.draw.toolbarContent(),d=n.draw.plusButton(),s=n.draw.settingsButton(),c=n.toolbar.settings.makeRemoveBlockButton(),a=n.draw.blockSettings(),i=n.draw.blockButtons(),l=n.draw.toolbox(),r=n.draw.redactor();var u=n.draw.defaultSettings(),p=n.draw.pluginsSettings();a.appendChild(p),a.appendChild(u),i.appendChild(s),i.appendChild(c),i.appendChild(a),o.appendChild(d),o.appendChild(l),t.appendChild(i),t.appendChild(o),e.appendChild(t),e.appendChild(r),n.nodes.wrapper=e,n.nodes.toolbar=t,n.nodes.plusButton=d,n.nodes.toolbox=l,n.nodes.blockSettings=a,n.nodes.pluginSettings=p,n.nodes.defaultSettings=u,n.nodes.showSettingsButton=s,n.nodes.showTrashButton=c,n.nodes.redactor=r,n.ui.makeInlineToolbar(),n.toolbar.settings.addDefaultSettings()},e.makeInlineToolbar=function(){var e=n.draw.inlineToolbar();n.nodes.inlineToolbar.wrapper=e,n.nodes.inlineToolbar.buttons=n.draw.inlineToolbarButtons(),n.nodes.inlineToolbar.actions=n.draw.inlineToolbarActions(),n.nodes.inlineToolbar.wrapper.appendChild(n.nodes.inlineToolbar.buttons),n.nodes.inlineToolbar.wrapper.appendChild(n.nodes.inlineToolbar.actions),n.nodes.wrapper.appendChild(n.nodes.inlineToolbar.wrapper)},e.addTools=function(){var e,t,o;for(t in n.settings.tools)e=n.settings.tools[t],n.tools[t]=e,e.iconClassname?"function"==typeof e.render?e.displayInToolbox&&(o=n.draw.toolbarButton(t,e.iconClassname),n.nodes.toolbox.appendChild(o),n.nodes.toolbarButtons[t]=o):n.core.log("render method missed. Tool %o skipped","warn",t):n.core.log("Toolbar icon classname missed. Tool %o skipped","warn",t);n.ui.addInlineToolbarTools()},e.addInlineToolbarTools=function(){var e,t,o={bold:{icon:"ce-icon-bold",command:"bold"},italic:{icon:"ce-icon-italic",command:"italic"},underline:{icon:"ce-icon-underline",command:"underline"},link:{icon:"ce-icon-link",command:"createLink"}};for(var r in o)t=o[r],e=n.draw.toolbarButtonInline(r,t.icon),n.nodes.inlineToolbar.buttons.appendChild(e),n.ui.setInlineToolbarButtonBehaviour(e,t.command)},e.bindEvents=function(){n.core.log("ui.bindEvents fired","info"),document.addEventListener("keydown",n.callback.globalKeydown,!1),n.nodes.redactor.addEventListener("keydown",n.callback.redactorKeyDown,!1),document.addEventListener("keyup",n.callback.globalKeyup,!1),n.nodes.redactor.addEventListener("click",n.callback.redactorClicked,!1),n.nodes.plusButton.addEventListener("click",n.callback.plusButtonClicked,!1),n.nodes.showSettingsButton.addEventListener("click",n.callback.showSettingsButtonClicked,!1);for(var e in n.nodes.toolbarButtons)n.nodes.toolbarButtons[e].addEventListener("click",n.callback.toolbarButtonClicked,!1)},e.addBlockHandlers=function(e){e&&(e.addEventListener("keydown",n.callback.blockKeydown,!1),e.addEventListener("paste",n.callback.blockPasteCallback,!1),e.addEventListener("mouseup",n.toolbar.inline.show,!1))},e.saveInputs=function(){var e=n.nodes.redactor;n.state.inputs=e.querySelectorAll("[contenteditable], input")},e.addInitialBlock=function(){var e,t=n.settings.initialBlockPlugin;return n.tools[t]?(e=n.tools[t].render(),e.setAttribute("data-placeholder","Расскажите свою историю..."),n.content.insertBlock({type:t,block:e}),void n.content.workingNodeChanged(e)):void n.core.log("Plugin %o was not implemented and can't be used as initial block","warn",t)},e.setInlineToolbarButtonBehaviour=function(e,t){e.addEventListener("mousedown",function(e){n.toolbar.inline.toolClicked(e,t)},!1)},e}({})},function(e,t){"use strict";var n=codex.editor;e.exports=function(e){return e.input=null,e.arguments=null,e.prepare=function(){var e=document.createElement("INPUT");e.type="file",e.addEventListener("change",n.transport.fileSelected),n.transport.input=e},e.clearInput=function(){this.input=null,this.prepare()},e.fileSelected=function(){var e=this,t=e.files,o=new FormData;o.append("files",t[0],t[0].name),n.transport.ajax({data:o,beforeSend:n.transport.arguments.beforeSend,success:n.transport.arguments.success,error:n.transport.arguments.error})},e.selectAndUpload=function(e){this.arguments=e,this.input.click()},e.ajax=function(e){var t=new XMLHttpRequest,o="function"==typeof e.beforeSend?e.beforeSend:function(){},r="function"==typeof e.success?e.success:function(){},i="function"==typeof e.error?e.error:function(){};o(),t.open("POST",n.settings.uploadImagesUrl,!0),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.onload=function(){200===t.status?r(t.responseText):(n.core.log("request error: %o",t),i())},t.send(e.data),this.clearInput()},e}({})},function(e,t){"use strict";var n=codex.editor;e.exports=function(e){return e.makeBlocksFromData=function(){return n.core.isEmpty(n.state.blocks)||!n.state.blocks.items.length?void n.ui.addInitialBlock():void Promise.resolve().then(function(){return n.state.blocks}).then(n.renderer.appendBlocks).catch(function(e){n.core.log("Error while parsing JSON: %o","error",e)})},e.appendBlocks=function(e){for(var t=e.items,o=Promise.resolve(),r=0;r<t.length;r++)n.renderer.appendNodeAtIndex(o,t,r)},e.appendNodeAtIndex=function(e,t,o){e.then(function(){return n.renderer.getNodeAsync(t,o)}).then(n.renderer.createBlockFromData).then(function(e){return n.content.insertBlock(e),e.block}).catch(function(e){n.core.log("Node skipped while parsing because %o","error",e)})},e.getNodeAsync=function(e,t){return Promise.resolve().then(function(){return{tool:e[t],position:t}})},e.createBlockFromData=function(e){var t,o=e.tool,r=o.type,i=o.anchor,a=o.cover;if(!n.tools[r])throw Error("Plugin «"+r+"» not found");if("function"!=typeof n.tools[r].render)throw Error("Plugin «"+r+"» must have «render» method");n.tools[r].available===!1?(t=n.draw.unavailableBlock(),t.innerHTML=n.tools[r].loadingMessage,t.dataset.inputPosition=e.position):t=n.tools[r].render(o.data);var s=n.tools[r].isStretched||!1;return{type:r,block:t,stretched:s,cover:a,anchor:i}},e.rerender=function(t){return n.nodes.redactor.innerHTML="",n.content.currentNode=null,t?void n.ui.addInitialBlock():void e.makeBlocksFromData()},e}({})},function(e,t){"use strict";var n=codex.editor;e.exports=function(e){return e.saveBlocks=function(){n.state.html=n.nodes.redactor.innerHTML,n.state.jsonOutput=[],Promise.resolve().then(function(){return n.nodes.redactor.childNodes}).then(n.saver.makeQueue).then(function(){n.state.savingDate=+new Date,n.state.hash=n.currentHash}).then(function(){}).catch(function(e){n.core.log(e)})},e.makeQueue=function(e){for(var t=Promise.resolve(),o=0;o<e.length;o++)n.saver.getBlockData(t,e,o)},e.getBlockData=function(e,t,o){e.then(function(){return n.saver.getNodeAsync(t,o)}).then(n.saver.makeFormDataFromBlocks)},e.getNodeAsync=function(e,t){return Promise.resolve().then(function(){return e[t]})},e.makeFormDataFromBlocks=function(e){var t=e.dataset.tool,o=e.dataset.anchor;if(!n.tools[t])throw Error("Plugin «"+t+"» not found");if("function"!=typeof n.tools[t].save)throw Error("Plugin «"+t+"» must have save method");var r,i,a,s=e.childNodes[0],c=s.childNodes[0],l=!1;if(n.tools[t].available===!1)i=c.dataset.inputPosition,r=codex.editor.state.blocks.items[i].data,l=codex.editor.state.blocks.items[i].cover,o=codex.editor.state.blocks.items[i].anchor;else if(r=n.tools[t].save(c),l=e.classList.contains(n.ui.className.BLOCK_IN_FEED_MODE),n.tools[t].validate){var d=n.tools[t].validate(r);if(!d)return}a={type:t,anchor:o,data:r},a.cover=l,n.state.jsonOutput.push(a)},e}({})},function(e,t){"use strict";var n=codex.editor;e.exports=function(e){e.currentNode=null,e.editorAreaHightlighted=null,e.sync=function(){n.core.log("syncing..."),n.state.html=n.nodes.redactor.innerHTML},e.getNodeFocused=function(){var e,t=window.getSelection();if(null===t.anchorNode)return null;if(e=t.anchorNode.nodeType==n.core.nodeTypes.TAG?t.anchorNode:t.focusNode.parentElement,!n.parser.isFirstLevelBlock(e)){for(var o=e.parentNode;o&&!n.parser.isFirstLevelBlock(o);)o=o.parentNode;e=o}return e!=n.nodes.redactor?e:null},e.markBlock=function(){n.content.currentNode.classList.add(n.ui.className.BLOCK_HIGHLIGHTED)},e.clearMark=function(){n.content.currentNode&&n.content.currentNode.classList.remove(n.ui.className.BLOCK_HIGHLIGHTED)},e.getFirstLevelBlock=function(e){if(n.core.isDomNode(e)||(e=e.parentNode),e===n.nodes.redactor||e===document.body)return null;for(;!e.classList.contains(n.ui.className.BLOCK_CLASSNAME);)e=e.parentNode;return e},e.workingNodeChanged=function(e){n.content.clearMark(),e&&(this.currentNode=this.getFirstLevelBlock(e))},e.replaceBlock=function(e,t){if(!e||!t)return void n.core.log("replaceBlock: missed params");for(;!e.classList.contains(n.ui.className.BLOCK_CLASSNAME);)e=e.parentNode;e.classList.contains(n.ui.className.BLOCK_IN_FEED_MODE)&&t.classList.add(n.ui.className.BLOCK_IN_FEED_MODE),e.classList.contains(n.ui.className.BLOCK_WITH_ANCHOR)&&t.classList.add(n.ui.className.BLOCK_WITH_ANCHOR),t.dataset.anchor=e.dataset.anchor,n.nodes.redactor.replaceChild(t,e),n.content.workingNodeChanged(t),n.ui.addBlockHandlers(t),n.ui.saveInputs()},e.insertBlock=function(t,o){var r=n.content.currentNode,i=t.block,a=t.type,s=t.cover,c=t.anchor,l=t.stretched,d=n.content.composeNewBlock(i,a,l,c);if(s===!0&&d.classList.add(n.ui.className.BLOCK_IN_FEED_MODE),c&&d.classList.add(n.ui.className.BLOCK_WITH_ANCHOR),r?n.core.insertAfter(r,d):n.nodes.redactor.appendChild(d),n.ui.addBlockHandlers(d),n.content.workingNodeChanged(d),n.ui.saveInputs(),o){var u=n.caret.getCurrentInputIndex()||-1;if(u==-1){var p=d.querySelector("[contenteditable]"),f=document.createTextNode("");p.appendChild(f),n.caret.set(p,0,0),n.toolbar.move(),n.toolbar.showPlusButton()}else{if(u===n.state.inputs.length-1)return;window.setTimeout(function(){n.caret.setToNextBlock(u),n.toolbar.move(),n.toolbar.open()},10)}}e.editorAreaHightlighted=!1},e.switchBlock=function(e,t,o){var r=n.content.composeNewBlock(t,o);n.content.replaceBlock(e,r),n.ui.saveInputs()},e.getDeepestTextNodeFromPosition=function(e,t){var o,r,i,a=e.childNodes;for(o=0;o<a.length;o++)r=a[o],r.nodeType==n.core.nodeTypes.TEXT&&(i=r.textContent.trim(),""===i&&(e.removeChild(r),t--));if(0===e.childNodes.length)return document.createTextNode("");t<0&&(t=1);var s=!1;for(0===t&&(s=!0,t=1);t;)e=s?e.childNodes[0]:e.childNodes[t-1],e.nodeType==n.core.nodeTypes.TAG?t=e.childNodes.length:e.nodeType==n.core.nodeTypes.TEXT&&(t=0);return e},e.composeNewBlock=function(e,t,o,r){var i=n.draw.node("DIV",n.ui.className.BLOCK_CLASSNAME,{}),a=n.draw.node("DIV",n.ui.className.BLOCK_CONTENT,{});return a.appendChild(e),i.appendChild(a),o&&a.classList.add(n.ui.className.BLOCK_STRETCHED),i.dataset.tool=t,i.dataset.anchor=r||"",i},e.getRange=function(){var e=window.getSelection().getRangeAt(0);return e},e.splitBlock=function(e){var t,o,r,i,a=window.getSelection(),s=a.anchorNode,c=s.textContent,l=a.anchorOffset,d=n.content.currentNode.querySelector("[contentEditable]");t=c.substring(0,l),r=c.substring(l),o=document.createTextNode(t),r&&(i=document.createTextNode(r));var u=[],p=[],f=!1;i&&p.push(i);for(var h,g=0;h=d.childNodes[g];g++)h!=s?f?p.push(h):u.push(h):f=!0;n.state.inputs[e].innerHTML="";var v=u.length;for(g=0;g<v;g++)n.state.inputs[e].appendChild(u[g]);n.state.inputs[e].appendChild(o);var b=p.length,m=document.createElement("div");for(g=0;g<b;g++)m.appendChild(p[g]);m=m.innerHTML;var k=n.settings.initialBlockPlugin;n.content.insertBlock({type:k,block:n.tools[k].render({text:m})},!0)},e.mergeBlocks=function(e,t){if(0!==e){var o,r=n.state.inputs[e].innerHTML;o=t?n.state.inputs[t]:n.state.inputs[e-1],o.innerHTML+=r}},e.paste=function(e){var t=n.content.currentNode,o=t.dataset.tool;n.tools[o].allowedToPaste?n.content.sanitize.call(this,e.target):n.content.pasteTextContent(e.addedNodes)},e.pasteTextContent=function(e){var t,o=e[0];o&&(t=o.nodeType==n.core.nodeTypes.TEXT?document.createTextNode(o):document.createTextNode(o.textContent),n.core.isDomNode(o)&&o.parentNode.replaceChild(t,o))},e.sanitize=function(e){if(e){var t=e[0];if(t&&(this.disconnect(),t.nodeType!=n.core.nodeTypes.TEXT)){var o=n.sanitizer.init(n.satinizer.Config.BASIC),r=o.clean(e.outerHTML),i=n.draw.node("DIV",[],{innerHTML:r});t.replaceWith(i.childNodes[0])}}},e.isLastNode=function(e){for(var o=!1;!o;){if(!t(e))return!1;e=e.parentNode,e.classList.contains(n.ui.className.BLOCK_CONTENT)&&(o=!0)}return!0};var t=function(e){for(var t=e.nextSibling;t;){if(t.textContent.length)return!1;t=t.nextSibling}return!0};return e.wrapTextWithParagraphs=function(e){var t,n,o,r,i=document.createElement("DIV"),a=document.createElement("DIV"),s=["DIV","P"];for(i.innerHTML=e,n=document.createElement("P"),t=0;t<i.childNodes.length;t++)r=i.childNodes[t],o=s.indexOf(r.tagName)!=-1,o?(n.childNodes.length&&(a.appendChild(n.cloneNode(!0)),n=null,n=document.createElement("P")),a.appendChild(r.cloneNode(!0))):(n.appendChild(r.cloneNode(!0)),t==i.childNodes.length-1&&a.appendChild(n.cloneNode(!0)));return a.innerHTML},e}({})},function(e,t,n){"use strict";var o=codex.editor;e.exports=function(e){return e.settings=n(9),e.inline=n(10),e.toolbox=n(11),e.defaultToolbarHeight=49,e.defaultOffset=34,e.opened=!1,e.current=null,e.open=function(){o.nodes.toolbar.classList.add("opened"),this.opened=!0},e.close=function(){o.nodes.toolbar.classList.remove("opened"),e.opened=!1,e.current=null;for(var t in o.nodes.toolbarButtons)o.nodes.toolbarButtons[t].classList.remove("selected");o.toolbar.toolbox.close(),o.toolbar.settings.close()},e.toggle=function(){this.opened?this.close():this.open()},e.hidePlusButton=function(){o.nodes.plusButton.classList.add("hide")},e.showPlusButton=function(){o.nodes.plusButton.classList.remove("hide")},e.move=function(){if(o.toolbar.toolbox.close(),o.content.currentNode){var e=o.content.currentNode.offsetTop-o.toolbar.defaultToolbarHeight/2+o.toolbar.defaultOffset;o.nodes.toolbar.style.transform="translate3D(0, "+Math.floor(e)+"px, 0)",o.toolbar.settings.hideRemoveActions()}},e}({})},function(e,t){"use strict";var n=codex.editor;e.exports=function(e){return e.opened=!1,e.setting=null,e.actions=null,e.cover=null,e.open=function(e){if(n.tools[e]&&n.tools[e].makeSettings){var t=n.tools[e].makeSettings();n.nodes.pluginSettings.appendChild(t)}else n.core.log("Plugin «"+e+"» has no settings","warn");n.nodes.blockSettings.classList.add("opened"),n.toolbar.settings.addDefaultSettings(),this.opened=!0},e.close=function(){n.nodes.blockSettings.classList.remove("opened"),n.nodes.pluginSettings.innerHTML="",this.opened=!1},e.toggle=function(e){this.opened?this.close():(this.open(e),n.anchors.settingsOpened(n.content.currentNode))},e.addDefaultSettings=function(){var e,t;n.nodes.defaultSettings.innerHTML="",e=n.toolbar.settings.makeFeedModeToggler(),t=n.toolbar.settings.makeAnchorInput(),n.nodes.defaultSettings.appendChild(t),n.nodes.defaultSettings.appendChild(e)},e.makeFeedModeToggler=function(){var e,t,o=n.toolbar.settings.isFeedModeActivated();return t=o?{innerHTML:'<i class="ce-icon-newspaper"></i>Не выводить в ленте'}:{innerHTML:'<i class="ce-icon-newspaper"></i>Вывести в ленте'},e=n.draw.node("DIV",n.ui.className.SETTINGS_ITEM,t),e.addEventListener("click",n.toolbar.settings.updateFeedMode,!1),e},e.updateFeedMode=function(){var e=n.content.currentNode;e.classList.toggle(n.ui.className.BLOCK_IN_FEED_MODE),n.toolbar.settings.close()},e.isFeedModeActivated=function(){var e=n.content.currentNode;return!!e&&e.classList.contains(n.ui.className.BLOCK_IN_FEED_MODE)},e.makeAnchorInput=function(){var e=n.draw.node("div","ce-settings__anchor-wrapper ce-settings__item",{}),t=n.draw.node("i","ce-settings__anchor-hash",{}),o=n.draw.node("input","ce-settings__anchor-input",{placeholder:"Якорь"});return o.addEventListener("keydown",n.anchors.keyDownOnAnchorInput),o.addEventListener("keyup",n.anchors.keyUpOnAnchorInput),o.addEventListener("input",n.anchors.anchorChanged),o.addEventListener("blur",n.anchors.anchorChanged),e.appendChild(t),e.appendChild(o),n.anchors.input=o,e},e.makeRemoveBlockButton=function(){var e=n.draw.node("SPAN","ce-toolbar__remove-btn",{}),t=n.draw.node("SPAN","ce-toolbar__remove-setting",{innerHTML:'<i class="ce-icon-trash"></i>'}),o=n.draw.node("DIV","ce-toolbar__remove-confirmation",{}),r=n.draw.node("DIV","ce-toolbar__remove-confirm",{textContent:"Удалить блок"}),i=n.draw.node("DIV","ce-toolbar__remove-cancel",{textContent:"Отмена"});return t.addEventListener("click",n.toolbar.settings.removeButtonClicked,!1),r.addEventListener("click",n.toolbar.settings.confirmRemovingRequest,!1),i.addEventListener("click",n.toolbar.settings.cancelRemovingRequest,!1),o.appendChild(r),o.appendChild(i),e.appendChild(t),e.appendChild(o),n.toolbar.settings.setting=t,n.toolbar.settings.actions=o,e},e.removeButtonClicked=function(){var e=n.toolbar.settings.actions;e.classList.contains("opened")?n.toolbar.settings.hideRemoveActions():n.toolbar.settings.showRemoveActions(),n.toolbar.toolbox.close(),n.toolbar.settings.close()},e.cancelRemovingRequest=function(){n.toolbar.settings.actions.classList.remove("opened")},e.confirmRemovingRequest=function(){var e,t=n.content.currentNode;t.remove(),e=n.nodes.redactor.childNodes.length,0===e&&(n.content.currentNode=null,n.ui.addInitialBlock()),n.ui.saveInputs(),n.toolbar.close()},e.showRemoveActions=function(){n.toolbar.settings.actions.classList.add("opened")},e.hideRemoveActions=function(){n.toolbar.settings.actions.classList.remove("opened")},e}({})},function(e,t){"use strict";var n=codex.editor;e.exports=function(e){e.buttonsOpened=null,e.actionsOpened=null,e.wrappersOffset=null,e.storedSelection=null,e.show=function(){var t,o=n.content.currentNode,r=o.dataset.tool;if(t=n.tools[r],t.showInlineToolbar){var i=e.getSelectionText(),a=n.nodes.inlineToolbar.wrapper;i.length>0&&(n.toolbar.inline.move(),a.classList.add("opened"),n.toolbar.inline.showButtons())}},e.close=function(){var e=n.nodes.inlineToolbar.wrapper;e.classList.remove("opened")},e.move=function(){this.wrappersOffset||(this.wrappersOffset=this.getWrappersOffset());var e,t,o=this.getSelectionCoords(),r=0,i=n.nodes.inlineToolbar.wrapper;0===i.offsetHeight&&(r=40),e=o.x-this.wrappersOffset.left,t=o.y+window.scrollY-this.wrappersOffset.top-r-i.offsetHeight,i.style.transform="translate3D("+Math.floor(e)+"px, "+Math.floor(t)+"px, 0)",n.toolbar.inline.closeButtons(),n.toolbar.inline.closeAction()},e.toolClicked=function(e,t){switch(t){case"createLink":n.toolbar.inline.createLinkAction(e,t);break;default:n.toolbar.inline.defaultToolAction(t)}n.nodes.inlineToolbar.buttons.childNodes.forEach(n.toolbar.inline.hightlight)},e.getWrappersOffset=function(){var e=n.nodes.wrapper,t=this.getOffset(e);return this.wrappersOffset=t,t},e.getOffset=function(e){for(var t=0,n=0;e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop);)t+=e.offsetLeft+e.clientLeft,n+=e.offsetTop+e.clientTop,e=e.offsetParent;return{top:n,left:t}},e.getSelectionCoords=function(){var e,t=document.selection,n=0,o=0;if(t)"Control"!=t.type&&(e=t.createRange(),e.collapse(!0),n=e.boundingLeft,o=e.boundingTop);else if(window.getSelection&&(t=window.getSelection(),t.rangeCount&&(e=t.getRangeAt(0).cloneRange(),e.getClientRects))){e.collapse(!0);var r=e.getClientRects()[0];if(!r)return;n=r.left,o=r.top}return{x:n,y:o}},e.getSelectionText=function(){var e="";return window.getSelection&&(e=window.getSelection().toString()),e},e.showButtons=function(){var e=n.nodes.inlineToolbar.buttons;e.classList.add("opened"),n.toolbar.inline.buttonsOpened=!0,n.nodes.inlineToolbar.buttons.childNodes.forEach(n.toolbar.inline.hightlight)},e.closeButtons=function(){var e=n.nodes.inlineToolbar.buttons;e.classList.remove("opened"),n.toolbar.inline.buttonsOpened=!1},e.showActions=function(){var e=n.nodes.inlineToolbar.actions;e.classList.add("opened"),n.toolbar.inline.actionsOpened=!0},e.closeAction=function(){var e=n.nodes.inlineToolbar.actions;e.innerHTML="",e.classList.remove("opened"),n.toolbar.inline.actionsOpened=!1};var t=function(e){if(e.keyCode==n.core.keys.ENTER){var t=n.content.currentNode,o=n.toolbar.inline.storedSelection;n.toolbar.inline.restoreSelection(t,o),n.toolbar.inline.setAnchor(this.value),e.preventDefault(),e.stopImmediatePropagation(),n.toolbar.inline.clearRange()}};return e.createLinkAction=function(e){var o=this.isLinkActive(),r=n.content.currentNode,i=n.toolbar.inline.saveSelection(r);if(n.toolbar.inline.storedSelection=i,o)n.toolbar.inline.restoreSelection(r,i),n.toolbar.inline.defaultToolAction("unlink");else{var a=n.draw.inputForLink();n.nodes.inlineToolbar.actions.appendChild(a),n.toolbar.inline.closeButtons(),n.toolbar.inline.showActions(),a.focus(),e.preventDefault(),a.addEventListener("keydown",t,!1)}},e.isLinkActive=function(){var e=!1;return n.nodes.inlineToolbar.buttons.childNodes.forEach(function(t){var n=t.dataset.type;"link"==n&&t.classList.contains("hightlighted")&&(e=!0)}),e},e.defaultToolAction=function(e){document.execCommand(e,!1,null)},e.setAnchor=function(e){document.execCommand("createLink",!1,e),n.toolbar.inline.closeAction()},e.saveSelection=function(e){var t,n=window.getSelection().getRangeAt(0),o=n.cloneRange();return o.selectNodeContents(e),o.setEnd(n.startContainer,n.startOffset),t=o.toString().length,{start:t,end:t+n.toString().length}},e.restoreSelection=function(e,t){var n=document.createRange(),o=0;n.setStart(e,0),n.collapse(!0);for(var r,i,a=[e],s=!1,c=!1;!c&&(r=a.pop());)if(3==r.nodeType)i=o+r.length,!s&&t.start>=o&&t.start<=i&&(n.setStart(r,t.start-o),s=!0),s&&t.end>=o&&t.end<=i&&(n.setEnd(r,t.end-o),c=!0),o=i;else for(var l=r.childNodes.length;l--;)a.push(r.childNodes[l]);var d=window.getSelection();d.removeAllRanges(),d.addRange(n)},e.clearRange=function(){var e=window.getSelection();e.removeAllRanges()},e.hightlight=function(e){var t=e.dataset.type;document.queryCommandState(t)?n.toolbar.inline.setButtonHighlighted(e):n.toolbar.inline.removeButtonsHighLight(e);var o=window.getSelection(),r=o.anchorNode.parentNode;"A"==r.tagName&&"link"==t&&n.toolbar.inline.setButtonHighlighted(e)},e.setButtonHighlighted=function(e){if(e.classList.add("hightlighted"),"link"==e.dataset.type){var t=e.childNodes[0];t.classList.remove("ce-icon-link"),t.classList.add("ce-icon-unlink")}},e.removeButtonsHighLight=function(e){if(e.classList.remove("hightlighted"),"link"==e.dataset.type){var t=e.childNodes[0];t.classList.remove("ce-icon-unlink"),t.classList.add("ce-icon-link")}},e}({})},function(e,t){"use strict";var n=codex.editor;e.exports=function(e){return e.opened=!1,e.open=function(){n.toolbar.settings.opened&&n.toolbar.settings.close(),n.nodes.toolbox.classList.add("opened"),n.nodes.plusButton.classList.add("clicked"),n.toolbar.toolbox.opened=!0},e.close=function(){n.nodes.toolbox.classList.remove("opened"),n.nodes.plusButton.classList.remove("clicked"),n.toolbar.toolbox.opened=!1},e.leaf=function(){var e=n.toolbar.current,t=Object.keys(n.tools),o=n.nodes.toolbarButtons,r=0,i=void 0,a=void 0,s=void 0;if(e)for(r=t.indexOf(e)+1,a=t[r];!n.tools[a].displayInToolbox;)r++,a=t[r],r==t.length&&(r=0,a=t[r]);else for(s in n.tools){if(n.tools[s].displayInToolbox)break;r++}i=t[r];for(var c in o)o[c].classList.remove("selected");o[i].classList.add("selected"),n.toolbar.current=i},e.toolClicked=function(e){var t,o,r,i=["image","link","list","instagram","twitter","embed"],a=n.tools[n.toolbar.current],s=n.content.currentNode,c=n.caret.inputIndex;t=a.render(),r={block:t,type:a.type,stretched:!1},s&&i.indexOf(s.dataset.tool)===-1&&""===s.textContent.trim()?n.content.switchBlock(s,t,a.type):(n.content.insertBlock(r),c++),o=a.appendCallback,o&&"function"==typeof o&&o.call(e),window.setTimeout(function(){n.caret.setToBlock(c)},10),n.content.workingNodeChanged(),n.toolbar.move()},e}({})},function(e,t){"use strict";var n=codex.editor;e.exports=function(e){return e.globalKeydown=function(e){switch(e.keyCode){case n.core.keys.ENTER:n.callback.enterKeyPressed(e)}},e.redactorKeyDown=function(e){switch(e.keyCode){case n.core.keys.TAB:n.callback.tabKeyPressed(e);break;case n.core.keys.ENTER:n.callback.enterKeyPressedOnRedactorZone(e);break;case n.core.keys.ESC:n.callback.escapeKeyPressed(e);break;default:n.callback.defaultKeyPressed(e)}},e.globalKeyup=function(e){switch(e.keyCode){case n.core.keys.UP:case n.core.keys.LEFT:case n.core.keys.RIGHT:case n.core.keys.DOWN:n.callback.arrowKeyPressed(e)}},e.tabKeyPressed=function(e){n.toolbar.opened||n.toolbar.open(),n.toolbar.opened&&!n.toolbar.toolbox.opened?n.toolbar.toolbox.open():n.toolbar.toolbox.leaf(),e.preventDefault()},e.enterKeyPressed=function(){n.content.editorAreaHightlighted&&(n.caret.inputIndex=-1,n.callback.enterPressedOnBlock())},e.enterKeyPressedOnRedactorZone=function(e){"true"==e.target.contentEditable&&n.caret.saveCurrentInputIndex();var t=n.caret.getCurrentInputIndex()||0,o=n.content.currentNode,r=o.dataset.tool,i=n.toolbar.opened&&n.toolbar.current&&e.target==n.state.inputs[t],a=n.tools[r].enableLineBreaks,s=n.settings.initialBlockPlugin;if(i)return e.preventDefault(),n.toolbar.toolbox.toolClicked(e),n.toolbar.close(),e.stopPropagation(),void e.stopImmediatePropagation();if(e.shiftKey||a)return e.stopPropagation(),void e.stopImmediatePropagation();var c=window.getSelection(),l=c.anchorNode,d=n.caret.position.atTheEnd(),u=!1;if(e.shiftKey&&!a)return n.callback.enterPressedOnBlock(n.content.currentBlock,e),void e.preventDefault();if(u=l&&"true"!=l.parentNode.contentEditable,l.nodeType!=n.core.nodeTypes.TEXT||u||d){var p=n.content.isLastNode(l);p&&d&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),n.core.log("ENTER clicked in last textNode. Create new BLOCK"),n.content.insertBlock({type:s,block:n.tools[s].render()},!0),n.toolbar.move(),n.toolbar.open(),n.toolbar.showPlusButton())}else e.preventDefault(),n.core.log("Splitting Text node..."),n.content.splitBlock(t),n.state.inputs[t+1].textContent.trim()||n.toolbar.showPlusButton();n.ui.saveInputs()},e.escapeKeyPressed=function(e){n.toolbar.close(),n.toolbar.toolbox.close(),e.preventDefault()},e.arrowKeyPressed=function(){n.content.workingNodeChanged(),n.toolbar.close(),n.toolbar.move()},e.defaultKeyPressed=function(){n.toolbar.close(),n.toolbar.inline.actionsOpened||(n.toolbar.inline.close(),n.content.clearMark())},e.redactorClicked=function(t){e.detectWhenClickedOnFirstLevelBlockArea(),n.content.workingNodeChanged(t.target),n.ui.saveInputs();var o,r=n.toolbar.inline.getSelectionText();if(0===r.length&&n.toolbar.inline.close(),"true"==t.target.contentEditable&&n.caret.saveCurrentInputIndex(),null===n.content.currentNode){var i=n.state.inputs.length>0?n.state.inputs.length-1:0;if(n.state.inputs.length&&(o=n.content.getFirstLevelBlock(n.state.inputs[i])),n.state.inputs.length&&""===n.state.inputs[i].textContent&&o.dataset.tool==n.settings.initialBlockPlugin)n.caret.setToBlock(i);else{var a=n.settings.initialBlockPlugin;n.content.insertBlock({type:a,block:n.tools[a].render()}),1===n.state.inputs.length?n.caret.setToBlock(i):n.caret.setToNextBlock(i);
}n.toolbar.move(),n.toolbar.open()}else n.toolbar.move(),n.toolbar.open(),n.toolbar.settings.close(),n.toolbar.toolbox.close();var s=!n.content.currentNode.textContent.trim(),c=n.content.currentNode.dataset.tool,l=c==n.settings.initialBlockPlugin;n.toolbar.hidePlusButton(),n.content.markBlock(),l&&s&&n.toolbar.showPlusButton()},e.detectWhenClickedOnFirstLevelBlockArea=function(){var e=window.getSelection(),t=e.anchorNode,o=!1;if(0===e.rangeCount)n.content.editorAreaHightlighted=!0;else{for(n.core.isDomNode(t)||(t=t.parentNode),"true"==t.contentEditable&&(o=!0);"true"!=t.contentEditable&&(t=t.parentNode,"true"==t.contentEditable&&(o=!0),t!=document.body););n.content.editorAreaHightlighted=!o}},e.toolbarButtonClicked=function(e){var t=this;n.toolbar.current=t.dataset.type,n.toolbar.toolbox.toolClicked(e),n.toolbar.close()},e.plusButtonClicked=function(){n.nodes.toolbox.classList.contains("opened")?n.toolbar.toolbox.close():n.toolbar.toolbox.open()},e.blockKeydown=function(e){var t=this;switch(e.keyCode){case n.core.keys.DOWN:case n.core.keys.RIGHT:n.callback.blockRightOrDownArrowPressed();break;case n.core.keys.BACKSPACE:n.callback.backspacePressed(t,e);break;case n.core.keys.UP:case n.core.keys.LEFT:n.callback.blockLeftOrUpArrowPressed()}},e.blockRightOrDownArrowPressed=function(){var e,t=window.getSelection(),o=n.state.inputs,r=t.anchorNode;if(!r)return!1;for(;"true"!=r.contentEditable;)e=r.parentNode,r=e;for(var i=0;r!=o[i];)i++;if(!r.textContent)return void n.caret.setToNextBlock(i);var a,s,c=!1,l=!1;return a=r.childNodes[r.childNodes.length-1],s=n.core.isDomNode(a)?n.content.getDeepestTextNodeFromPosition(a,a.childNodes.length):a,c=t.anchorNode==s,l=s.length==t.anchorOffset,c&&l?void n.caret.setToNextBlock(i):(n.core.log("arrow [down|right] : caret does not reached the end"),!1)},e.blockLeftOrUpArrowPressed=function(){var e,t=window.getSelection(),o=n.state.inputs,r=t.anchorNode;if(!r)return!1;if(0!==t.anchorOffset)return!1;for(;"true"!=r.contentEditable;)e=r.parentNode,r=e;for(var i=0;r!=o[i];)i++;var a,s,c=!1,l=!1;return r.textContent?(a=r.childNodes[0],s=n.core.isDomNode(a)?n.content.getDeepestTextNodeFromPosition(a,0):a,c=t.anchorNode==s,l=0===t.anchorOffset,void(c&&l&&n.caret.setToPreviousBlock(i))):void n.caret.setToPreviousBlock(i)},e.enterPressedOnBlock=function(){var e=n.settings.initialBlockPlugin;n.content.insertBlock({type:e,block:n.tools[e].render()},!0),n.toolbar.move(),n.toolbar.open()},e.backspacePressed=function(e,t){var o,r,i,a=n.caret.getCurrentInputIndex();if(e.textContent.trim()){if(o=n.content.getRange(),r=o.endOffset-o.startOffset,!n.caret.position.atStart()||r||!n.state.inputs[a-1])return;n.content.mergeBlocks(a)}r||e.remove(),i=n.nodes.redactor.childNodes.length,0===i?(n.content.currentNode=null,n.ui.addInitialBlock(),n.ui.saveInputs(),window.setTimeout(function(){n.caret.setToPreviousBlock(1)},10)):0!==n.caret.inputIndex?n.caret.setToPreviousBlock(n.caret.inputIndex):n.caret.setToNextBlock(n.caret.inputIndex),n.toolbar.move(),n.toolbar.opened||n.toolbar.open(),n.ui.saveInputs(),t.preventDefault()},e._blockPasteCallback=function(){var e=n.caret.getCurrentInputIndex(),t=new MutationObserver(n.callback.handleMutationsOnPaste),o={attributes:!0,childList:!1,characterData:!1,subtree:!0};t.observe(n.state.inputs[e],o)},e.blockPasteCallback=function(e){if(e.preventDefault(),"true"==e.target.contentEditable){var t,o,r=e.clipboardData.getData("text/html")||e.clipboardData.getData("text/plain"),i=n.draw.node("DIV","",{}),a=new n.sanitizer.init(n.sanitizer.Config.BASIC);o=document.createDocumentFragment(),t=a.clean(r),i.innerHTML=t;for(var s,c;s=i.firstChild;)c=o.appendChild(s);var l,d;l=window.getSelection(),d=l.getRangeAt(0),d.deleteContents(),d.insertNode(o),c&&(d=d.cloneRange(),d.setStartAfter(c),d.collapse(!0),l.removeAllRanges(),l.addRange(d))}},e.handleMutationsOnPaste=function(e){var t=this;e.forEach(function(e){n.content.paste.call(t,e)})},e.showSettingsButtonClicked=function(){var e=n.content.currentNode.dataset.tool;n.toolbar.settings.toggle(e),n.toolbar.toolbox.close(),n.toolbar.settings.hideRemoveActions()},e}({})},function(e,t){"use strict";e.exports=function(e){return e.wrapper=function(){var e=document.createElement("div");return e.className+="codex-editor",e},e.redactor=function(){var e=document.createElement("div");return e.className+="ce-redactor",e},e.ceBlock=function(){var e=document.createElement("DIV");return e.className+="ce_block",e},e.toolbar=function(){var e=document.createElement("div");return e.className+="ce-toolbar",e},e.toolbarContent=function(){var e=document.createElement("DIV");return e.classList.add("ce-toolbar__content"),e},e.inlineToolbar=function(){var e=document.createElement("DIV");return e.className+="ce-toolbar-inline",e},e.inlineToolbarButtons=function(){var e=document.createElement("DIV");return e.className+="ce-toolbar-inline__buttons",e},e.inlineToolbarActions=function(){var e=document.createElement("DIV");return e.className+="ce-toolbar-inline__actions",e},e.inputForLink=function(){var e=document.createElement("INPUT");return e.type="input",e.className+="inputForLink",e.placeholder="Вставьте ссылку ...",e.setAttribute("form","defaultForm"),e.setAttribute("autofocus","autofocus"),e},e.blockButtons=function(){var e=document.createElement("div");return e.className+="ce-toolbar__actions",e},e.blockSettings=function(){var e=document.createElement("div");return e.className+="ce-settings",e},e.defaultSettings=function(){var e=document.createElement("div");return e.classList.add("ce-settings_default"),e},e.pluginsSettings=function(){var e=document.createElement("div");return e.classList.add("ce-settings_plugin"),e},e.plusButton=function(){var e=document.createElement("span");return e.className="ce-toolbar__plus",e},e.settingsButton=function(){var e=document.createElement("span");return e.className="ce-toolbar__settings-btn",e.innerHTML='<i class="ce-icon-cog"></i>',e},e.toolbox=function(){var e=document.createElement("div");return e.className="ce-toolbar__tools",e},e.toolbarButton=function(e,t){var n=document.createElement("li"),o=document.createElement("i"),r=document.createElement("span");return n.dataset.type=e,n.setAttribute("title",e),o.classList.add(t),r.classList.add("ce_toolbar_tools--title"),n.appendChild(o),n.appendChild(r),n},e.toolbarButtonInline=function(e,t){var n=document.createElement("BUTTON"),o=document.createElement("I");return n.type="button",n.dataset.type=e,o.classList.add(t),n.appendChild(o),n},e.block=function(e,t){var n=document.createElement(e);return n.innerHTML=t||"",n},e.node=function(e,t,n){var o=document.createElement(e);if(t&&(o.className=t),n)for(var r in n)o[r]=n[r];return o},e.unavailableBlock=function(){var e=document.createElement("DIV");return e.classList.add("cdx-unavailable-block"),e},e}({})},function(e,t){"use strict";var n=codex.editor;e.exports=function(e){return e.inputIndex=null,e.offset=null,e.focusedNodeIndex=null,e.set=function(t,o,r){r=r||e.offset||0,o=o||e.focusedNodeIndex||0;var i,a=t.childNodes;if(i=0===a.length?t:a[o],"INPUT"==t.tagName)return void t.focus();n.core.isDomNode(i)&&(i=n.content.getDeepestTextNodeFromPosition(i,i.childNodes.length));var s=document.createRange(),c=window.getSelection();window.setTimeout(function(){s.setStart(i,r),s.setEnd(i,r),c.removeAllRanges(),c.addRange(s),n.caret.saveCurrentInputIndex()},20)},e.saveCurrentInputIndex=function(){var t,o=window.getSelection(),r=n.state.inputs,i=o.anchorNode;if(i){for(;"true"!=i.contentEditable;)t=i.parentNode,i=t;for(var a=0;i!=r[a];)a++;e.inputIndex=a}},e.getCurrentInputIndex=function(){return e.inputIndex},e.setToNextBlock=function(e){var t=n.state.inputs,o=t[e+1];if(!o)return void n.core.log("We are reached the end");if(!o.childNodes.length){var r=document.createTextNode("");o.appendChild(r)}n.caret.inputIndex=e+1,n.caret.set(o,0,0),n.content.workingNodeChanged(o)},e.setToBlock=function(e){var t=n.state.inputs,o=t[e];if(o){if(!o.childNodes.length){var r=document.createTextNode("");o.appendChild(r)}n.caret.inputIndex=e,n.caret.set(o,0,0),n.content.workingNodeChanged(o)}},e.setToPreviousBlock=function(e){e=e||0;var t,o,r,i=n.state.inputs,a=i[e-1];return a?(t=n.content.getDeepestTextNodeFromPosition(a,a.childNodes.length),o=t.length,a.childNodes.length||(r=document.createTextNode(""),a.appendChild(r)),n.caret.inputIndex=e-1,n.caret.set(a,a.childNodes.length-1,o),void n.content.workingNodeChanged(i[e-1])):void n.core.log("We are reached first node")},e.position={atStart:function(){var e=window.getSelection(),t=e.anchorOffset,o=e.anchorNode,r=n.content.getFirstLevelBlock(o),i=r.childNodes[0];n.core.isDomNode(o)||(o=o.parentNode);var a=o===i.childNodes[0],s=0===t;return a&&s},atTheEnd:function(){var e=window.getSelection(),t=e.anchorOffset,n=e.anchorNode;return!n||!n.length||t===n.length}},e}({})},function(e,t){"use strict";e.exports=function(e){var t=codex.editor,n=[],o=function(e){n.push(e);for(var t=0;t<n.length&&n.length>5;)"confirm"!=n[t].type&&"prompt"!=n[t].type?(n[t].close(),n.splice(t,1)):t++};return e.createHolder=function(){var e=t.draw.node("DIV","cdx-notifications-block");return t.nodes.notifications=document.body.appendChild(e),e},e.errorThrown=function(e,n){t.notifications.notification({message:"This action is not available currently",type:n.type})},e.notification=function(e){function n(e){if(!e||!e.message)return void t.core.log("Can't create notification. Message is missed");e.type=e.type||"alert",e.time=1e3*e.time||1e4;var n=t.draw.node("DIV","cdx-notification"),o=t.draw.node("DIV","cdx-notification__message"),r=t.draw.node("INPUT","cdx-notification__input"),f=t.draw.node("SPAN","cdx-notification__ok-btn"),h=t.draw.node("SPAN","cdx-notification__cancel-btn");o.textContent=e.message,f.textContent=e.okMsg||"ОК",h.textContent=e.cancelMsg||"Отмена",f.addEventListener("click",u),h.addEventListener("click",p),n.appendChild(o),"prompt"==e.type&&n.appendChild(r),n.appendChild(f),"prompt"!=e.type&&"confirm"!=e.type||n.appendChild(h),n.classList.add("cdx-notification-"+e.type),n.dataset.type=e.type,a=n,c=e.type,l=e.confirm,s=e.cancel,d=r,"prompt"!=e.type&&"confirm"!=e.type&&window.setTimeout(i,e.time)}function r(){t.nodes.notifications.appendChild(a),d.focus(),t.nodes.notifications.classList.add("cdx-notification__notification-appending"),window.setTimeout(function(){t.nodes.notifications.classList.remove("cdx-notification__notification-appending")},100),o({type:c,close:i})}function i(){a.remove()}var a=null,s=null,c=null,l=null,d=null,u=function(){if(i(),"function"==typeof l)return"prompt"==c?void l(d.value):void l()},p=function(){i(),"function"==typeof s&&s()};return e&&(n(e),r()),{create:n,send:r,close:i}},e.clear=function(){t.nodes.notifications.innerHTML="",n=[]},e}({})},function(e,t){"use strict";var n=codex.editor;e.exports=function(e){return e.insertPastedContent=function(e,t){n.content.insertBlock({type:e.type,block:e.render({text:t.innerHTML})})},e.isFirstLevelBlock=function(e){return e.nodeType==n.core.nodeTypes.TAG&&e.classList.contains(n.ui.className.BLOCK_CLASSNAME)},e}({})},function(e,t,n){"use strict";var o=n(18);e.exports=function(e){var t={BASIC:{tags:{p:{},a:{href:!0,target:"_blank",rel:"nofollow"},i:{},b:{},strong:{},em:{},span:{}}}};return e.Config=t,e.init=o,e}({})},function(e,t,n){var o,r;!function(i,a){o=a,r="function"==typeof o?o.call(t,n,t,e):o,!(void 0!==r&&(e.exports=r))}(this,function(){function e(e){var t=e.tags,n=Object.keys(t),o=n.map(function(e){return typeof t[e]}).every(function(e){return"object"===e||"boolean"===e||"function"===e});if(!o)throw new Error("The configuration was invalid");this.config=e}function t(e){return s.indexOf(e.nodeName)!==-1}function n(e){return c.indexOf(e.nodeName)!==-1}function o(e){return document.createTreeWalker(e,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT,null,!1)}function r(e,t,n){return"function"==typeof e.tags[t]?e.tags[t](n):e.tags[t]}function i(e,t){return"undefined"==typeof t||"boolean"==typeof t&&!t}function a(e,t,n){var o=e.name.toLowerCase();return t!==!0&&("function"==typeof t[o]?!t[o](e.value,n):"undefined"==typeof t[o]||(t[o]===!1||"string"==typeof t[o]&&t[o]!==e.value))}var s=["P","LI","TD","TH","DIV","H1","H2","H3","H4","H5","H6","PRE"],c=["A","B","STRONG","I","EM","SUB","SUP","U","STRIKE"];return e.prototype.clean=function(e){var t=document.createElement("div");return t.innerHTML=e,this._sanitize(t),t.innerHTML},e.prototype._sanitize=function(e){var s=o(e),c=s.firstChild();if(c)do if(!c._sanitized)if(c.nodeType!==Node.TEXT_NODE){if(c.nodeType===Node.COMMENT_NODE){e.removeChild(c),this._sanitize(e);break}var l,d=n(c);d&&(l=Array.prototype.some.call(c.childNodes,t));var u=!!e.parentNode,p=t(e)&&t(c)&&u,f=c.nodeName.toLowerCase(),h=r(this.config,f,c),g=d&&l;if(g||i(c,h)||!this.config.keepNestedBlockElements&&p){if("SCRIPT"!==c.nodeName&&"STYLE"!==c.nodeName)for(;c.childNodes.length>0;)e.insertBefore(c.childNodes[0],c);e.removeChild(c),this._sanitize(e);break}for(var v=0;v<c.attributes.length;v+=1){var b=c.attributes[v];a(b,h,c)&&(c.removeAttribute(b.name),v-=1)}this._sanitize(c),c._sanitized=!0}else if(""===c.data.trim()&&(c.previousElementSibling&&t(c.previousElementSibling)||c.nextElementSibling&&t(c.nextElementSibling))){e.removeChild(c),this._sanitize(e);break}while(c=s.nextSibling())},e})},function(e,t){"use strict";e.exports=function(e){var t=codex.editor;return e.input=null,e.currentNode=null,e.settingsOpened=function(t){e.currentNode=t,e.input.value=e.currentNode.dataset.anchor||""},e.anchorChanged=function(n){var o=n.target.value=e.rusToTranslit(n.target.value);e.currentNode.dataset.anchor=o,""!==o.trim()?e.currentNode.classList.add(t.ui.className.BLOCK_WITH_ANCHOR):e.currentNode.classList.remove(t.ui.className.BLOCK_WITH_ANCHOR)},e.keyDownOnAnchorInput=function(e){e.keyCode==t.core.keys.ENTER&&(e.preventDefault(),e.stopPropagation(),e.target.blur(),t.toolbar.settings.close())},e.keyUpOnAnchorInput=function(e){e.keyCode>=t.core.keys.LEFT&&e.keyCode<=t.core.keys.DOWN&&e.stopPropagation()},e.rusToTranslit=function(e){for(var t=["А","Б","В","Г","Д","Е","Ё","Ж","З","И","Й","К","Л","М","Н","О","П","Р","С","Т","У","Ф","Х","Ц","Ч","Ш","Щ","Ь","Ы","Ь","Э","Ю","Я"],n=["A","B","V","G","D","E","E","Zh","Z","I","Y","K","L","M","N","O","P","R","S","T","U","F","H","C","Ch","Sh","Sch","","Y","","E","Yu","Ya"],o=0;o<t.length;o++)e=e.split(t[o]).join(n[o]),e=e.split(t[o].toLowerCase()).join(n[o].toLowerCase());return e=e.replace(/[^0-9a-zA-Z_]+/g,"-")},e}({})}]);
//# sourceMappingURL=codex-editor.js.map