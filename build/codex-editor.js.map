{"version":3,"sources":["webpack://CodexEditor/webpack/universalModuleDefinition","webpack://CodexEditor/webpack/bootstrap","webpack://CodexEditor/./build/sprite.svg","webpack://CodexEditor/./node_modules/css-loader/lib/css-base.js","webpack://CodexEditor/./node_modules/html-janitor/src/html-janitor.js","webpack://CodexEditor/./src/codex.js","webpack://CodexEditor/./src/components/__module.ts","webpack://CodexEditor/./src/components/block-tunes/block-tune-delete.ts","webpack://CodexEditor/./src/components/block-tunes/block-tune-move-down.ts","webpack://CodexEditor/./src/components/block-tunes/block-tune-move-up.ts","webpack://CodexEditor/./src/components/block.js","webpack://CodexEditor/./src/components/dom.js","webpack://CodexEditor/./src/components/inline-tools/inline-tool-bold.ts","webpack://CodexEditor/./src/components/inline-tools/inline-tool-italic.ts","webpack://CodexEditor/./src/components/inline-tools/inline-tool-link.ts","webpack://CodexEditor/./src/components/modules sync nonrecursive [^_](api-blocks.ts|api-events.ts|api-listener.ts|api-sanitizer.ts|api-saver.ts|api-selection.ts|api-toolbar.ts|api.ts|block-events.ts|blockManager.js|caret.js|events.js|listeners.js|renderer.js|sanitizer.js|saver.js|toolbar-blockSettings.js|toolbar-inline.ts|toolbar-toolbox.js|toolbar.js|tools.js|ui.js)$","webpack://CodexEditor/./src/components/modules/api-blocks.ts","webpack://CodexEditor/./src/components/modules/api-events.ts","webpack://CodexEditor/./src/components/modules/api-listener.ts","webpack://CodexEditor/./src/components/modules/api-sanitizer.ts","webpack://CodexEditor/./src/components/modules/api-saver.ts","webpack://CodexEditor/./src/components/modules/api-selection.ts","webpack://CodexEditor/./src/components/modules/api-toolbar.ts","webpack://CodexEditor/./src/components/modules/api.ts","webpack://CodexEditor/./src/components/modules/block-events.ts","webpack://CodexEditor/./src/components/modules/blockManager.js","webpack://CodexEditor/./src/components/modules/caret.js","webpack://CodexEditor/./src/components/modules/events.js","webpack://CodexEditor/./src/components/modules/listeners.js","webpack://CodexEditor/./src/components/modules/renderer.js","webpack://CodexEditor/./src/components/modules/sanitizer.js","webpack://CodexEditor/./src/components/modules/saver.js","webpack://CodexEditor/./src/components/modules/toolbar-blockSettings.js","webpack://CodexEditor/./src/components/modules/toolbar-inline.ts","webpack://CodexEditor/./src/components/modules/toolbar-toolbox.js","webpack://CodexEditor/./src/components/modules/toolbar.js","webpack://CodexEditor/./src/components/modules/tools.js","webpack://CodexEditor/./src/components/modules/ui.js","webpack://CodexEditor/./src/components/polyfills.js","webpack://CodexEditor/./src/components/selection.js","webpack://CodexEditor/./src/components/utils.js","webpack://CodexEditor/./src/styles/main.css"],"names":["modules","editorModules","map","module","CodexEditor","config","moduleInstances","Promise","resolve","then","configuration","init","start","methods","API","method","console","log","catch","error","constructModules","configureModules","forEach","Module","displayName","e","name","state","getModulesDiff","diff","moduleName","prepareDecorator","prepare","Tools","UI","BlockManager","Renderer","render","data","items","initialBlock","type","holderId","placeholder","sanitizer","p","b","a","hideToolbar","tools","toolsConfig","_","isEmpty","length","new","target","TypeError","Editor","DeleteTune","api","CSS","wrapper","button","buttonDelete","buttonConfirm","nodes","resetConfirmation","setConfirmation","$","make","appendChild","svg","listener","on","event","handleClick","needConfirmation","events","off","blocks","delete","classList","add","MoveDownTune","animation","moveDownButton","currentBlockIndex","getCurrentBlockIndex","getBlocksCount","window","setTimeout","remove","nextBlockElement","getBlockByIndex","holder","nextBlockCoords","getBoundingClientRect","scrollOffset","Math","abs","innerHeight","offsetHeight","top","scrollY","scrollTo","swap","MoveUpTune","moveUpButton","currentBlockElement","previousBlockElement","currentBlockCoords","previousBlockCoords","scrollUpOffset","scrollBy","Block","toolName","toolInstance","settings","apiMethods","tool","compose","tunes","makeTunes","contentNode","content","pluginsContent","methodName","params","Function","call","merge","extractedBlock","save","measuringStart","performance","now","measuringEnd","finishedExtraction","time","isValid","validate","tunesList","tune","tunesElement","document","createDocumentFragment","append","querySelector","childNodes","contentless","emptyText","emptyMedia","hasMedia","mediaTags","join","selected","Dom","tag","tagName","includes","classNames","attributes","el","createElement","Array","isArray","attrName","createTextNode","width","height","icon","createElementNS","setAttribute","innerHTML","parent","elements","el1","el2","temp","parentNode","insertBefore","removeChild","selector","querySelectorAll","node","atLast","child","sibling","nodeType","Node","ELEMENT_NODE","nodeChild","isSingleTag","getDeepestNode","nativeInputs","nodeText","isElement","isNativeInput","value","textContent","replace","trim","treeWalker","leafs","isNodeEmpty","push","firstChild","shift","isLeaf","nextSibling","every","leaf","BoldInlineTool","commandName","buttonActive","buttonModifier","range","execCommand","selection","isActive","queryCommandState","toggle","ItalicInlineTool","LinkInlineTool","commandLink","commandUnlink","ENTER_KEY","buttonUnlink","input","inputShowed","inputOpened","inlineToolbar","toolbar","Selection","addEventListener","keyCode","enterPressed","parentAnchor","findParentTag","expandToTag","unlink","closeActions","checkState","close","toggleActions","anchorTag","openActions","hrefAttr","getAttribute","needFocus","focus","clearSavedSelection","clearSaved","restore","preventDefault","validateURL","prepareLink","insertLink","stopPropagation","stopImmediatePropagation","str","test","link","addProtocol","isInternal","isAnchor","substring","isProtocolRelative","BlocksAPI","index","fromIndex","toIndex","Toolbar","move","blockIndex","removeBlock","insert","Caret","setToBlock","currentBlock","navigatePrevious","clear","EventsAPI","eventName","callback","Events","emit","ListenerAPI","element","eventType","handler","useCapture","Listeners","SanitizerAPI","taintString","Sanitizer","clean","SaverAPI","Saver","SelectionAPI","className","ToolbarAPI","open","caret","saver","BlockEvents","beforeKeydownProcessing","keyCodes","BACKSPACE","backspace","ENTER","enter","DOWN","RIGHT","arrowRightAndDown","UP","LEFT","arrowLeftAndUp","defaultHandler","clearHighlightings","InlineToolbar","handleShowingEvent","apiSettings","IS_ENABLED_LINE_BREAKS","shiftKey","split","newCurrent","isInitial","plusButton","show","BM","isFirstBlock","canMergeBlocks","isAtStart","targetBlock","blockToMerge","mergeable","createShadow","mergeBlocks","restoreCaret","normalize","navigateNext","_blocks","Blocks","redactor","Proxy","set","get","construct","block","bindEvents","keydown","mouseUp","keyup","composeBlock","blockToMergeIndex","indexOf","blockToMergeInfo","mergeWith","extractedFragment","extractFragmentFromCaretPosition","text","blockInserted","currentNode","firstLevelBlock","closest","childNode","parentFirstLevelBlock","Error","needAddInitialBlock","removeAll","isLastBlock","array","workingArea","first","second","secondBlock","deleteCount","splice","previousBlock","insertAdjacentElement","nextBlock","isNaN","newBlock","children","instance","Number","offset","atEnd","nodeToSet","delay","createRange","setStart","setEnd","removeAllRanges","addRange","lastBlock","rangeCount","selectRange","getRangeAt","blockElem","deleteContents","cloneRange","selectNodeContents","endContainer","endOffset","extractContents","from","direction","current","siblings","contentEditable","force","isAtEnd","shadowCaret","sel","newRange","selectNode","isCollapsed","anchorNode","firstNode","firstLetterPosition","search","leftSiblings","getHigherLevelSiblings","nothingAtLeft","anchorOffset","lastNode","nothingAtRight","rightTrimmedText","subscribers","reduce","previousData","currentHandler","newData","i","allListeners","assignedEventData","alreadyExist","findOne","existingListeners","findAll","removeEventListener","listenersOnElement","listenersWithType","listenersWithHandler","foundListeners","found","foundByElements","findByElement","filter","chainData","function","insertBlock","sequence","item","available","defaultConfig","_sanitizerInstance","sanitizerConfig","sanitizerInstance","require","customConfig","library","tags","href","rel","newInstance","output","blocksData","all","allExtractedData","makeOutput","outputData","totalTime","groupCollapsed","extraction","groupEnd","Date","version","VERSION","BlockSettings","toolSettings","defaultSettings","makeSettings","renderTunes","wrapperOpened","addToolSettings","addDefaultSettings","opened","closed","contains","inlineToolbarShowed","buttonsWrapper","actionsWrapper","buttons","actions","toolbarVerticalMargin","addTools","allowedToShow","checkToolsState","selectionRect","rect","wrapperOffset","newCoords","x","left","y","floor","style","tagsConflictsWithSelection","currentSelection","selectedText","getBlock","toolConfig","IS_ENABLED_INLINE_TOOLBAR","addTool","renderActions","toolClicked","surround","toolsInstances","inline","Tool","Toolbox","toolbox","toolsAvailable","IS_DISPLAYED_IN_TOOLBOX","TOOLBAR_ICON_CLASS","toolboxButton","title","dataset","buttonClicked","toolButton","toolClasses","IS_IRREPLACEBLE_TOOL","toolboxOpened","blockActionsButtons","settingsToggler","plusButtonClicked","settingsIcon","forceClose","defaultToolbarHeight","defaultOffset","newYCoordinate","offsetTop","transform","toolbarOpened","settingsTogglerClicked","hide","plusButtonHidden","toolsUnavailable","Object","values","IS_INLINE","inlineToolRequiredMethods","notImplementedMethods","hasOwnProperty","reject","sequenceData","getListOfPrepareFunctions","success","fallback","toolPreparationList","toolClass","plugin","appendSVGSprite","loadStyles","getElementById","editorWrapper","editorZone","styles","toString","head","redactorClicked","documentClicked","clickedOnInlineToolbarButton","clickedNode","setCurrentBlockByChildNode","highlightCurrentNode","setToTheLastBlock","isInitialBlock","isEmptyBlock","spriteHolder","sprite","Element","prototype","matches","msMatchesSelector","webkitMatchesSelector","s","documentElement","parentElement","savedSelectionRange","getSelection","searchDepth","parentTag","focusNode","boundNodes","searchDepthIterable","boundingLeft","boundingTop","boundingWidth","boundingHeight","span","insertNode","spanParent","Util","msg","args","chains","previousValue","currentValue","iteration","waitNextBlock","successCallback","fallbackCallback","collection","slice","object","keys","constructor","timeout","context","arguments","apply","TAB","SHIFT","CTRL","ALT","ESC","SPACE","DELETE","META"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,kDAA0C,gCAAgC;AAC1E;AACA;;AAEA;AACA;AACA;AACA,gEAAwD,kBAAkB;AAC1E;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAyC,iCAAiC;AAC1E,wHAAgH,mBAAmB,EAAE;AACrI;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;;;;;AClFA,4+H;;;;;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,mCAAmC,gBAAgB;AACnD,IAAI;AACJ;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,gBAAgB,iBAAiB;AACjC;AACA;AACA;AACA;AACA,YAAY,oBAAoB;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,oDAAoD,cAAc;;AAElE;AACA;;;;;;;;;;;;AC3EA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA,GAAG,QAIH;AACA,CAAC;;AAED;AACA,aAAa,OAAO;AACpB,aAAa,QAAQ;AACrB;AACA;;AAEA;AACA;;AAEA;AACA,wBAAwB,iCAAiC,EAAE;AAC3D,6BAA6B,uEAAuE,EAAE;;AAEtG;AACA;AACA;;AA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AL,CAAYiC,IAAZ,CAAiBC,KAAjB,GAAyB,CAAEC,YAAF,CAAzB;AACD,OAHD,MAGO;AACL,YAAI,CAAC,KAAKnC,MAAL,CAAYiC,IAAZ,CAAiBC,KAAlB,IAA2B,KAAKlC,MAAL,CAAYiC,IAAZ,CAAiBC,KAAjB,CAAuBc,MAAvB,KAAkC,CAAjE,EAAoE;AAClE,eAAKhD,MAAL,CAAYiC,IAAZ,CAAiBC,KAAjB,GAAyB,CAAEC,YAAF,CAAzB;AACD;AACF;;AAED;;;AAGA,UAAI,CAACnC,OAAOmC,YAAZ,EAA0B;AACxB,aAAK,KAAKnC,MAAL,CAAYmC,YAAjB,IAAiC,KAAKnC,MAAL,CAAY4C,KAA7C;AAAoD;AAApD;AACD,OAFD,MAEO;AACL,aAAK5C,MAAL,CAAYmC,YAAZ,GAA2BnC,OAAOmC,YAAlC;AACD;AACF;;AAED;;;;;wBAIoB;AAClB,aAAO,KAAKnC,MAAZ;AACD;;;;;;;kBAlHkBD,W;AA6MpB;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;AClZA;;;;;;;;;IASqBmB,M;AACjB;;;;AAIA,0BAAwB;AAAA,YAAVlB,MAAU,QAAVA,MAAU;;AAAA;;AACpB,YAAIiD,IAA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AEAJ,uBAAiBjc,OAAjB,CAAyB,UAACsc,UAAD,EAAgB;AACvC;AACA5c,gBAAQC,GAAR,UAAgB2c,WAAWrW,IAA3B,uBAAgDqW,UAAhD;AACAF,qBAAaE,WAAWlV,IAAxB;AACAnG,cAAMsK,IAAN,CAAW;AACTpK,gBAAMmb,WAAWrW,IADR;AAETjF,gBAAMsb,WAAWtb;AAFR,SAAX;AAID,OARD;;AAUAtB,cAAQC,GAAR,CAAY,OAAZ,EAAqByc,SAArB;AACA1c,cAAQ6c,QAAR;;AAEA,aAAO;AACLnV,cAAU,CAAC,IAAIoV,IAAJ,EADN;AAELvb,eAAUA,KAFL;AAGLwb,iBAAU,OAAAC;AAHL,OAAP;AAKD;;;;EA5DgCzc,M;;AA+DnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;kBA5NqB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ACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;kBAhgBqBW,E;;;;;;;;;;;;;;;;AC7BrB;;;;;AAKA,IAAI,CAACsiB,QAAQC,SAAR,CAAkBC,OAAvB,EACEF,QAAQC,SAAR,CAAkBC,OAAlB,GAA4BF,QAAQC,SAAR,CAAkBE,iBAAlB,IACtBH,QAAQC,SA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","file":"codex-editor.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"CodexEditor\"] = factory();\n\telse\n\t\troot[\"CodexEditor\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/codex.js\");\n","module.exports = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?>\\n<svg xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n<symbol id=\\\"arrow-down\\\" viewBox=\\\"0 0 14 14\\\">\\n  <path transform=\\\"matrix(1 0 0 -1 0 14)\\\" d=\\\"M8.024 4.1v8.6a1.125 1.125 0 0 1-2.25 0V4.1L2.18 7.695A1.125 1.125 0 1 1 .59 6.104L6.103.588c.44-.439 1.151-.439 1.59 0l5.516 5.516a1.125 1.125 0 0 1-1.59 1.59L8.023 4.1z\\\"/>\\n\\n</symbol>\\n<symbol id=\\\"arrow-up\\\" viewBox=\\\"0 0 14 14\\\">\\n    <path d=\\\"M8.024 4.1v8.6a1.125 1.125 0 0 1-2.25 0V4.1L2.18 7.695A1.125 1.125 0 1 1 .59 6.104L6.103.588c.44-.439 1.151-.439 1.59 0l5.516 5.516a1.125 1.125 0 0 1-1.59 1.59L8.023 4.1z\\\"/>\\n\\n</symbol>\\n<symbol id=\\\"bold\\\" viewBox=\\\"0 0 13 15\\\">\\n  <path d=\\\"M5.996 13.9H1.752c-.613 0-1.05-.137-1.312-.412-.262-.275-.393-.712-.393-1.312V1.737C.047 1.125.18.684.449.416.718.147 1.152.013 1.752.013h4.5a10.5 10.5 0 0 1 1.723.123c.487.082.922.24 1.308.474a3.43 3.43 0 0 1 1.449 1.738c.132.363.199.747.199 1.151 0 1.39-.695 2.406-2.084 3.05 1.825.581 2.737 1.712 2.737 3.391 0 .777-.199 1.477-.596 2.099a3.581 3.581 0 0 1-1.61 1.378c-.424.177-.91.301-1.46.374-.549.073-1.19.109-1.922.109zm-.209-6.167H2.86v4.055h3.022c1.9 0 2.851-.686 2.851-2.056 0-.7-.246-1.21-.739-1.525-.492-.316-1.228-.474-2.207-.474zM2.86 2.125v3.59h2.577c.7 0 1.242-.066 1.624-.198a1.55 1.55 0 0 0 .876-.758c.158-.265.237-.562.237-.89 0-.702-.25-1.167-.748-1.398-.499-.23-1.26-.346-2.283-.346H2.86z\\\"/>\\n\\n</symbol>\\n<symbol id=\\\"cross\\\" viewBox=\\\"0 0 237 237\\\">\\n  <path transform=\\\"rotate(45 280.675 51.325)\\\" d=\\\"M191 191V73c0-5.523 4.477-10 10-10h25c5.523 0 10 4.477 10 10v118h118c5.523 0 10 4.477 10 10v25c0 5.523-4.477 10-10 10H236v118c0 5.523-4.477 10-10 10h-25c-5.523 0-10-4.477-10-10V236H73c-5.523 0-10-4.477-10-10v-25c0-5.523 4.477-10 10-10h118z\\\"/>\\n\\n</symbol>\\n<symbol id=\\\"dots\\\" viewBox=\\\"0 0 18 4\\\">\\n  <g fill-rule=\\\"evenodd\\\">\\n    <circle cx=\\\"9\\\" cy=\\\"2\\\" r=\\\"2\\\"/>\\n    <circle cx=\\\"2\\\" cy=\\\"2\\\" r=\\\"2\\\"/>\\n    <circle cx=\\\"16\\\" cy=\\\"2\\\" r=\\\"2\\\"/>\\n  </g>\\n\\n</symbol>\\n<symbol id=\\\"italic\\\" viewBox=\\\"0 0 6 15\\\">\\n  <path d=\\\"M4 5.2l-1.368 7.474c-.095.518-.29.91-.585 1.175a1.468 1.468 0 0 1-1.01.398c-.379 0-.662-.136-.85-.407-.186-.272-.234-.66-.141-1.166L1.4 5.276c.093-.511.282-.896.567-1.155a1.43 1.43 0 0 1 .994-.389c.38 0 .668.13.867.389.199.259.256.618.172 1.08zm-.79-2.67c-.36 0-.648-.111-.863-.332-.215-.221-.286-.534-.212-.938.067-.366.253-.668.559-.905A1.57 1.57 0 0 1 3.673 0c.334 0 .612.107.831.322.22.215.292.527.217.938-.073.398-.256.709-.55.933a1.55 1.55 0 0 1-.961.336z\\\"/>\\n\\n</symbol>\\n<symbol id=\\\"link\\\" viewBox=\\\"0 0 15 14\\\">\\n    <path transform=\\\"rotate(-45 11.83 6.678)\\\" d=\\\"M11.332 4.013a51.07 51.07 0 0 1-2.28.001A1.402 1.402 0 0 0 7.7 2.25H3.65a1.4 1.4 0 1 0 0 2.8h.848c.206.86.693 1.61 1.463 2.25H3.65a3.65 3.65 0 1 1 0-7.3H7.7a3.65 3.65 0 0 1 3.632 4.013zM10.9 0h2a3.65 3.65 0 0 1 0 7.3H8.85a3.65 3.65 0 0 1-3.632-4.011A62.68 62.68 0 0 1 7.5 3.273 1.401 1.401 0 0 0 8.85 5.05h4.05a1.4 1.4 0 0 0 0-2.8h-.48C12.274 1.664 11.694.785 10.9 0z\\\"/>\\n\\n</symbol>\\n<symbol id=\\\"plus\\\" viewBox=\\\"0 0 14 14\\\">\\n    <path d=\\\"M8.05 5.8h4.625a1.125 1.125 0 0 1 0 2.25H8.05v4.625a1.125 1.125 0 0 1-2.25 0V8.05H1.125a1.125 1.125 0 0 1 0-2.25H5.8V1.125a1.125 1.125 0 0 1 2.25 0V5.8z\\\"/>\\n\\n</symbol>\\n<symbol id=\\\"unlink\\\" viewBox=\\\"0 0 16 18\\\">\\n    <path transform=\\\"rotate(-45 8.358 11.636)\\\" d=\\\"M9.14 9.433c.008-.12-.087-.686-.112-.81a1.4 1.4 0 0 0-1.64-1.106l-3.977.772a1.4 1.4 0 0 0 .535 2.749l.935-.162s.019 1.093.592 2.223l-1.098.148A3.65 3.65 0 1 1 2.982 6.08l3.976-.773c1.979-.385 3.838.919 4.28 2.886.51 2.276-1.084 2.816-1.073 2.935.011.12-.394-1.59-1.026-1.696zm3.563-.875l2.105 3.439a3.65 3.65 0 0 1-6.19 3.868L6.47 12.431c-1.068-1.71-.964-2.295-.49-3.07.067-.107 1.16-1.466 1.48-.936-.12.036.9 1.33.789 1.398-.656.41-.28.76.13 1.415l2.145 3.435a1.4 1.4 0 0 0 2.375-1.484l-1.132-1.941c.42-.435 1.237-1.054.935-2.69zm1.88-2.256h3.4a1.125 1.125 0 0 1 0 2.25h-3.4a1.125 1.125 0 0 1 0-2.25zM11.849.038c.62 0 1.125.503 1.125 1.125v3.4a1.125 1.125 0 0 1-2.25 0v-3.4c0-.622.503-1.125 1.125-1.125z\\\"/>\\n\\n</symbol></svg>\"","/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\nmodule.exports = function(useSourceMap) {\n\tvar list = [];\n\n\t// return the list of modules as css string\n\tlist.toString = function toString() {\n\t\treturn this.map(function (item) {\n\t\t\tvar content = cssWithMappingToString(item, useSourceMap);\n\t\t\tif(item[2]) {\n\t\t\t\treturn \"@media \" + item[2] + \"{\" + content + \"}\";\n\t\t\t} else {\n\t\t\t\treturn content;\n\t\t\t}\n\t\t}).join(\"\");\n\t};\n\n\t// import a list of modules into the list\n\tlist.i = function(modules, mediaQuery) {\n\t\tif(typeof modules === \"string\")\n\t\t\tmodules = [[null, modules, \"\"]];\n\t\tvar alreadyImportedModules = {};\n\t\tfor(var i = 0; i < this.length; i++) {\n\t\t\tvar id = this[i][0];\n\t\t\tif(typeof id === \"number\")\n\t\t\t\talreadyImportedModules[id] = true;\n\t\t}\n\t\tfor(i = 0; i < modules.length; i++) {\n\t\t\tvar item = modules[i];\n\t\t\t// skip already imported module\n\t\t\t// this implementation is not 100% perfect for weird media query combinations\n\t\t\t//  when a module is imported multiple times with different media queries.\n\t\t\t//  I hope this will never occur (Hey this way we have smaller bundles)\n\t\t\tif(typeof item[0] !== \"number\" || !alreadyImportedModules[item[0]]) {\n\t\t\t\tif(mediaQuery && !item[2]) {\n\t\t\t\t\titem[2] = mediaQuery;\n\t\t\t\t} else if(mediaQuery) {\n\t\t\t\t\titem[2] = \"(\" + item[2] + \") and (\" + mediaQuery + \")\";\n\t\t\t\t}\n\t\t\t\tlist.push(item);\n\t\t\t}\n\t\t}\n\t};\n\treturn list;\n};\n\nfunction cssWithMappingToString(item, useSourceMap) {\n\tvar content = item[1] || '';\n\tvar cssMapping = item[3];\n\tif (!cssMapping) {\n\t\treturn content;\n\t}\n\n\tif (useSourceMap && typeof btoa === 'function') {\n\t\tvar sourceMapping = toComment(cssMapping);\n\t\tvar sourceURLs = cssMapping.sources.map(function (source) {\n\t\t\treturn '/*# sourceURL=' + cssMapping.sourceRoot + source + ' */'\n\t\t});\n\n\t\treturn [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\n\t}\n\n\treturn [content].join('\\n');\n}\n\n// Adapted from convert-source-map (MIT)\nfunction toComment(sourceMap) {\n\t// eslint-disable-next-line no-undef\n\tvar base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));\n\tvar data = 'sourceMappingURL=data:application/json;charset=utf-8;base64,' + base64;\n\n\treturn '/*# ' + data + ' */';\n}\n","(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define('html-janitor', factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory();\n  } else {\n    root.HTMLJanitor = factory();\n  }\n}(this, function () {\n\n  /**\n   * @param {Object} config.tags Dictionary of allowed tags.\n   * @param {boolean} config.keepNestedBlockElements Default false.\n   */\n  function HTMLJanitor(config) {\n\n    var tagDefinitions = config['tags'];\n    var tags = Object.keys(tagDefinitions);\n\n    var validConfigValues = tags\n      .map(function(k) { return typeof tagDefinitions[k]; })\n      .every(function(type) { return type === 'object' || type === 'boolean' || type === 'function'; });\n\n    if(!validConfigValues) {\n      throw new Error(\"The configuration was invalid\");\n    }\n\n    this.config = config;\n  }\n\n  // TODO: not exhaustive?\n  var blockElementNames = ['P', 'LI', 'TD', 'TH', 'DIV', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'PRE'];\n  function isBlockElement(node) {\n    return blockElementNames.indexOf(node.nodeName) !== -1;\n  }\n\n  var inlineElementNames = ['A', 'B', 'STRONG', 'I', 'EM', 'SUB', 'SUP', 'U', 'STRIKE'];\n  function isInlineElement(node) {\n    return inlineElementNames.indexOf(node.nodeName) !== -1;\n  }\n\n  HTMLJanitor.prototype.clean = function (html) {\n    var sandbox = document.createElement('div');\n    sandbox.innerHTML = html;\n\n    this._sanitize(sandbox);\n\n    return sandbox.innerHTML;\n  };\n\n  HTMLJanitor.prototype._sanitize = function (parentNode) {\n    var treeWalker = createTreeWalker(parentNode);\n    var node = treeWalker.firstChild();\n    if (!node) { return; }\n\n    do {\n      // Ignore nodes that have already been sanitized\n      if (node._sanitized) {\n        continue;\n      }\n\n      if (node.nodeType === Node.TEXT_NODE) {\n        // If this text node is just whitespace and the previous or next element\n        // sibling is a block element, remove it\n        // N.B.: This heuristic could change. Very specific to a bug with\n        // `contenteditable` in Firefox: http://jsbin.com/EyuKase/1/edit?js,output\n        // FIXME: make this an option?\n        if (node.data.trim() === ''\n            && ((node.previousElementSibling && isBlockElement(node.previousElementSibling))\n                 || (node.nextElementSibling && isBlockElement(node.nextElementSibling)))) {\n          parentNode.removeChild(node);\n          this._sanitize(parentNode);\n          break;\n        } else {\n          continue;\n        }\n      }\n\n      // Remove all comments\n      if (node.nodeType === Node.COMMENT_NODE) {\n        parentNode.removeChild(node);\n        this._sanitize(parentNode);\n        break;\n      }\n\n      var isInline = isInlineElement(node);\n      var containsBlockElement;\n      if (isInline) {\n        containsBlockElement = Array.prototype.some.call(node.childNodes, isBlockElement);\n      }\n\n      // Block elements should not be nested (e.g. <li><p>...); if\n      // they are, we want to unwrap the inner block element.\n      var isNotTopContainer = !! parentNode.parentNode;\n      var isNestedBlockElement =\n            isBlockElement(parentNode) &&\n            isBlockElement(node) &&\n            isNotTopContainer;\n\n      var nodeName = node.nodeName.toLowerCase();\n\n      var allowedAttrs = getAllowedAttrs(this.config, nodeName, node);\n\n      var isInvalid = isInline && containsBlockElement;\n\n      // Drop tag entirely according to the whitelist *and* if the markup\n      // is invalid.\n      if (isInvalid || shouldRejectNode(node, allowedAttrs)\n          || (!this.config.keepNestedBlockElements && isNestedBlockElement)) {\n        // Do not keep the inner text of SCRIPT/STYLE elements.\n        if (! (node.nodeName === 'SCRIPT' || node.nodeName === 'STYLE')) {\n          while (node.childNodes.length > 0) {\n            parentNode.insertBefore(node.childNodes[0], node);\n          }\n        }\n        parentNode.removeChild(node);\n\n        this._sanitize(parentNode);\n        break;\n      }\n\n      // Sanitize attributes\n      for (var a = 0; a < node.attributes.length; a += 1) {\n        var attr = node.attributes[a];\n\n        if (shouldRejectAttr(attr, allowedAttrs, node)) {\n          node.removeAttribute(attr.name);\n          // Shift the array to continue looping.\n          a = a - 1;\n        }\n      }\n\n      // Sanitize children\n      this._sanitize(node);\n\n      // Mark node as sanitized so it's ignored in future runs\n      node._sanitized = true;\n    } while ((node = treeWalker.nextSibling()));\n  };\n\n  function createTreeWalker(node) {\n    return document.createTreeWalker(node,\n                                     NodeFilter.SHOW_TEXT | NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_COMMENT,\n                                     null, false);\n  }\n\n  function getAllowedAttrs(config, nodeName, node){\n    if (typeof config.tags[nodeName] === 'function') {\n      return config.tags[nodeName](node);\n    } else {\n      return config.tags[nodeName];\n    }\n  }\n\n  function shouldRejectNode(node, allowedAttrs){\n    if (typeof allowedAttrs === 'undefined') {\n      return true;\n    } else if (typeof allowedAttrs === 'boolean') {\n      return !allowedAttrs;\n    }\n\n    return false;\n  }\n\n  function shouldRejectAttr(attr, allowedAttrs, node){\n    var attrName = attr.name.toLowerCase();\n\n    if (allowedAttrs === true){\n      return false;\n    } else if (typeof allowedAttrs[attrName] === 'function'){\n      return !allowedAttrs[attrName](attr.value, node);\n    } else if (typeof allowedAttrs[attrName] === 'undefined'){\n      return true;\n    } else if (allowedAttrs[attrName] === false) {\n      return true;\n    } else if (typeof allowedAttrs[attrName] === 'string') {\n      return (allowedAttrs[attrName] !== attr.value);\n    }\n\n    return false;\n  }\n\n  return HTMLJanitor;\n\n}));\n","/**\n * Codex Editor\n *\n * Short Description (_;)\n * @version 2.0.0\n *\n * How to start?\n * Example:\n *           new CodexEditor({\n *                holderId : 'codex-editor',\n *                initialBlock : 'text',\n *                placeholder : 'Write your story....',\n *                tools: {\n *                    quote: Quote,\n *                    anotherTool : AnotherTool\n *                },\n *                toolsConfig: {\n *                     quote: {\n *                        iconClassname : 'quote-icon',\n *                        displayInToolbox : true,\n *                        enableLineBreaks : true\n *                     },\n *                     anotherTool: {\n *                        iconClassname : 'tool-icon'\n *                     }\n *                 }\n *            });\n *\n * - tools is an object: {\n *       pluginName: PluginClass,\n *       .....\n *   }\n * - toolsConfig is an additional configuration that uses Codex Editor API\n *      iconClassname - CSS classname of toolbox icon\n *      displayInToolbox - if you want to see your Tool in toolbox hided in \"plus\" button, than set \"True\". By default : \"False\"\n *      enableLineBreaks - by default enter creates new block that set as initialblock, but if you set this property \"True\", enter will break the lines in current block\n *\n * @author CodeX-Team <https://ifmo.su>\n *\n */\n\n/**\n * @typedef {CodexEditor} CodexEditor - editor class\n */\n\n/**\n * @typedef {Object} EditorConfig\n * @property {String} holderId           - Element to append Editor\n * @property {Array} data                - Blocks list in JSON-format\n * @property {Object} tools              - Map for used Tools in format { name : Class, ... }\n * @property {String} initialBlock       - This Tool will be added by default\n * @property {String} placeholder        - First Block placeholder\n * @property {Object} sanitizer          - @todo fill desc\n * @property {Boolean} hideToolbar       - @todo fill desc\n * @property {Object} toolsConfig        - tools configuration {@link tools#ToolConfig}\n */\n\n/**\n * Dynamically imported utils\n *\n * @typedef {Dom}   $      - {@link components/dom.js}\n * @typedef {Util}  _      - {@link components/utils.js}\n */\n\n'use strict';\n\n/**\n * Apply polyfills\n */\nimport 'components/polyfills';\n\n/**\n * Require Editor modules places in components/modules dir\n */\n// eslint-disable-next-line\nlet modules = editorModules.map( module => require('./components/modules/' + module ));\n\n/**\n * @class\n *\n * @classdesc CodeX Editor base class\n *\n * @property this.config - all settings\n * @property this.moduleInstances - constructed editor components\n *\n * @type {CodexEditor}\n */\nexport default class CodexEditor {\n  /** Editor version */\n  static get version() {\n    return VERSION;\n  }\n\n  /**\n   * @param {EditorConfig} config - user configuration\n   *\n   */\n  constructor(config) {\n    /**\n     * Configuration object\n     * @type {EditorConfig}\n     */\n    this.config = {};\n\n    /**\n     * @typedef {Object} EditorComponents\n     * @property {BlockManager} BlockManager\n     * @property {Tools} Tools\n     * @property {Events} Events\n     * @property {UI} UI\n     * @property {Toolbar} Toolbar\n     * @property {Toolbox} Toolbox\n     * @property {BlockSettings} BlockSettings\n     * @property {Renderer} Renderer\n     * @property {InlineToolbar} InlineToolbar\n     */\n    this.moduleInstances = {};\n\n    Promise.resolve()\n      .then(() => {\n        this.configuration = config;\n      })\n      .then(() => this.init())\n      .then(() => this.start())\n      .then(() => {\n        let methods = this.moduleInstances.API.methods;\n\n        /**\n         * Make API methods available from inside easier\n         */\n        for (let method in methods) {\n          this[method] = methods[method];\n        }\n\n        // todo Is it necessary?\n        delete this.moduleInstances;\n      })\n      .then(() => {\n        console.log('CodeX Editor is ready!');\n      })\n      .catch(error => {\n        console.log('CodeX Editor does not ready because of %o', error);\n      });\n  }\n\n  /**\n   * Setting for configuration\n   * @param {EditorConfig} config\n   */\n  set configuration(config) {\n    /**\n     * Initlai block type\n     * Uses in case when there is no items passed\n     * @type {{type: (*), data: {text: null}}}\n     */\n    let initialBlock = {\n      type : config.initialBlock,\n      data : {}\n    };\n\n    this.config.holderId = config.holderId;\n    this.config.placeholder = config.placeholder || 'write your story...';\n    this.config.sanitizer = config.sanitizer || {\n      p: true,\n      b: true,\n      a: true\n    };\n\n    this.config.hideToolbar = config.hideToolbar ? config.hideToolbar : false;\n    this.config.tools = config.tools || {};\n    this.config.toolsConfig = config.toolsConfig || {};\n    this.config.data = config.data || {};\n\n    /**\n     * Initialize items to pass data to the Renderer\n     */\n    if (_.isEmpty(this.config.data)) {\n      this.config.data = {};\n      this.config.data.items = [ initialBlock ];\n    } else {\n      if (!this.config.data.items || this.config.data.items.length === 0) {\n        this.config.data.items = [ initialBlock ];\n      }\n    }\n\n    /**\n     * If initial Block's Tool was not passed, use the first Tool in config.tools\n     */\n    if (!config.initialBlock) {\n      for (this.config.initialBlock in this.config.tools) break;\n    } else {\n      this.config.initialBlock = config.initialBlock;\n    }\n  }\n\n  /**\n   * Returns private property\n   * @returns {EditorConfig}\n   */\n  get configuration() {\n    return this.config;\n  }\n\n  /**\n   * Initializes modules:\n   *  - make and save instances\n   *  - configure\n   */\n  init() {\n    /**\n     * Make modules instances and save it to the @property this.moduleInstances\n     */\n    this.constructModules();\n\n    /**\n     * Modules configuration\n     */\n    this.configureModules();\n  }\n\n  /**\n   * Make modules instances and save it to the @property this.moduleInstances\n   */\n  constructModules() {\n    modules.forEach( Module => {\n      try {\n        /**\n         * We use class name provided by displayName property\n         *\n         * On build, Babel will transform all Classes to the Functions so, name will always be 'Function'\n         * To prevent this, we use 'babel-plugin-class-display-name' plugin\n         * @see  https://www.npmjs.com/package/babel-plugin-class-display-name\n         */\n        this.moduleInstances[Module.displayName] = new Module({\n          config : this.configuration\n        });\n      } catch ( e ) {\n        console.log('Module %o skipped because %o', Module, e);\n      }\n    });\n  }\n\n  /**\n   * Modules instances configuration:\n   *  - pass other modules to the 'state' property\n   *  - ...\n   */\n  configureModules() {\n    for(let name in this.moduleInstances) {\n      /**\n       * Module does not need self-instance\n       */\n      this.moduleInstances[name].state = this.getModulesDiff( name );\n    }\n  }\n\n  /**\n   * Return modules without passed name\n   */\n  getModulesDiff( name ) {\n    let diff = {};\n\n    for(let moduleName in this.moduleInstances) {\n      /**\n       * Skip module with passed name\n       */\n      if (moduleName === name) {\n        continue;\n      }\n      diff[moduleName] = this.moduleInstances[moduleName];\n    }\n\n    return diff;\n  }\n\n  /**\n   * Start Editor!\n   *\n   * Get list of modules that needs to be prepared and return a sequence (Promise)\n   * @return {Promise}\n   */\n  start() {\n    let prepareDecorator = module => module.prepare();\n\n    return Promise.resolve()\n      .then(prepareDecorator(this.moduleInstances.Tools))\n      .then(prepareDecorator(this.moduleInstances.UI))\n      .then(prepareDecorator(this.moduleInstances.BlockManager))\n      .then(() => {\n        return this.moduleInstances.Renderer.render(this.config.data.items);\n      });\n  }\n};\n\n// module.exports = (function (editor) {\n//\n//     'use strict';\n//\n//     editor.version = VERSION;\n//     editor.scriptPrefix = 'cdx-script-';\n//\n//     var init = function () {\n//\n//         editor.core          = require('./modules/core');\n//         editor.tools         = require('./modules/tools');\n//         editor.ui            = require('./modules/ui');\n//         editor.transport     = require('./modules/transport');\n//         editor.renderer      = require('./modules/renderer');\n//         editor.saver         = require('./modules/saver');\n//         editor.content       = require('./modules/content');\n//         editor.toolbar       = require('./modules/toolbar/toolbar');\n//         editor.callback      = require('./modules/callbacks');\n//         editor.draw          = require('./modules/draw');\n//         editor.caret         = require('./modules/caret');\n//         editor.notifications = require('./modules/notifications');\n//         editor.parser        = require('./modules/parser');\n//         editor.sanitizer     = require('./modules/sanitizer');\n//         editor.listeners     = require('./modules/listeners');\n//         editor.destroyer     = require('./modules/destroyer');\n//         editor.paste         = require('./modules/paste');\n//\n//     };\n//\n//     /**\n//      * @public\n//      * holds initial settings\n//      */\n//     editor.settings = {\n//         tools     : ['text', 'header', 'picture', 'list', 'quote', 'code', 'twitter', 'instagram', 'smile'],\n//         holderId  : 'codex-editor',\n//\n//         // Type of block showing on empty editor\n//         initialBlockPlugin: 'text'\n//     };\n//\n//     /**\n//      * public\n//      *\n//      * Static nodes\n//      */\n//     editor.nodes = {\n//         holder            : null,\n//         wrapper           : null,\n//         toolbar           : null,\n//         inlineToolbar     : {\n//             wrapper : null,\n//             buttons : null,\n//             actions : null\n//         },\n//         toolbox           : null,\n//         notifications     : null,\n//         plusButton        : null,\n//         showSettingsButton: null,\n//         showTrashButton   : null,\n//         blockSettings     : null,\n//         pluginSettings    : null,\n//         defaultSettings   : null,\n//         toolbarButtons    : {}, // { type : DomEl, ... }\n//         redactor          : null\n//     };\n//\n//     /**\n//      * @public\n//      *\n//      * Output state\n//      */\n//     editor.state = {\n//         jsonOutput  : [],\n//         blocks      : [],\n//         inputs      : []\n//     };\n//\n//     /**\n//     * @public\n//     * Editor plugins\n//     */\n//     editor.tools = {};\n//\n//     editor.start = function (userSettings) {\n//\n//         init();\n//\n//         editor.core.prepare(userSettings)\n//\n//         // If all ok, make UI, bind events and parse initial-content\n//             .then(editor.ui.prepare)\n//             .then(editor.tools.prepare)\n//             .then(editor.sanitizer.prepare)\n//             .then(editor.paste.prepare)\n//             .then(editor.transport.prepare)\n//             .then(editor.renderer.makeBlocksFromData)\n//             .then(editor.ui.saveInputs)\n//             .catch(function (error) {\n//\n//                 editor.core.log('Initialization failed with error: %o', 'warn', error);\n//\n//             });\n//\n//     };\n//\n//     return editor;\n//\n// })({});\n","/**\n * @abstract\n * @class      Module\n * @classdesc  All modules inherits from this class.\n *\n * @typedef {Module} Module\n * @property {Object} config - Editor user settings\n * @property {IEditorConfig} Editor - List of Editor modules\n */\nexport default class Module {\n    /**\n     * @constructor\n     * @param {IModuleConfig}\n     */\n    constructor({ config }) {\n        if (new.target === Module) {\n            throw new TypeError('Constructors for abstract class Module are not allowed.');\n        }\n        this.config = config;\n    }\n    /**\n     * Editor modules setter\n     * @param {IEditor} Editor\n     */\n    set state(Editor) {\n        this.Editor = Editor;\n    }\n}\n","export default class DeleteTune {\n    /**\n     * DeleteTune constructor\n     *\n     * @param {Object} api\n     */\n    constructor({ api }) {\n        /**\n         * Styles\n         * @type {{wrapper: string}}\n         */\n        this.CSS = {\n            wrapper: 'ass',\n            button: 'ce-settings__button',\n            buttonDelete: 'ce-settings__button--delete',\n            buttonConfirm: 'ce-settings__button--confirm',\n        };\n        /**\n         * Tune nodes\n         */\n        this.nodes = {\n            button: null,\n        };\n        this.api = api;\n        this.resetConfirmation = () => {\n            this.setConfirmation(false);\n        };\n    }\n    /**\n     * Create \"Delete\" button and add click event listener\n     * @returns [Element}\n     */\n    render() {\n        this.nodes.button = $.make('div', [this.CSS.button, this.CSS.buttonDelete], {});\n        this.nodes.button.appendChild($.svg('cross', 12, 12));\n        this.api.listener.on(this.nodes.button, 'click', (event) => this.handleClick(event), false);\n        return this.nodes.button;\n    }\n    /**\n     * Delete block conditions passed\n     * @param {MouseEvent} event\n     */\n    handleClick(event) {\n        /**\n         * if block is not waiting the confirmation, subscribe on block-settings-closing event to reset\n         * otherwise delete block\n         */\n        if (!this.needConfirmation) {\n            this.setConfirmation(true);\n            /**\n             * Subscribe on event.\n             * When toolbar block settings is closed but block deletion is not confirmed,\n             * then reset confirmation state\n             */\n            this.api.events.on('block-settings-closed', this.resetConfirmation);\n        }\n        else {\n            /**\n             * Unsubscribe from block-settings closing event\n             */\n            this.api.events.off('block-settings-closed', this.resetConfirmation);\n            this.api.blocks.delete();\n        }\n    }\n    /**\n     * change tune state\n     */\n    setConfirmation(state) {\n        this.needConfirmation = state;\n        this.nodes.button.classList.add(this.CSS.buttonConfirm);\n    }\n}\n","export default class MoveDownTune {\n    /**\n     * MoveDownTune constructor\n     *\n     * @param {Object} api\n     */\n    constructor({ api }) {\n        /**\n         * Styles\n         * @type {{wrapper: string}}\n         */\n        this.CSS = {\n            button: 'ce-settings__button',\n            wrapper: 'ce-tune-move-down',\n            animation: 'wobble',\n        };\n        this.api = api;\n    }\n    /**\n     * Return 'move down' button\n     */\n    render() {\n        const moveDownButton = $.make('div', [this.CSS.button, this.CSS.wrapper], {});\n        moveDownButton.appendChild($.svg('arrow-down', 14, 14));\n        this.api.listener.on(moveDownButton, 'click', (event) => this.handleClick(event, moveDownButton), false);\n        return moveDownButton;\n    }\n    /**\n     * Handle clicks on 'move down' button\n     * @param {MouseEvent} event\n     * @param {HTMLElement} button\n     */\n    handleClick(event, button) {\n        const currentBlockIndex = this.api.blocks.getCurrentBlockIndex();\n        // If Block is last do nothing\n        if (currentBlockIndex === this.api.blocks.getBlocksCount() - 1) {\n            button.classList.add(this.CSS.animation);\n            window.setTimeout(() => {\n                button.classList.remove(this.CSS.animation);\n            }, 500);\n            return;\n        }\n        const nextBlockElement = this.api.blocks.getBlockByIndex(currentBlockIndex + 1).holder, nextBlockCoords = nextBlockElement.getBoundingClientRect();\n        let scrollOffset = Math.abs(window.innerHeight - nextBlockElement.offsetHeight);\n        /**\n         * Next block ends on screen.\n         * Increment scroll by next block's height to save element onscreen-position\n         */\n        if (nextBlockCoords.top < window.innerHeight) {\n            scrollOffset = window.scrollY + nextBlockElement.offsetHeight;\n        }\n        window.scrollTo(0, scrollOffset);\n        /** Change blocks positions */\n        this.api.blocks.swap(currentBlockIndex, currentBlockIndex + 1);\n    }\n}\n","export default class MoveUpTune {\n    /**\n     * MoveUpTune constructor\n     *\n     * @param {Object} api\n     */\n    constructor({ api }) {\n        /**\n         * Styles\n         * @type {{wrapper: string}}\n         */\n        this.CSS = {\n            button: 'ce-settings__button',\n            wrapper: 'ce-tune-move-up',\n            animation: 'wobble',\n        };\n        this.api = api;\n    }\n    /**\n     * Create \"MoveUp\" button and add click event listener\n     * @returns [Element}\n     */\n    render() {\n        const moveUpButton = $.make('div', [this.CSS.button, this.CSS.wrapper], {});\n        moveUpButton.appendChild($.svg('arrow-up', 14, 14));\n        this.api.listener.on(moveUpButton, 'click', (event) => this.handleClick(event, moveUpButton), false);\n        return moveUpButton;\n    }\n    /**\n     * Move current block up\n     * @param {MouseEvent} event\n     * @param {HTMLElement} button\n     */\n    handleClick(event, button) {\n        const currentBlockIndex = this.api.blocks.getCurrentBlockIndex();\n        if (currentBlockIndex === 0) {\n            button.classList.add(this.CSS.animation);\n            window.setTimeout(() => {\n                button.classList.remove(this.CSS.animation);\n            }, 500);\n            return;\n        }\n        const currentBlockElement = this.api.blocks.getBlockByIndex(currentBlockIndex).holder, previousBlockElement = this.api.blocks.getBlockByIndex(currentBlockIndex - 1).holder;\n        /**\n         * Here is two cases:\n         *  - when previous block has negative offset and part of it is visible on window, then we scroll\n         *  by window's height and add offset which is mathematically difference between two blocks\n         *\n         *  - when previous block is visible and has offset from the window,\n         *      than we scroll window to the difference between this offsets.\n         */\n        const currentBlockCoords = currentBlockElement.getBoundingClientRect(), previousBlockCoords = previousBlockElement.getBoundingClientRect();\n        let scrollUpOffset;\n        if (previousBlockCoords.top > 0) {\n            scrollUpOffset = Math.abs(currentBlockCoords.top) - Math.abs(previousBlockCoords.top);\n        }\n        else {\n            scrollUpOffset = window.innerHeight - Math.abs(currentBlockCoords.top) + Math.abs(previousBlockCoords.top);\n        }\n        window.scrollBy(0, -1 * scrollUpOffset);\n        /** Change blocks positions */\n        this.api.blocks.swap(currentBlockIndex, currentBlockIndex - 1);\n    }\n}\n","/**\n * @class Block\n * @classdesc This class describes editor`s block, including block`s HTMLElement, data and tool\n *\n * @property {Tool} tool  current block tool (Paragraph, for example)\n * @property {Object} CSS  block`s css classes\n *\n */\n\n/** Import default tunes */\nimport MoveUpTune from './block-tunes/block-tune-move-up';\nimport DeleteTune from './block-tunes/block-tune-delete';\nimport MoveDownTune from './block-tunes/block-tune-move-down';\n\n/**\n * @classdesc Abstract Block class that contains Block information, Tool name and Tool class instance\n *\n * @property tool - Tool instance\n * @property html - Returns HTML content of plugin\n * @property holder - Div element that wraps block content with Tool's content. Has `ce-block` CSS class\n * @property pluginsContent - HTML content that returns by Tool's render function\n */\nexport default class Block {\n  /**\n   * @constructor\n   * @param {String} toolName - Tool name that passed on initialization\n   * @param {Object} toolInstance  passed Tool`s instance that rendered the Block\n   * @param {Object} settings - default settings\n   * @param {Object} apiMethods - Editor API\n   */\n  constructor(toolName, toolInstance, settings, apiMethods) {\n    this.name = toolName;\n    this.tool = toolInstance;\n    this.settings = settings;\n    this.api = apiMethods;\n    this.holder = this.compose();\n\n    /**\n     * @type {IBlockTune[]}\n     */\n    this.tunes = this.makeTunes();\n  }\n\n  /**\n   * CSS classes for the Block\n   * @return {{wrapper: string, content: string}}\n   */\n  static get CSS() {\n    return {\n      wrapper: 'ce-block',\n      content: 'ce-block__content',\n      selected: 'ce-block--selected'\n    };\n  }\n\n  /**\n   * Make default Block wrappers and put Tool`s content there\n   * @returns {HTMLDivElement}\n   */\n  compose() {\n    let wrapper = $.make('div', Block.CSS.wrapper),\n      contentNode = $.make('div', Block.CSS.content),\n      pluginsContent  = this.tool.render();\n\n    contentNode.appendChild(pluginsContent);\n    wrapper.appendChild(contentNode);\n    return wrapper;\n  }\n\n  /**\n   * Calls Tool's method\n   *\n   * Method checks tool property {MethodName}. Fires method with passes params If it is instance of Function\n   *\n   * @param {String} methodName\n   * @param {Object} params\n   */\n  call(methodName, params) {\n    /**\n     * call Tool's method with the instance context\n     */\n    if (this.tool[methodName] && this.tool[methodName] instanceof Function) {\n      this.tool[methodName].call(this.tool, params);\n    }\n  }\n\n  /**\n   * Returns Plugins content\n   * @return {Node}\n   */\n  get pluginsContent() {\n    let pluginsContent = this.holder.querySelector(`.${Block.CSS.content}`);\n\n    if (pluginsContent && pluginsContent.childNodes.length) {\n      return pluginsContent.childNodes[0];\n    }\n\n    return null;\n  }\n\n  /**\n   * Get Block's JSON data\n   * @return {Object}\n   */\n  get data() {\n    return this.save();\n  }\n\n  /**\n   * is block mergeable\n   * We plugin have merge function then we call it mergable\n   * @return {boolean}\n   */\n  get mergeable() {\n    return typeof this.tool.merge === 'function';\n  }\n\n  /**\n   * Call plugins merge method\n   * @param {Object} data\n   */\n  mergeWith(data) {\n    return Promise.resolve()\n      .then(() => {\n        this.tool.merge(data);\n      });\n  }\n  /**\n   * Extracts data from Block\n   * Groups Tool's save processing time\n   * @return {Object}\n   */\n  save() {\n    let extractedBlock = this.tool.save(this.pluginsContent);\n\n    /** Measuring execution time*/\n    let measuringStart = window.performance.now(),\n      measuringEnd;\n\n    return Promise.resolve(extractedBlock)\n      .then((finishedExtraction) => {\n        /** measure promise execution */\n        measuringEnd = window.performance.now();\n\n        return {\n          tool: this.name,\n          data: finishedExtraction,\n          time : measuringEnd - measuringStart\n        };\n      })\n      .catch(function (error) {\n        _.log(`Saving proccess for ${this.tool.name} tool failed due to the ${error}`, 'log', 'red');\n      });\n  }\n\n  /**\n   * Uses Tool's validation method to check the correctness of output data\n   * Tool's validation method is optional\n   *\n   * @description Method also can return data if it passed the validation\n   *\n   * @param {Object} data\n   * @returns {Boolean|Object} valid\n   */\n  validateData(data) {\n    let isValid = true;\n\n    if (this.tool.validate instanceof Function) {\n      isValid = this.tool.validate(data);\n    }\n\n    if (!isValid) {\n      return false;\n    }\n\n    return data;\n  }\n\n  /**\n   * Make an array with default settings\n   * Each block has default tune instance that have states\n   * @return {IBlockTune[]}\n   */\n  makeTunes() {\n    let tunesList = [MoveUpTune, DeleteTune, MoveDownTune];\n\n    // Pluck tunes list and return tune instances with passed Editor API and settings\n    return tunesList.map( (tune) => {\n      return new tune({\n        api: this.api,\n        settings: this.settings,\n      });\n    });\n  }\n\n  /**\n   * Enumerates initialized tunes and returns fragment that can be appended to the toolbars area\n   * @return {DocumentFragment}\n   */\n  renderTunes() {\n    let tunesElement = document.createDocumentFragment();\n\n    this.tunes.forEach( tune => {\n      $.append(tunesElement, tune.render());\n    });\n\n    return tunesElement;\n  }\n\n  /**\n   * Check block for emptiness\n   * @return {Boolean}\n   */\n  get isEmpty() {\n    /**\n     * Allow Tool to represent decorative contentless blocks: for example \"* * *\"-tool\n     * That Tools are not empty\n     */\n    if (this.tool.contentless) {\n      return false;\n    }\n\n    let emptyText = $.isEmpty(this.pluginsContent),\n      emptyMedia = !this.hasMedia;\n\n    return emptyText && emptyMedia;\n  }\n\n  /**\n   * Check if block has a media content such as images, iframes and other\n   * @return {Boolean}\n   */\n  get hasMedia() {\n    /**\n     * This tags represents media-content\n     * @type {string[]}\n     */\n    const mediaTags = [\n      'img',\n      'iframe',\n      'video',\n      'audio',\n      'source',\n      'input',\n      'textarea',\n      'twitterwidget'\n    ];\n\n    return !!this.holder.querySelector(mediaTags.join(','));\n  }\n\n  /**\n   * Set selected state\n   * @param {Boolean} state - 'true' to select, 'false' to remove selection\n   */\n  set selected(state) {\n    /**\n     * We don't need to mark Block as Selected when it is not empty\n     */\n    if (state === true && !this.isEmpty) {\n      this.holder.classList.add(Block.CSS.selected);\n    } else {\n      this.holder.classList.remove(Block.CSS.selected);\n    }\n  }\n}\n","/**\n * DOM manipulations helper\n */\nexport default class Dom {\n  /**\n   * Check if passed tag has no closed tag\n   * @param  {Element}  tag\n   * @return {Boolean}\n   */\n  static isSingleTag(tag) {\n    return tag.tagName && ['AREA', 'BASE', 'BR', 'COL', 'COMMAND', 'EMBED', 'HR', 'IMG', 'INPUT', 'KEYGEN', 'LINK', 'META', 'PARAM', 'SOURCE', 'TRACK', 'WBR'].includes(tag.tagName);\n  };\n\n\n  /**\n   * Helper for making Elements with classname and attributes\n   *\n   * @param  {string} tagName           - new Element tag name\n   * @param  {array|string} classNames  - list or name of CSS classname(s)\n   * @param  {Object} attributes        - any attributes\n   * @return {Element}\n   */\n  static make(tagName, classNames = null, attributes = {}) {\n    let el = document.createElement(tagName);\n\n    if ( Array.isArray(classNames) ) {\n      el.classList.add(...classNames);\n    } else if( classNames ) {\n      el.classList.add(classNames);\n    }\n\n    for (let attrName in attributes) {\n      el[attrName] = attributes[attrName];\n    }\n\n    return el;\n  }\n\n  /**\n   * Creates Text Node with the passed content\n   * @param {String} content - text content\n   * @return {Text}\n   */\n  static text(content) {\n    return document.createTextNode(content);\n  }\n\n  /**\n   * Creates SVG icon linked to the sprite\n   * @param {string} name - name (id) of icon from sprite\n   * @param {number} width\n   * @param {number} height\n   * @return {SVGElement}\n   */\n  static svg(name, width = 14, height = 14) {\n    let icon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n\n    icon.classList.add('icon', 'icon--' + name);\n    icon.setAttribute('width', width + 'px');\n    icon.setAttribute('height', height + 'px');\n    icon.innerHTML = `<use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#${name}\"></use>`;\n\n    return icon;\n  }\n\n  /**\n   * Append one or several elements to the parent\n   *\n   * @param  {Element} parent    - where to append\n   * @param  {Element|Element[]} - element ore elements list\n   */\n  static append(parent, elements) {\n    if ( Array.isArray(elements) ) {\n      elements.forEach( el => parent.appendChild(el) );\n    } else {\n      parent.appendChild(elements);\n    }\n  }\n\n  /**\n   * Swap two elements in parent\n   * @param {HTMLElement} el1 - from\n   * @param {HTMLElement} el2 - to\n   */\n  static swap(el1, el2) {\n    // create marker element and insert it where el1 is\n    const temp = document.createElement('div'),\n      parent = el1.parentNode;\n\n    parent.insertBefore(temp, el1);\n\n    // move el1 to right before el2\n    parent.insertBefore(el1, el2);\n\n    // move el2 to right before where el1 used to be\n    parent.insertBefore(el2, temp);\n\n    // remove temporary marker node\n    parent.removeChild(temp);\n  }\n\n  /**\n   * Selector Decorator\n   *\n   * Returns first match\n   *\n   * @param {Element} el - element we searching inside. Default - DOM Document\n   * @param {String} selector - searching string\n   *\n   * @returns {Element}\n   */\n  static find(el = document, selector) {\n    return el.querySelector(selector);\n  }\n\n  /**\n   * Selector Decorator.\n   *\n   * Returns all matches\n   *\n   * @param {Element} el - element we searching inside. Default - DOM Document\n   * @param {String} selector - searching string\n   * @returns {NodeList}\n   */\n  static findAll(el = document, selector) {\n    return el.querySelectorAll(selector);\n  }\n\n  /**\n   * Search for deepest node which is Leaf.\n   * Leaf is the vertex that doesn't have any child nodes\n   *\n   * @description Method recursively goes throw the all Node until it finds the Leaf\n   *\n   * @param {Node} node - root Node. From this vertex we start Deep-first search {@link https://en.wikipedia.org/wiki/Depth-first_search}\n   * @param {Boolean} atLast - find last text node\n   * @return {Node} - it can be text Node or Element Node, so that caret will able to work with it\n   */\n  static getDeepestNode(node, atLast = false) {\n    /**\n     * Current function have two directions:\n     *  - starts from first child and every time gets first or nextSibling in special cases\n     *  - starts from last child and gets last or previousSibling\n     * @type {string}\n     */\n    let child = atLast ? 'lastChild' : 'firstChild',\n      sibling = atLast ? 'previousSibling' : 'nextSibling';\n\n    if (node && node.nodeType === Node.ELEMENT_NODE && node[child]) {\n      let nodeChild = node[child];\n\n      /**\n       * special case when child is single tag that can't contain any content\n       */\n      if (Dom.isSingleTag(nodeChild)) {\n        /**\n         * 1) We need to check the next sibling. If it is Node Element then continue searching for deepest\n         * from sibling\n         *\n         * 2) If single tag's next sibling is null, then go back to parent and check his sibling\n         * In case of Node Element continue searching\n         *\n         * 3) If none of conditions above happened return parent Node Element\n         */\n        if (nodeChild[sibling]) {\n          nodeChild = nodeChild[sibling];\n        } else if (nodeChild.parentNode[sibling]) {\n          nodeChild = nodeChild.parentNode[sibling];\n        } else {\n          return nodeChild.parentNode;\n        }\n      }\n\n      return this.getDeepestNode(nodeChild, atLast);\n    }\n\n    return node;\n  }\n\n  /**\n   * Check if object is DOM node\n   *\n   * @param {Object} node\n   * @returns {boolean}\n   */\n  static isElement(node) {\n    return node && typeof node === 'object' && node.nodeType && node.nodeType === Node.ELEMENT_NODE;\n  }\n\n  /**\n   * Checks target if it is native input\n   * @param {Element|String|Node} target - HTML element or string\n   * @return {Boolean}\n   */\n  static isNativeInput(target) {\n    let nativeInputs = [\n      'INPUT',\n      'TEXTAREA'\n    ];\n\n    return target ? nativeInputs.includes(target.tagName) : false;\n  }\n\n  /**\n   * Checks node if it is empty\n   *\n   * @description Method checks simple Node without any childs for emptiness\n   * If you have Node with 2 or more children id depth, you better use {@link Dom#isEmpty} method\n   *\n   * @param {Node} node\n   * @return {Boolean} true if it is empty\n   */\n  static isNodeEmpty(node) {\n    let nodeText;\n\n    if ( this.isElement(node) && this.isNativeInput(node) ) {\n      nodeText = node.value;\n    } else {\n      nodeText = node.textContent.replace('\\u200B', '');\n    }\n\n    return nodeText.trim().length === 0;\n  }\n\n  /**\n   * checks node if it is doesn't have any child nodes\n   * @param {Node} node\n   * @return {boolean}\n   */\n  static isLeaf(node) {\n    if (!node) {\n      return false;\n    }\n\n    return node.childNodes.length === 0;\n  }\n\n  /**\n   * breadth-first search (BFS)\n   * {@link https://en.wikipedia.org/wiki/Breadth-first_search}\n   *\n   * @description Pushes to stack all DOM leafs and checks for emptiness\n   *\n   * @param {Node} node\n   * @return {boolean}\n   */\n  static isEmpty(node) {\n    let treeWalker = [],\n      leafs = [];\n\n    if (!node) {\n      return true;\n    }\n\n    if (!node.childNodes.length) {\n      return this.isNodeEmpty(node);\n    }\n\n    treeWalker.push(node.firstChild);\n\n    while ( treeWalker.length > 0 ) {\n      node = treeWalker.shift();\n\n      if (!node) continue;\n\n      if ( this.isLeaf(node) ) {\n        leafs.push(node);\n      } else {\n        treeWalker.push(node.firstChild);\n      }\n\n      while ( node && node.nextSibling ) {\n        node = node.nextSibling;\n\n        if (!node) continue;\n\n        treeWalker.push(node);\n      }\n\n      /**\n       * If one of childs is not empty, checked Node is not empty too\n       */\n      if (node && !this.isNodeEmpty(node)) {\n        return false;\n      }\n    }\n\n    return leafs.every( leaf => this.isNodeEmpty(leaf) );\n  }\n};\n","/**\n * Bold Tool\n *\n * Inline Toolbar Tool\n *\n * Makes selected text bolder\n */\nexport default class BoldInlineTool {\n    constructor(api) {\n        /**\n         * Native Document's command that uses for Bold\n         */\n        this.commandName = 'bold';\n        /**\n         * Styles\n         */\n        this.CSS = {\n            button: 'ce-inline-tool',\n            buttonActive: 'ce-inline-tool--active',\n            buttonModifier: 'ce-inline-tool--bold',\n        };\n        /**\n         * Elements\n         */\n        this.nodes = {\n            button: null,\n        };\n        console.log('Bold Inline Tool is ready');\n    }\n    /**\n     * Create button for Inline Toolbar\n     */\n    render() {\n        this.nodes.button = document.createElement('button');\n        this.nodes.button.classList.add(this.CSS.button, this.CSS.buttonModifier);\n        this.nodes.button.appendChild($.svg('bold', 13, 15));\n        return this.nodes.button;\n    }\n    /**\n     * Wrap range with <b> tag\n     * @param {Range} range\n     */\n    surround(range) {\n        document.execCommand(this.commandName);\n    }\n    /**\n     * Check selection and set activated state to button if there are <b> tag\n     * @param {Selection} selection\n     */\n    checkState(selection) {\n        const isActive = document.queryCommandState(this.commandName);\n        this.nodes.button.classList.toggle(this.CSS.buttonActive, isActive);\n        return isActive;\n    }\n}\n","/**\n * Italic Tool\n *\n * Inline Toolbar Tool\n *\n * Style selected text with italic\n */\nexport default class ItalicInlineTool {\n    constructor(api) {\n        /**\n         * Native Document's command that uses for Italic\n         */\n        this.commandName = 'italic';\n        /**\n         * Styles\n         */\n        this.CSS = {\n            button: 'ce-inline-tool',\n            buttonActive: 'ce-inline-tool--active',\n            buttonModifier: 'ce-inline-tool--italic',\n        };\n        /**\n         * Elements\n         */\n        this.nodes = {\n            button: null,\n        };\n        console.log('Italic Inline Tool is ready');\n    }\n    /**\n     * Create button for Inline Toolbar\n     */\n    render() {\n        this.nodes.button = document.createElement('button');\n        this.nodes.button.classList.add(this.CSS.button, this.CSS.buttonModifier);\n        this.nodes.button.appendChild($.svg('italic', 6, 15));\n        return this.nodes.button;\n    }\n    /**\n     * Wrap range with <i> tag\n     * @param {Range} range\n     */\n    surround(range) {\n        document.execCommand(this.commandName);\n    }\n    /**\n     * Check selection and set activated state to button if there are <i> tag\n     * @param {Selection} selection\n     */\n    checkState(selection) {\n        const isActive = document.queryCommandState(this.commandName);\n        this.nodes.button.classList.toggle(this.CSS.buttonActive, isActive);\n        return isActive;\n    }\n}\n","import Selection from '../selection';\n/**\n * Link Tool\n *\n * Inline Toolbar Tool\n *\n * Wrap selected text with <a> tag\n */\nexport default class LinkInlineTool {\n    /**\n     * @param {object} api - CodeX Editor API\n     * @param {object} api.toolbar - Inline Toolbar API\n     */\n    constructor(api) {\n        /**\n         * Native Document's commands for link/unlink\n         */\n        this.commandLink = 'createLink';\n        this.commandUnlink = 'unlink';\n        /**\n         * Enter key code\n         */\n        this.ENTER_KEY = 13;\n        /**\n         * Styles\n         */\n        this.CSS = {\n            button: 'ce-inline-tool',\n            buttonActive: 'ce-inline-tool--active',\n            buttonModifier: 'ce-inline-tool--link',\n            buttonUnlink: 'ce-inline-tool--unlink',\n            input: 'ce-inline-tool-input',\n            inputShowed: 'ce-inline-tool-input--showed',\n        };\n        /**\n         * Elements\n         */\n        this.nodes = {\n            button: null,\n            input: null,\n        };\n        /**\n         * Input opening state\n         */\n        this.inputOpened = false;\n        this.inlineToolbar = api.toolbar;\n        this.selection = new Selection();\n    }\n    /**\n     * Create button for Inline Toolbar\n     */\n    render() {\n        this.nodes.button = document.createElement('button');\n        this.nodes.button.classList.add(this.CSS.button, this.CSS.buttonModifier);\n        this.nodes.button.appendChild($.svg('link', 15, 14));\n        this.nodes.button.appendChild($.svg('unlink', 16, 18));\n        return this.nodes.button;\n    }\n    /**\n     * Input for the link\n     */\n    renderActions() {\n        this.nodes.input = document.createElement('input');\n        this.nodes.input.placeholder = 'Add a link';\n        this.nodes.input.classList.add(this.CSS.input);\n        this.nodes.input.addEventListener('keydown', (event) => {\n            if (event.keyCode === this.ENTER_KEY) {\n                this.enterPressed(event);\n            }\n        });\n        return this.nodes.input;\n    }\n    /**\n     * Handle clicks on the Inline Toolbar icon\n     * @param {Range} range\n     */\n    surround(range) {\n        /**\n         * Range will be null when user makes second click on the 'link icon' to close opened input\n         */\n        if (range) {\n            /**\n             * Save selection before change focus to the input\n             */\n            this.selection.save();\n            const parentAnchor = this.selection.findParentTag('A');\n            /**\n             * Unlink icon pressed\n             */\n            if (parentAnchor) {\n                this.selection.expandToTag(parentAnchor);\n                this.unlink();\n                this.closeActions();\n                this.checkState();\n                this.inlineToolbar.close();\n                return;\n            }\n        }\n        this.toggleActions();\n    }\n    /**\n     * Check selection and set activated state to button if there are <a> tag\n     * @param {Selection} selection\n     */\n    checkState(selection) {\n        const anchorTag = this.selection.findParentTag('A');\n        if (anchorTag) {\n            this.nodes.button.classList.add(this.CSS.buttonUnlink);\n            this.nodes.button.classList.add(this.CSS.buttonActive);\n            this.openActions();\n            /**\n             * Fill input value with link href\n             */\n            const hrefAttr = anchorTag.getAttribute('href');\n            this.nodes.input.value = hrefAttr !== 'null' ? hrefAttr : '';\n            this.selection.save();\n        }\n        else {\n            this.nodes.button.classList.remove(this.CSS.buttonUnlink);\n            this.nodes.button.classList.remove(this.CSS.buttonActive);\n        }\n        return !!anchorTag;\n    }\n    /**\n     * Function called with Inline Toolbar closing\n     */\n    clear() {\n        this.closeActions();\n    }\n    toggleActions() {\n        if (!this.inputOpened) {\n            this.openActions(true);\n        }\n        else {\n            this.closeActions(false);\n        }\n    }\n    /**\n     * @param {boolean} needFocus - on link creation we need to focus input. On editing - nope.\n     */\n    openActions(needFocus = false) {\n        this.nodes.input.classList.add(this.CSS.inputShowed);\n        if (needFocus) {\n            this.nodes.input.focus();\n        }\n        this.inputOpened = true;\n    }\n    /**\n     * Close input\n     * @param {boolean} clearSavedSelection  we don't need to clear saved selection\n     *                                        on toggle-clicks on the icon of opened Toolbar\n     */\n    closeActions(clearSavedSelection = true) {\n        this.nodes.input.classList.remove(this.CSS.inputShowed);\n        this.nodes.input.value = '';\n        if (clearSavedSelection) {\n            this.selection.clearSaved();\n        }\n        this.inputOpened = false;\n    }\n    /**\n     * Enter pressed on input\n     * @param {KeyboardEvent} event\n     */\n    enterPressed(event) {\n        let value = this.nodes.input.value || '';\n        if (!value.trim()) {\n            this.selection.restore();\n            this.unlink();\n            event.preventDefault();\n            this.closeActions();\n        }\n        if (!this.validateURL(value)) {\n            /**\n             * @todo show notification 'Incorrect Link'\n             */\n            _.log('Incorrect Link pasted', 'warn', value);\n            return;\n        }\n        value = this.prepareLink(value);\n        this.selection.restore();\n        this.insertLink(value);\n        /**\n         * Preventing events that will be able to happen\n         */\n        event.preventDefault();\n        event.stopPropagation();\n        event.stopImmediatePropagation();\n        this.closeActions();\n        this.inlineToolbar.close();\n        this.checkState();\n    }\n    /**\n     * Detects if passed string is URL\n     * @param  {string}  str\n     * @return {Boolean}\n     */\n    validateURL(str) {\n        /**\n         * Don't allow spaces\n         */\n        return !/\\s/.test(str);\n    }\n    /**\n     * Process link before injection\n     * - sanitize\n     * - add protocol for links like 'google.com'\n     * @param {string} link - raw user input\n     */\n    prepareLink(link) {\n        link = link.trim();\n        link = this.addProtocol(link);\n        return link;\n    }\n    /**\n     * Add 'http' protocol to the links like 'vc.ru', 'google.com'\n     * @param {String} link\n     */\n    addProtocol(link) {\n        /**\n         * If protocol already exists, do nothing\n         */\n        if (/^(\\w+):\\/\\//.test(link)) {\n            return link;\n        }\n        /**\n         * We need to add missed HTTP protocol to the link, but skip 2 cases:\n         *     1) Internal links like \"/general\"\n         *     2) Anchors looks like \"#results\"\n         *     3) Protocol-relative URLs like \"//google.com\"\n         */\n        const isInternal = /^\\/[^\\/\\s]/.test(link), isAnchor = link.substring(0, 1) === '#', isProtocolRelative = /^\\/\\/[^\\/\\s]/.test(link);\n        if (!isInternal && !isAnchor && !isProtocolRelative) {\n            link = 'http://' + link;\n        }\n        return link;\n    }\n    /**\n     * Inserts <a> tag with \"href\"\n     * @param {string} link - \"href\" value\n     */\n    insertLink(link) {\n        /**\n         * Edit all link, not selected part\n         */\n        const anchorTag = this.selection.findParentTag('A');\n        if (anchorTag) {\n            this.selection.expandToTag(anchorTag);\n        }\n        document.execCommand(this.commandLink, false, link);\n    }\n    /**\n     * Removes <a> tag\n     */\n    unlink() {\n        document.execCommand(this.commandUnlink);\n    }\n}\n","var map = {\n\t\"./api-blocks.ts\": \"./src/components/modules/api-blocks.ts\",\n\t\"./api-events.ts\": \"./src/components/modules/api-events.ts\",\n\t\"./api-listener.ts\": \"./src/components/modules/api-listener.ts\",\n\t\"./api-sanitizer.ts\": \"./src/components/modules/api-sanitizer.ts\",\n\t\"./api-saver.ts\": \"./src/components/modules/api-saver.ts\",\n\t\"./api-selection.ts\": \"./src/components/modules/api-selection.ts\",\n\t\"./api-toolbar.ts\": \"./src/components/modules/api-toolbar.ts\",\n\t\"./api.ts\": \"./src/components/modules/api.ts\",\n\t\"./block-events.ts\": \"./src/components/modules/block-events.ts\",\n\t\"./blockManager.js\": \"./src/components/modules/blockManager.js\",\n\t\"./caret.js\": \"./src/components/modules/caret.js\",\n\t\"./events.js\": \"./src/components/modules/events.js\",\n\t\"./listeners.js\": \"./src/components/modules/listeners.js\",\n\t\"./renderer.js\": \"./src/components/modules/renderer.js\",\n\t\"./sanitizer.js\": \"./src/components/modules/sanitizer.js\",\n\t\"./saver.js\": \"./src/components/modules/saver.js\",\n\t\"./toolbar-blockSettings.js\": \"./src/components/modules/toolbar-blockSettings.js\",\n\t\"./toolbar-inline.ts\": \"./src/components/modules/toolbar-inline.ts\",\n\t\"./toolbar-toolbox.js\": \"./src/components/modules/toolbar-toolbox.js\",\n\t\"./toolbar.js\": \"./src/components/modules/toolbar.js\",\n\t\"./tools.js\": \"./src/components/modules/tools.js\",\n\t\"./ui.js\": \"./src/components/modules/ui.js\"\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) { // check for number or string\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn id;\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = \"./src/components/modules sync [^_](api-blocks.ts|api-events.ts|api-listener.ts|api-sanitizer.ts|api-saver.ts|api-selection.ts|api-toolbar.ts|api.ts|block-events.ts|blockManager.js|caret.js|events.js|listeners.js|renderer.js|sanitizer.js|saver.js|toolbar-blockSettings.js|toolbar-inline.ts|toolbar-toolbox.js|toolbar.js|tools.js|ui.js)$\";","/**\n * @class BlocksAPI\n * provides with methods working with Block\n */\nexport default class BlocksAPI extends Module {\n    /**\n     * Save Editor config. API provides passed configuration to the Blocks\n     */\n    constructor({ config }) {\n        super({ config });\n    }\n    /**\n     * Available methods\n     * @return {IBlocksAPI}\n     */\n    get methods() {\n        return {\n            clear: () => this.clear(),\n            render: (data) => this.render(data),\n            delete: () => this.delete(),\n            swap: (fromIndex, toIndex) => this.swap(fromIndex, toIndex),\n            getBlockByIndex: (index) => this.getBlockByIndex(index),\n            getCurrentBlockIndex: () => this.getCurrentBlockIndex(),\n            getBlocksCount: () => this.getBlocksCount(),\n        };\n    }\n    /**\n     * Returns Blocks count\n     * @return {number}\n     */\n    getBlocksCount() {\n        return this.Editor.BlockManager.blocks.length;\n    }\n    /**\n     * Returns current block index\n     * @return {number}\n     */\n    getCurrentBlockIndex() {\n        return this.Editor.BlockManager.currentBlockIndex;\n    }\n    /**\n     * Returns Current Block\n     * @param {Number} index\n     *\n     * @return {Object}\n     */\n    getBlockByIndex(index) {\n        return this.Editor.BlockManager.getBlockByIndex(index);\n    }\n    /**\n     * Call Block Manager method that swap Blocks\n     * @param {number} fromIndex - position of first Block\n     * @param {number} toIndex - position of second Block\n     */\n    swap(fromIndex, toIndex) {\n        this.Editor.BlockManager.swap(fromIndex, toIndex);\n        /**\n         * Move toolbar\n         * DO not close the settings\n         */\n        this.Editor.Toolbar.move(false);\n    }\n    /**\n     * Deletes Block\n     * @param blockIndex\n     */\n    delete(blockIndex) {\n        this.Editor.BlockManager.removeBlock(blockIndex);\n        /**\n         * in case of last block deletion\n         * Insert new initial empty block\n         */\n        if (this.Editor.BlockManager.blocks.length === 0) {\n            this.Editor.BlockManager.insert();\n        }\n        /**\n         * In case of deletion first block we need to set caret to the current Block\n         */\n        if (this.Editor.BlockManager.currentBlockIndex === 0) {\n            this.Editor.Caret.setToBlock(this.Editor.BlockManager.currentBlock);\n        }\n        else {\n            if (this.Editor.Caret.navigatePrevious(true)) {\n                this.Editor.Toolbar.close();\n            }\n        }\n    }\n    /**\n     * Clear Editor's area\n     */\n    clear() {\n        this.Editor.BlockManager.clear(true);\n    }\n    /**\n     * Fills Editor with Blocks data\n     * @param {IInputOutputData} data  Saved Editor data\n     */\n    render(data) {\n        this.Editor.BlockManager.clear();\n        this.Editor.Renderer.render(data.items);\n    }\n}\n","/**\n * @class EventsAPI\n * provides with methods working with Toolbar\n */\nexport default class EventsAPI extends Module {\n    /**\n     * Save Editor config. API provides passed configuration to the Blocks\n     */\n    constructor({ config }) {\n        super({ config });\n    }\n    /**\n     * Available methods\n     * @return {IEventsAPI}\n     */\n    get methods() {\n        return {\n            emit: (eventName, data) => this.emit(eventName, data),\n            off: (eventName, callback) => this.off(eventName, callback),\n            on: (eventName, callback) => this.on(eventName, callback),\n        };\n    }\n    /**\n     * Subscribe on Events\n     * @param {String} eventName\n     * @param {Function} callback\n     */\n    on(eventName, callback) {\n        this.Editor.Events.on(eventName, callback);\n    }\n    /**\n     * Emit event with data\n     * @param {String} eventName\n     * @param {Object} data\n     */\n    emit(eventName, data) {\n        this.Editor.Events.emit(eventName, data);\n    }\n    /**\n     * Unsubscribe from Event\n     * @param {String} eventName\n     * @param {Function} callback\n     */\n    off(eventName, callback) {\n        this.Editor.Events.off(eventName, callback);\n    }\n}\n","/**\n * @class API\n * Provides with methods working with DOM Listener\n */\nexport default class ListenerAPI extends Module {\n    /**\n     * Save Editor config. API provides passed configuration to the Blocks\n     */\n    constructor({ config }) {\n        super({ config });\n    }\n    /**\n     * Available methods\n     * @return {IToolbarAPI}\n     */\n    get methods() {\n        return {\n            on: (element, eventType, handler, useCapture) => this.on(element, eventType, handler, useCapture),\n            off: (element, eventType, handler) => this.off(element, eventType, handler),\n        };\n    }\n    /**\n     * adds DOM event listener\n     *\n     * @param {HTMLElement} element\n     * @param {string} eventType\n     * @param {() => void} handler\n     * @param {boolean} useCapture\n     */\n    on(element, eventType, handler, useCapture) {\n        this.Editor.Listeners.on(element, eventType, handler, useCapture);\n    }\n    /**\n     * Removes DOM listener from element\n     *\n     * @param element\n     * @param eventType\n     * @param handler\n     */\n    off(element, eventType, handler) {\n        this.Editor.Listeners.off(element, eventType, handler);\n    }\n}\n","/**\n * @class API\n * Provides CodeX Editor Sanitizer that allows developers to clean their HTML\n */\nexport default class SanitizerAPI extends Module {\n    /**\n     * Save Editor config. API provides passed configuration to the Blocks\n     */\n    constructor({ config }) {\n        super({ config });\n    }\n    /**\n     * Available methods\n     * @return {ISanitizerAPI}\n     */\n    get methods() {\n        return {\n            clean: (taintString, config) => this.clean(taintString, config),\n        };\n    }\n    clean(taintString, config) {\n        return this.Editor.Sanitizer.clean(taintString, config);\n    }\n}\n","/**\n * @class SaverAPI\n * provides with methods to save data\n */\nexport default class SaverAPI extends Module {\n    /**\n     * Save Editor config. API provides passed configuration to the Blocks\n     */\n    constructor({ config }) {\n        super({ config });\n    }\n    /**\n     * Available methods\n     * @return {ISaverAPI}\n     */\n    get methods() {\n        return {\n            save: () => this.save(),\n        };\n    }\n    /**\n     * Return Editor's data\n     */\n    save() {\n        return this.Editor.Saver.save();\n    }\n}\n","import Selection from '../selection';\n/**\n * @class API\n * Provides with methods working with Selection\n */\nexport default class SelectionAPI extends Module {\n    /**\n     * Save Editor config. API provides passed configuration to the Blocks\n     */\n    constructor({ config }) {\n        super({ config });\n    }\n    /**\n     * Available methods\n     * @return {ISelectionAPI}\n     */\n    get methods() {\n        return {\n            findParentTag: (tagName, className) => this.findParentTag(tagName, className),\n            expandToTag: (node) => this.expandToTag(node),\n        };\n    }\n    /**\n     * Looks ahead from selection and find passed tag with class name\n     * @param {string} tagName - tag to find\n     * @param {string} className - tag's class name\n     * @return {HTMLElement|null}\n     */\n    findParentTag(tagName, className) {\n        return new Selection().findParentTag(tagName, className);\n    }\n    /**\n     * Expand selection to passed tag\n     * @param {HTMLElement} node - tag that should contain selection\n     */\n    expandToTag(node) {\n        new Selection().expandToTag(node);\n    }\n}\n","/**\n * @class ToolbarsAPI\n * provides with methods working with Toolbar\n */\nexport default class ToolbarAPI extends Module {\n    /**\n     * Save Editor config. API provides passed configuration to the Blocks\n     */\n    constructor({ config }) {\n        super({ config });\n    }\n    /**\n     * Available methods\n     * @return {IToolbarAPI}\n     */\n    get methods() {\n        return {\n            close: () => this.close(),\n            open: () => this.open(),\n        };\n    }\n    /**\n     * Open toolbar\n     */\n    open() {\n        this.Editor.Toolbar.open();\n    }\n    /**\n     * Close toolbar and all included elements\n     */\n    close() {\n        this.Editor.Toolbar.close();\n    }\n}\n","/**\n * @class API\n */\nexport default class API extends Module {\n    /**\n     * Save Editor config. API provides passed configuration to the Blocks\n     * @param {EditorConfig} config\n     */\n    constructor({ config }) {\n        super({ config });\n    }\n    get methods() {\n        return {\n            blocks: this.Editor.BlocksAPI.methods,\n            caret: {},\n            events: this.Editor.EventsAPI.methods,\n            listener: this.Editor.ListenerAPI.methods,\n            sanitizer: this.Editor.SanitizerAPI.methods,\n            saver: this.Editor.SaverAPI.methods,\n            selection: this.Editor.SelectionAPI.methods,\n            toolbar: this.Editor.ToolbarAPI.methods,\n        };\n    }\n}\n","export default class BlockEvents extends Module {\n    /**\n     * @constructor\n     */\n    constructor({ config }) {\n        super({ config });\n    }\n    /**\n     * All keydowns on Block\n     * @param {KeyboardEvent} event - keydown\n     */\n    keydown(event) {\n        /**\n         * Run common method for all keydown events\n         */\n        this.beforeKeydownProcessing();\n        /**\n         * Fire keydown processor by event.keyCode\n         */\n        switch (event.keyCode) {\n            case _.keyCodes.BACKSPACE:\n                this.backspace(event);\n                break;\n            case _.keyCodes.ENTER:\n                this.enter(event);\n                break;\n            case _.keyCodes.DOWN:\n            case _.keyCodes.RIGHT:\n                this.arrowRightAndDown();\n                break;\n            case _.keyCodes.UP:\n            case _.keyCodes.LEFT:\n                this.arrowLeftAndUp();\n                break;\n            default:\n                this.defaultHandler();\n                break;\n        }\n    }\n    /**\n     * Fires on keydown before event processing\n     */\n    beforeKeydownProcessing() {\n        /**\n         * Clear all highlightings\n         */\n        this.Editor.BlockManager.clearHighlightings();\n        /**\n         * Hide Toolbar\n         */\n        this.Editor.Toolbar.close();\n    }\n    /**\n     * Key up on Block:\n     * - shows Inline Toolbar if something selected\n     */\n    keyup(event) {\n        this.Editor.InlineToolbar.handleShowingEvent(event);\n    }\n    /**\n     * Mouse up on Block:\n     * - shows Inline Toolbar if something selected\n     */\n    mouseUp(event) {\n        this.Editor.InlineToolbar.handleShowingEvent(event);\n    }\n    /**\n     * ENTER pressed on block\n     * @param {KeyboardEvent} event - keydown\n     */\n    enter(event) {\n        const currentBlock = this.Editor.BlockManager.currentBlock, toolsConfig = this.config.toolsConfig[currentBlock.name];\n        /**\n         * Don't handle Enter keydowns when Tool sets enableLineBreaks to true.\n         * Uses for Tools like <code> where line breaks should be handled by default behaviour.\n         */\n        if (toolsConfig && toolsConfig[this.Editor.Tools.apiSettings.IS_ENABLED_LINE_BREAKS]) {\n            return;\n        }\n        /**\n         * Allow to create linebreaks by Shift+Enter\n         */\n        if (event.shiftKey) {\n            return;\n        }\n        /**\n         * Split the Current Block into two blocks\n         */\n        this.Editor.BlockManager.split();\n        /**\n         * Renew local current node after split\n         */\n        const newCurrent = this.Editor.BlockManager.currentBlock;\n        this.Editor.Toolbar.move();\n        /**\n         * If new Block is empty\n         */\n        if (this.Editor.Tools.isInitial(newCurrent.tool) && newCurrent.isEmpty) {\n            /**\n             * Show Toolbar\n             */\n            this.Editor.Toolbar.open();\n            /**\n             * Show Plus Button\n             */\n            this.Editor.Toolbar.plusButton.show();\n        }\n        event.preventDefault();\n    }\n    /**\n     * Handle backspace keydown on Block\n     * @param {KeyboardEvent} event - keydown\n     */\n    backspace(event) {\n        const BM = this.Editor.BlockManager;\n        const isFirstBlock = BM.currentBlockIndex === 0, canMergeBlocks = this.Editor.Caret.isAtStart && !isFirstBlock;\n        /** If current Block is empty just remove this Block */\n        if (this.Editor.BlockManager.currentBlock.isEmpty) {\n            this.Editor.BlockManager.removeBlock();\n            if (this.Editor.Caret.navigatePrevious(true)) {\n                this.Editor.Toolbar.close();\n            }\n            return;\n        }\n        if (!canMergeBlocks) {\n            return;\n        }\n        // preventing browser default behaviour\n        event.preventDefault();\n        const targetBlock = BM.getBlockByIndex(BM.currentBlockIndex - 1), blockToMerge = BM.currentBlock;\n        /**\n         * Blocks that can be merged:\n         * 1) with the same Name\n         * 2) Tool has 'merge' method\n         *\n         * other case will handle as usual ARROW LEFT behaviour\n         */\n        if (blockToMerge.name !== targetBlock.name || !targetBlock.mergeable) {\n            if (this.Editor.Caret.navigatePrevious()) {\n                this.Editor.Toolbar.close();\n            }\n            return;\n        }\n        this.Editor.Caret.createShadow(targetBlock.pluginsContent);\n        BM.mergeBlocks(targetBlock, blockToMerge)\n            .then(() => {\n            /** Restore caret position after merge */\n            this.Editor.Caret.restoreCaret(targetBlock.pluginsContent);\n            targetBlock.pluginsContent.normalize();\n            this.Editor.Toolbar.close();\n        });\n    }\n    /**\n     * Handle right and down keyboard keys\n     */\n    arrowRightAndDown() {\n        this.Editor.Caret.navigateNext();\n    }\n    /**\n     * Handle left and up keyboard keys\n     */\n    arrowLeftAndUp() {\n        this.Editor.Caret.navigatePrevious();\n    }\n    /**\n     * Default keydown handler\n     */\n    defaultHandler() { }\n}\n","/**\n * @class BlockManager\n * @classdesc Manage editor`s blocks storage and appearance\n *\n * @module BlockManager\n *\n * @version 2.0.0\n */\n\nimport Block from '../block';\n\n/**\n * @typedef {BlockManager} BlockManager\n * @property {Number} currentBlockIndex - Index of current working block\n * @property {Proxy} _blocks - Proxy for Blocks instance {@link Blocks}\n */\nexport default class BlockManager extends Module {\n  /**\n   * @constructor\n   * @param {EditorConfig} config\n   */\n  constructor({config}) {\n    super({config});\n\n    /**\n     * Proxy for Blocks instance {@link Blocks}\n     *\n     * @type {Proxy}\n     * @private\n     */\n    this._blocks = null;\n\n    /**\n     * Index of current working block\n     *\n     * @type {number}\n     * @private\n     */\n    this.currentBlockIndex = -1;\n  }\n\n  /**\n   * Should be called after Editor.UI preparation\n   * Define this._blocks property\n   *\n   * @returns {Promise}\n   */\n  prepare() {\n    return new Promise(resolve => {\n      let blocks = new Blocks(this.Editor.UI.nodes.redactor);\n\n      /**\n       * We need to use Proxy to overload set/get [] operator.\n       * So we can use array-like syntax to access blocks\n       *\n       * @example\n       * this._blocks[0] = new Block(...);\n       *\n       * block = this._blocks[0];\n       *\n       * @todo proxy the enumerate method\n       *\n       * @type {Proxy}\n       * @private\n       */\n      this._blocks = new Proxy(blocks, {\n        set: Blocks.set,\n        get: Blocks.get\n      });\n\n      resolve();\n    });\n  }\n\n  /**\n   * Creates Block instance by tool name\n   *\n   * @param {String} toolName - tools passed in editor config {@link EditorConfig#tools}\n   * @param {Object} data - constructor params\n   * @param {Object} settings - block settings\n   *\n   * @return {Block}\n   */\n  composeBlock(toolName, data, settings) {\n    let toolInstance = this.Editor.Tools.construct(toolName, data),\n      block = new Block(toolName, toolInstance, settings, this.Editor.API.methods);\n\n    this.bindEvents(block);\n    /**\n     * Apply callback before inserting html\n     */\n    block.call('appendCallback', {});\n\n    return block;\n  }\n\n  /**\n   * Bind Events\n   * @param {Object} block\n   */\n  bindEvents(block) {\n    this.Editor.Listeners.on(block.holder, 'keydown', (event) => this.Editor.BlockEvents.keydown(event));\n    this.Editor.Listeners.on(block.holder, 'mouseup', (event) => this.Editor.BlockEvents.mouseUp(event));\n    this.Editor.Listeners.on(block.holder, 'keyup', (event) => this.Editor.BlockEvents.keyup(event));\n  }\n\n  /**\n   * Insert new block into _blocks\n   *\n   * @param {String} toolName  plugin name, by default method inserts initial block type\n   * @param {Object} data  plugin data\n   * @param {Object} settings - default settings\n   *\n   * @return {Block}\n   */\n  insert(toolName = this.config.initialBlock, data = {}, settings = {}) {\n    let block = this.composeBlock(toolName, data, settings);\n\n    this._blocks[++this.currentBlockIndex] = block;\n    this.Editor.Caret.setToBlock(block);\n\n    return block;\n  }\n\n  /**\n   * Merge two blocks\n   * @param {Block} targetBlock - previous block will be append to this block\n   * @param {Block} blockToMerge - block that will be merged with target block\n   *\n   * @return {Promise} - the sequence that can be continued\n   */\n  mergeBlocks(targetBlock, blockToMerge) {\n    let blockToMergeIndex = this._blocks.indexOf(blockToMerge);\n\n    return Promise.resolve()\n      .then( () => {\n        if (blockToMerge.isEmpty) {\n          return;\n        }\n\n        return blockToMerge.data\n          .then((blockToMergeInfo) => {\n            targetBlock.mergeWith(blockToMergeInfo.data);\n          });\n      })\n      .then( () => {\n        this.removeBlock(blockToMergeIndex);\n        this.currentBlockIndex = this._blocks.indexOf(targetBlock);\n      });\n  }\n\n  /**\n   * Remove block with passed index or remove last\n   * @param {Number|null} index\n   */\n  removeBlock(index) {\n    if (!index) {\n      index = this.currentBlockIndex;\n    }\n    this._blocks.remove(index);\n  }\n\n  /**\n   * Split current Block\n   * 1. Extract content from Caret position to the Block`s end\n   * 2. Insert a new Block below current one with extracted content\n   */\n  split() {\n    let extractedFragment = this.Editor.Caret.extractFragmentFromCaretPosition(),\n      wrapper = $.make('div');\n\n    wrapper.append(extractedFragment);\n\n    /**\n     * @todo make object in accordance with Tool\n     */\n    let data = {\n      text: $.isEmpty(wrapper) ? '' : wrapper.innerHTML,\n    };\n\n    /**\n     * Renew current Block\n     * @type {Block}\n     */\n    const blockInserted = this.insert(this.config.initialBlock, data);\n\n    this.currentNode = blockInserted.pluginsContent;\n  }\n\n  /**\n   * Replace current working block\n   *\n   * @param {String} toolName  plugin name\n   * @param {Object} data  plugin data\n   */\n  replace(toolName, data = {}) {\n    let block = this.composeBlock(toolName, data);\n\n    this._blocks.insert(this.currentBlockIndex, block, true);\n  }\n\n  /**\n   * returns last Block\n   * @return {Block}\n   */\n  get lastBlock() {\n    return this._blocks[this._blocks.length - 1];\n  }\n\n  /**\n   * Returns Block by passed index\n   * @param {Number} index\n   * @return {Block}\n   */\n  getBlockByIndex(index) {\n    return this._blocks[index];\n  }\n\n  /**\n   * Get Block instance by html element\n   * @param {Node} element\n   * @returns {Block}\n   */\n  getBlock(element) {\n    if (!$.isElement(element)) {\n      element = element.parentNode;\n    }\n\n    let nodes = this._blocks.nodes,\n      firstLevelBlock = element.closest(`.${Block.CSS.wrapper}`),\n      index = nodes.indexOf(firstLevelBlock);\n\n    if (index >= 0) {\n      return this._blocks[index];\n    }\n  }\n\n  /**\n   * Get current Block instance\n   *\n   * @return {Block}\n   */\n  get currentBlock() {\n    return this._blocks[this.currentBlockIndex];\n  }\n\n  /**\n   * Returns next Block instance\n   * @return {Block|null}\n   */\n  get nextBlock() {\n    let isLastBlock = this.currentBlockIndex === (this._blocks.length - 1);\n\n    if (isLastBlock) {\n      return null;\n    }\n\n    return this._blocks[this.currentBlockIndex + 1];\n  }\n\n  /**\n   * Returns previous Block instance\n   * @return {Block|null}\n   */\n  get previousBlock() {\n    let isFirstBlock = this.currentBlockIndex === 0;\n\n    if (isFirstBlock) {\n      return null;\n    }\n\n    return this._blocks[this.currentBlockIndex - 1];\n  }\n\n  /**\n   * Get working html element\n   *\n   * @return {HTMLElement}\n   */\n  get currentNode() {\n    return this._blocks.nodes[this.currentBlockIndex];\n  }\n\n  /**\n   * Set currentBlockIndex to passed block\n   * @param {Node} element\n   */\n  set currentNode(element) {\n    let nodes = this._blocks.nodes,\n      firstLevelBlock = element.closest(`.${Block.CSS.wrapper}`);\n\n    /**\n     * Update current Block's index\n     * @type {number}\n     */\n    this.currentBlockIndex = nodes.indexOf(firstLevelBlock);\n  }\n\n  /**\n   * Remove selection from all Blocks then highlight only Current Block\n   */\n  highlightCurrentNode() {\n    /**\n     * Remove previous selected Block's state\n     */\n    this.clearHighlightings();\n\n    /**\n     * Mark current Block as selected\n     * @type {boolean}\n     */\n    this.currentBlock.selected = true;\n  }\n\n  /**\n   * Remove selection from all Blocks\n   */\n  clearHighlightings() {\n    this.blocks.forEach( block => block.selected = false);\n  }\n\n  /**\n   * Get array of Block instances\n   *\n   * @returns {Block[]} {@link Blocks#array}\n   */\n  get blocks() {\n    return this._blocks.array;\n  }\n\n  /**\n   * 1) Find first-level Block from passed child Node\n   * 2) Mark it as current\n   *\n   *  @param {Element|Text} childNode - look ahead from this node.\n   *  @throws Error  - when passed Node is not included at the Block\n   */\n  setCurrentBlockByChildNode(childNode) {\n    /**\n     * If node is Text TextNode\n     */\n    if (!$.isElement(childNode)) {\n      childNode = childNode.parentNode;\n    }\n\n    let parentFirstLevelBlock = childNode.closest(`.${Block.CSS.wrapper}`);\n\n    if (parentFirstLevelBlock) {\n      this.currentNode = parentFirstLevelBlock;\n    } else {\n      throw new Error('Can not find a Block from this child Node');\n    }\n  }\n\n  /**\n   * Swap Blocks Position\n   * @param {Number} fromIndex\n   * @param {Number} toIndex\n   */\n  swap(fromIndex, toIndex) {\n    /** Move up current Block */\n    this._blocks.swap(fromIndex, toIndex);\n\n    /** Now actual block moved up so that current block index decreased */\n    this.currentBlockIndex = toIndex;\n  }\n  /**\n   * Clears Editor\n   * @param {boolean} needAddInitialBlock - 1) in internal calls (for example, in api.blocks.render)\n   *                                        we don't need to add empty initial block\n   *                                        2) in api.blocks.clear we should add empty block\n   */\n  clear(needAddInitialBlock = false) {\n    this._blocks.removeAll();\n    this.currentBlockIndex = -1;\n\n    if (needAddInitialBlock) {\n      this.insert(this.config.initialBlock);\n    }\n  }\n};\n\n/**\n * @class Blocks\n * @classdesc Class to work with Block instances array\n *\n * @private\n *\n * @property {HTMLElement} workingArea  editor`s working node\n *\n */\nclass Blocks {\n  /**\n   * @constructor\n   *\n   * @param {HTMLElement} workingArea  editor`s working node\n   */\n  constructor(workingArea) {\n    this.blocks = [];\n    this.workingArea = workingArea;\n  }\n\n  /**\n   * Push back new Block\n   *\n   * @param {Block} block\n   */\n  push(block) {\n    this.blocks.push(block);\n    this.workingArea.appendChild(block.holder);\n  }\n\n  /**\n   * Swaps blocks with indexes first and second\n   * @param {Number} first - first block index\n   * @param {Number} second - second block index\n   */\n  swap(first, second) {\n    let secondBlock = this.blocks[second];\n\n    /**\n     * Change in DOM\n     */\n    $.swap(this.blocks[first].holder, secondBlock.holder);\n\n    /**\n     * Change in array\n     */\n    this.blocks[second] = this.blocks[first];\n    this.blocks[first] = secondBlock;\n  }\n\n  /**\n   * Insert new Block at passed index\n   *\n   * @param {Number} index  index to insert Block\n   * @param {Block} block  Block to insert\n   * @param {Boolean} replace  it true, replace block on given index\n   */\n  insert(index, block, replace = false) {\n    if (!this.length) {\n      this.push(block);\n      return;\n    }\n\n    if (index > this.length) {\n      index = this.length;\n    }\n\n    if (replace) {\n      this.blocks[index].holder.remove();\n    }\n\n    let deleteCount = replace ? 1 : 0;\n\n    this.blocks.splice(index, deleteCount, block);\n\n    if (index > 0) {\n      let previousBlock = this.blocks[index - 1];\n\n      previousBlock.holder.insertAdjacentElement('afterend', block.holder);\n    } else {\n      let nextBlock = this.blocks[index + 1];\n\n      if (nextBlock) {\n        nextBlock.holder.insertAdjacentElement('beforebegin', block.holder);\n      } else {\n        this.workingArea.appendChild(block.holder);\n      }\n    }\n  }\n\n  /**\n   * Remove block\n   * @param {Number|null} index\n   */\n  remove(index) {\n    if (isNaN(index)) {\n      index = this.length - 1;\n    }\n\n    this.blocks[index].holder.remove();\n    this.blocks.splice(index, 1);\n  }\n\n  /**\n   * Remove all blocks\n   */\n  removeAll() {\n    this.workingArea.innerHTML = '';\n    this.blocks.length = 0;\n  }\n\n  /**\n   * Insert Block after passed target\n   *\n   * @todo decide if this method is necessary\n   *\n   * @param {Block} targetBlock  target after wich Block should be inserted\n   * @param {Block} newBlock  Block to insert\n   */\n  insertAfter(targetBlock, newBlock) {\n    let index = this.blocks.indexOf(targetBlock);\n\n    this.insert(index + 1, newBlock);\n  }\n\n  /**\n   * Get Block by index\n   *\n   * @param {Number} index  Block index\n   * @returns {Block}\n   */\n  get(index) {\n    return this.blocks[index];\n  }\n\n  /**\n   * Return index of passed Block\n   *\n   * @param {Block} block\n   * @returns {Number}\n   */\n  indexOf(block) {\n    return this.blocks.indexOf(block);\n  }\n\n  /**\n   * Get length of Block instances array\n   *\n   * @returns {Number}\n   */\n  get length() {\n    return this.blocks.length;\n  }\n\n  /**\n   * Get Block instances array\n   *\n   * @returns {Block[]}\n   */\n  get array() {\n    return this.blocks;\n  }\n\n  /**\n   * Get blocks html elements array\n   *\n   * @returns {HTMLElement[]}\n   */\n  get nodes() {\n    return _.array(this.workingArea.children);\n  }\n\n  /**\n   * Proxy trap to implement array-like setter\n   *\n   * @example\n   * blocks[0] = new Block(...)\n   *\n   * @param {Blocks} instance  Blocks instance\n   * @param {Number|String} index  block index\n   * @param {Block} block  Block to set\n   * @returns {Boolean}\n   */\n  static set(instance, index, block) {\n    if (isNaN(Number(index))) {\n      return false;\n    }\n\n    instance.insert(index, block);\n\n    return true;\n  }\n\n  /**\n   * Proxy trap to implement array-like getter\n   *\n   * @param {Blocks} instance  Blocks instance\n   * @param {Number|String} index  Block index\n   * @returns {Block|*}\n   */\n  static get(instance, index) {\n    if (isNaN(Number(index))) {\n      return instance[index];\n    }\n\n    return instance.get(index);\n  }\n}\n","/**\n * @class Caret\n * @classdesc Contains methods for working Caret\n *\n * Uses Range methods to manipulate with caret\n *\n * @module Caret\n *\n * @version 2.0.0\n */\n\nimport Selection from '../selection';\n\n/**\n * @typedef {Caret} Caret\n */\nexport default class Caret extends Module {\n  /**\n   * @constructor\n   */\n  constructor({config}) {\n    super({config});\n  }\n\n  /**\n   * Elements styles that can be useful for Caret Module\n   */\n  static get CSS() {\n    return {\n      shadowCaret: 'cdx-shadow-caret'\n    };\n  };\n\n  /**\n   * Method gets Block instance and puts caret to the text node with offset\n   * There two ways that method applies caret position:\n   *   - first found text node: sets at the beginning, but you can pass an offset\n   *   - last found text node: sets at the end of the node. Also, you can customize the behaviour\n   *\n   * @param {Block} block - Block class\n   * @param {Number} offset - caret offset regarding to the text node\n   * @param {Boolean} atEnd - put caret at the end of the text node or not\n   */\n  setToBlock(block, offset = 0, atEnd = false) {\n    let element = block.pluginsContent;\n\n    /** If Element is INPUT */\n    if ($.isNativeInput(element)) {\n      element.focus();\n      return;\n    }\n\n    let nodeToSet = $.getDeepestNode(element, atEnd);\n\n    if (atEnd || offset > nodeToSet.length) {\n      offset = nodeToSet.length;\n    }\n\n    /** if found deepest node is native input */\n    if ($.isNativeInput(nodeToSet)) {\n      nodeToSet.focus();\n      return;\n    }\n\n    /**\n     * @todo try to fix via Promises or use querySelectorAll to not to use timeout\n     */\n    _.delay( () => {\n      this.set(nodeToSet, offset);\n    }, 20)();\n\n    this.Editor.BlockManager.currentNode = block.holder;\n  }\n\n  /**\n   * Creates Document Range and sets caret to the element with offset\n   * @param {Element} element - target node.\n   * @param {Number} offset - offset\n   */\n  set( element, offset = 0) {\n    let range     = document.createRange(),\n      selection = Selection.get();\n\n    range.setStart(element, offset);\n    range.setEnd(element, offset);\n\n    selection.removeAllRanges();\n    selection.addRange(range);\n  };\n\n  /**\n   * Set Caret to the last Block\n   * If last block is not empty, append another empty block\n   */\n  setToTheLastBlock() {\n    let lastBlock = this.Editor.BlockManager.lastBlock;\n\n    if (!lastBlock) return;\n\n    /**\n     * If last block is empty and it is an initialBlock, set to that.\n     * Otherwise, append new empty block and set to that\n     */\n    if (lastBlock.isEmpty) {\n      this.setToBlock(lastBlock);\n    } else {\n      this.Editor.BlockManager.insert(this.config.initialBlock);\n    }\n  }\n\n  /**\n   * Extract content fragment of current Block from Caret position to the end of the Block\n   */\n  extractFragmentFromCaretPosition() {\n    let selection = Selection.get();\n\n    if (selection.rangeCount) {\n      let selectRange = selection.getRangeAt(0),\n        blockElem = this.Editor.BlockManager.currentBlock.pluginsContent;\n\n      selectRange.deleteContents();\n\n      if (blockElem) {\n        let range = selectRange.cloneRange(true);\n\n        range.selectNodeContents(blockElem);\n        range.setStart(selectRange.endContainer, selectRange.endOffset);\n        return range.extractContents();\n      }\n    }\n  }\n\n  /**\n   * Get all first-level (first child of [contenteditabel]) siblings from passed node\n   * Then you can check it for emptiness\n   *\n   * @example\n   * <div contenteditable>\n   *     <p></p>                            |\n   *     <p></p>                            | left first-level siblings\n   *     <p></p>                            |\n   *     <blockquote><a><b>adaddad</b><a><blockquote>       <-- passed node for example <b>\n   *     <p></p>                            |\n   *     <p></p>                            | right first-level siblings\n   *     <p></p>                            |\n   * </div>\n   *\n   * @return {Element[]}\n   */\n  getHigherLevelSiblings(from, direction ) {\n    let current = from,\n      siblings = [];\n\n    /**\n     * Find passed node's firs-level parent (in example - blockquote)\n     */\n    while (current.parentNode && current.parentNode.contentEditable !== 'true') {\n      current = current.parentNode;\n    }\n\n    let sibling = direction === 'left' ? 'previousSibling' : 'nextSibling';\n\n    /**\n     * Find all left/right siblings\n     */\n    while (current[sibling]) {\n      current = current[sibling];\n      siblings.push(current);\n    }\n\n    return siblings;\n  }\n\n  /**\n   * Set's caret to the next Block\n   * Before moving caret, we should check if caret position is at the end of Plugins node\n   * Using {@link Dom#getDeepestNode} to get a last node and match with current selection\n   *\n   * @param {Boolean} force - force navigation even if caret is not at the end\n   *\n   * @return {Boolean}\n   */\n  navigateNext(force = false) {\n    let nextBlock = this.Editor.BlockManager.nextBlock;\n\n    if (!nextBlock) {\n      return false;\n    }\n\n    if (force || this.isAtEnd) {\n      this.setToBlock(nextBlock);\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Set's caret to the previous Block\n   * Before moving caret, we should check if caret position is start of the Plugins node\n   * Using {@link Dom#getDeepestNode} to get a last node and match with current selection\n   *\n   * @param {Boolean} force - force navigation even if caret is not at the start\n   *\n   * @return {Boolean}\n   */\n  navigatePrevious(force = false) {\n    let previousBlock = this.Editor.BlockManager.previousBlock;\n\n    if (!previousBlock) {\n      return false;\n    }\n\n    if (force || this.isAtStart) {\n      this.setToBlock( previousBlock, 0, true );\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Get's deepest first node and checks if offset is zero\n   * @return {boolean}\n   */\n  get isAtStart() {\n    /**\n     * Don't handle ranges\n     */\n    if (!Selection.isCollapsed) {\n      return false;\n    }\n\n    let selection = Selection.get(),\n      anchorNode = selection.anchorNode,\n      firstNode = $.getDeepestNode(this.Editor.BlockManager.currentBlock.pluginsContent);\n\n    /**\n     * Workaround case when caret in the text like \" |Hello!\"\n     * selection.anchorOffset is 1, but real caret visible position is 0\n     * @type {number}\n     */\n    let firstLetterPosition = anchorNode.textContent.search(/\\S/);\n\n    if (firstLetterPosition === -1) { // empty text\n      firstLetterPosition = 0;\n    }\n\n    /**\n     * In case of\n     * <div contenteditable>\n     *     <p><b></b></p>   <-- first (and deepest) node is <b></b>\n     *     |adaddad         <-- anchor node\n     * </div>\n     */\n    if ($.isEmpty(firstNode)) {\n      let leftSiblings = this.getHigherLevelSiblings(anchorNode, 'left'),\n        nothingAtLeft = leftSiblings.every( node => $.isEmpty(node) );\n\n\n\n      if (nothingAtLeft && selection.anchorOffset === firstLetterPosition) {\n        return true;\n      }\n    }\n\n    /**\n     * We use <= comparison for case:\n     * \"| Hello\"  <--- selection.anchorOffset is 0, but firstLetterPosition is 1\n     */\n    return firstNode === null || anchorNode === firstNode && selection.anchorOffset <= firstLetterPosition;\n  }\n\n  /**\n   * Get's deepest last node and checks if offset is last node text length\n   * @return {boolean}\n   */\n  get isAtEnd() {\n    /**\n     * Don't handle ranges\n     */\n    if (!Selection.isCollapsed) {\n      return false;\n    }\n\n    let selection = Selection.get(),\n      anchorNode = selection.anchorNode,\n      lastNode = $.getDeepestNode(this.Editor.BlockManager.currentBlock.pluginsContent, true);\n\n    /**\n     * In case of\n     * <div contenteditable>\n     *     adaddad|         <-- anchor node\n     *     <p><b></b></p>   <-- first (and deepest) node is <b></b>\n     * </div>\n     */\n    if ($.isEmpty(lastNode)) {\n      let leftSiblings = this.getHigherLevelSiblings(anchorNode, 'right'),\n        nothingAtRight = leftSiblings.every( node => $.isEmpty(node) );\n\n      if (nothingAtRight && selection.anchorOffset === anchorNode.textContent.length) {\n        return true;\n      }\n    }\n\n    /**\n     * Workaround case:\n     * hello |     <--- anchorOffset will be 5, but textContent.length will be 6.\n     * Why not regular .trim():\n     *  in case of ' hello |' trim() will also remove space at the beginning, so length will be lower than anchorOffset\n     */\n    let rightTrimmedText = lastNode.textContent.replace(/\\s+$/, '');\n\n    /**\n     * We use >= comparison for case:\n     * \"Hello |\"  <--- selection.anchorOffset is 7, but rightTrimmedText is 6\n     */\n    return anchorNode === lastNode && selection.anchorOffset >= rightTrimmedText.length;\n  }\n\n  /**\n   * Inserts shadow element after passed element where caret can be placed\n   * @param {Node} element\n   */\n  createShadow(element) {\n    let shadowCaret = document.createElement('span');\n\n    shadowCaret.classList.add(Caret.CSS.shadowCaret);\n    element.insertAdjacentElement('beforeEnd', shadowCaret);\n  }\n\n  /**\n   * Restores caret position\n   * @param {Node} element\n   */\n  restoreCaret(element) {\n    let shadowCaret = element.querySelector(`.${Caret.CSS.shadowCaret}`);\n\n    if (!shadowCaret) {\n      return;\n    }\n\n    /**\n     * After we set the caret to the required place\n     * we need to clear shadow caret\n     *\n     * - make new range\n     * - select shadowed span\n     * - use extractContent to remove it from DOM\n     */\n    let sel = new Selection();\n\n    sel.expandToTag(shadowCaret);\n\n    setTimeout(() => {\n      let newRange = document.createRange();\n\n      newRange.selectNode(shadowCaret);\n      newRange.extractContents();\n    }, 50);\n  }\n}\n","/**\n * @module eventDispatcher\n *\n * Has two important methods:\n *    - {Function} on - appends subscriber to the event. If event doesn't exist - creates new one\n *    - {Function} emit - fires all subscribers with data\n *    - {Function off - unsubsribes callback\n *\n * @version 1.0.0\n *\n * @typedef {Events} Events\n * @property {Object} subscribers - all subscribers grouped by event name\n */\nexport default class Events extends Module {\n  /**\n   * @constructor\n   */\n  constructor({config}) {\n    super({config});\n    this.subscribers = {};\n  }\n\n  /**\n   * Subscribe any event on callback\n   *\n   * @param {String} eventName - event name\n   * @param {Function} callback - subscriber\n   */\n  on(eventName, callback) {\n    if (!(eventName in this.subscribers)) {\n      this.subscribers[eventName] = [];\n    }\n\n    // group by events\n    this.subscribers[eventName].push(callback);\n  }\n\n  /**\n   * Emit callbacks with passed data\n   *\n   * @param {String} eventName - event name\n   * @param {Object} data - subscribers get this data when they were fired\n   */\n  emit(eventName, data) {\n    if (!this.subscribers[eventName]) {\n      return;\n    }\n\n    this.subscribers[eventName].reduce(function (previousData, currentHandler) {\n      let newData = currentHandler(previousData);\n\n      return newData ? newData : previousData;\n    }, data);\n  }\n\n  /**\n   * Unsubsribe callback from event\n   *\n   * @param eventName\n   * @param callback\n   */\n  off(eventName, callback) {\n    for(let i = 0; i < this.subscribers[eventName].length; i++) {\n      if (this.subscribers[eventName][i] === callback) {\n        delete this.subscribers[eventName][i];\n        break;\n      }\n    }\n  }\n\n  /**\n   * Destroyer\n   * clears subsribers list\n   */\n  destroy() {\n    this.subscribers = null;\n  }\n}\n","/**\n * Codex Editor Listeners module\n *\n * @module Listeners\n *\n * Module-decorator for event listeners assignment\n *\n * @author Codex Team\n * @version 2.0.0\n */\n\n/**\n * @typedef {Listeners} Listeners\n * @property {Array} allListeners\n */\nexport default class Listeners extends Module {\n  /**\n   * @constructor\n   * @param {EditorConfig} config\n   */\n  constructor({config}) {\n    super({config});\n    this.allListeners = [];\n  }\n\n  /**\n   * Assigns event listener on element\n   *\n   * @param {Element} element - DOM element that needs to be listened\n   * @param {String} eventType - event type\n   * @param {Function} handler - method that will be fired on event\n   * @param {Boolean} useCapture - use event bubbling\n   */\n  on(element, eventType, handler, useCapture = false) {\n    let assignedEventData = {\n      element,\n      eventType,\n      handler,\n      useCapture\n    };\n\n    let alreadyExist = this.findOne(element, eventType, handler);\n\n    if (alreadyExist) return;\n\n    this.allListeners.push(assignedEventData);\n    element.addEventListener(eventType, handler, useCapture);\n  }\n\n  /**\n   * Removes event listener from element\n   *\n   * @param {Element} element - DOM element that we removing listener\n   * @param {String} eventType - event type\n   * @param {Function} handler - remove handler, if element listens several handlers on the same event type\n   * @param {Boolean} useCapture - use event bubbling\n   */\n  off(element, eventType, handler, useCapture = false) {\n    let existingListeners = this.findAll(element, eventType, handler);\n\n    for (let i = 0; i < existingListeners.length; i++) {\n      let index = this.allListeners.indexOf(existingListeners[i]);\n\n      if (index > 0) {\n        this.allListeners.splice(index, 1);\n      }\n    }\n\n    element.removeEventListener(eventType, handler, useCapture);\n  }\n\n  /**\n   * Search method: looks for listener by passed element\n   * @param {Element} element - searching element\n   * @returns {Array} listeners that found on element\n   */\n  findByElement(element) {\n    let listenersOnElement = [];\n\n    for (let i = 0; i < this.allListeners.length; i++) {\n      let listener = this.allListeners[i];\n\n      if (listener.element === element) {\n        listenersOnElement.push(listener);\n      }\n    }\n\n    return listenersOnElement;\n  }\n\n  /**\n   * Search method: looks for listener by passed event type\n   * @param {String} eventType\n   * @return {Array} listeners that found on element\n   */\n  findByType(eventType) {\n    let listenersWithType = [];\n\n    for (let i = 0; i < this.allListeners.length; i++) {\n      let listener = this.allListeners[i];\n\n      if (listener.type === eventType) {\n        listenersWithType.push(listener);\n      }\n    }\n\n    return listenersWithType;\n  }\n\n  /**\n   * Search method: looks for listener by passed handler\n   * @param {Function} handler\n   * @return {Array} listeners that found on element\n   */\n  findByHandler(handler) {\n    let listenersWithHandler = [];\n\n    for (let i = 0; i < this.allListeners.length; i++) {\n      let listener = this.allListeners[i];\n\n      if (listener.handler === handler) {\n        listenersWithHandler.push(listener);\n      }\n    }\n\n    return listenersWithHandler;\n  }\n\n  /**\n   * @param {Element} element\n   * @param {String} eventType\n   * @param {Function} handler\n   * @return {Element|null}\n   */\n  findOne(element, eventType, handler) {\n    let foundListeners = this.findAll(element, eventType, handler);\n\n    return foundListeners.length > 0 ? foundListeners[0] : null;\n  }\n\n  /**\n   * @param {Element} element\n   * @param {String} eventType\n   * @param {Function} handler\n   * @return {Array}\n   */\n  findAll(element, eventType, handler) {\n    let found,\n      foundByElements = element ? this.findByElement(element) : [];\n      // foundByEventType = eventType ? this.findByType(eventType) : [],\n      // foundByHandler = handler ? this.findByHandler(handler) : [];\n\n    if (element && eventType && handler) {\n      found = foundByElements.filter( event => event.eventType === eventType && event.handler === handler );\n    } else if (element && eventType) {\n      found = foundByElements.filter( event => event.eventType === eventType);\n    } else {\n      found = foundByElements;\n    }\n\n    return found;\n  }\n\n  /**\n   * Removes all listeners\n   */\n  removeAll() {\n    this.allListeners.map( (current) => {\n      current.element.removeEventListener(current.eventType, current.handler);\n    });\n\n    this.allListeners = [];\n  }\n}\n","/**\n * Codex Editor Renderer Module\n *\n * @module Renderer\n * @author CodeX Team\n *\n * @version 2.0.0\n */\nexport default class Renderer extends Module {\n  /**\n   * @constructor\n   * @param {EditorConfig} config\n   */\n  constructor({config}) {\n    super({config});\n  }\n\n  /**\n   * @typedef {Object} RendererItems\n   * @property {String} type - tool name\n   * @property {Object} data - tool data\n   */\n\n  /**\n   * @example\n   *\n   * items: [\n   * {\n   *    type : 'paragraph',\n   *    data : {\n   *        text : 'Hello from Codex!'\n   *    }\n   * },\n   * {\n   *   type : 'paragraph',\n   *   data : {\n   *        text : 'Leave feedback if you like it!'\n   *   }\n   * },\n   * ]\n   *\n   */\n\n  /**\n   * Make plugin blocks from array of plugin`s data\n   * @param {RendererItems[]} items\n   */\n  render(items) {\n    let chainData = [];\n\n    for (let i = 0; i < items.length; i++) {\n      chainData.push({\n        function: () => this.insertBlock(items[i])\n      });\n    }\n\n    return _.sequence(chainData);\n  }\n\n  /**\n   * Get plugin instance\n   * Add plugin instance to BlockManager\n   * Insert block to working zone\n   *\n   * @param {Object} item\n   * @returns {Promise.<T>}\n   * @private\n   */\n  insertBlock(item) {\n    let tool = item.type,\n      data = item.data,\n      settings = item.settings;\n\n    if (tool in this.Editor.Tools.available) {\n      this.Editor.BlockManager.insert(tool, data, settings);\n    } else {\n      /**\n       * @todo show warning notification message\n       *\n       * `${tool} blocks was skipped.`\n       */\n\n      _.log(`Tool ${tool} is not found. Check 'tools' property at your initial CodeX Editor config.`, 'warn');\n    }\n\n    return Promise.resolve();\n  }\n}\n","/**\n * CodeX Sanitizer\n *\n * @module Sanitizer\n * Clears HTML from taint tags\n *\n * @version 2.0.0\n *\n * @example\n *  Module can be used within two ways:\n *     1) When you have an instance\n *         - this.Editor.Sanitizer.clean(yourTaintString);\n *     2) As static method\n *         - CodexEditor.Sanitizer.clean(yourTaintString, yourCustomConfiguration);\n *\n * {@link SanitizerConfig}\n */\n\n\n/**\n * @typedef {Object} SanitizerConfig\n * @property {Object} tags - define tags restrictions\n *\n * @example\n *\n * tags : {\n *     p: true,\n *     a: {\n *       href: true,\n *       rel: \"nofollow\",\n *       target: \"_blank\"\n *     }\n * }\n */\nexport default class Sanitizer extends Module {\n  /**\n   * Initializes Sanitizer module\n   * Sets default configuration if custom not exists\n   *\n   * @property {SanitizerConfig} this.defaultConfig\n   * @property {HTMLJanitor} this._sanitizerInstance - Sanitizer library\n   *\n   * @param {SanitizerConfig} config\n   */\n  constructor({config}) {\n    super({config});\n\n    // default config\n    this.defaultConfig = null;\n    this._sanitizerInstance = null;\n\n    /** Custom configuration */\n    this.sanitizerConfig = config.settings ? config.settings.sanitizer : {};\n\n    /** HTML Janitor library */\n    this.sanitizerInstance = require('html-janitor');\n  }\n\n  /**\n   * If developer uses editor's API, then he can customize sanitize restrictions.\n   * Or, sanitizing config can be defined globally in editors initialization. That config will be used everywhere\n   * At least, if there is no config overrides, that API uses Default configuration\n   *\n   * @uses https://www.npmjs.com/package/html-janitor\n   *\n   * @param {HTMLJanitor} library - sanitizer extension\n   */\n  set sanitizerInstance(library) {\n    this._sanitizerInstance = new library(this.defaultConfig);\n  }\n\n  /**\n   * Sets sanitizer configuration. Uses default config if user didn't pass the restriction\n   * @param {SanitizerConfig} config\n   */\n  set sanitizerConfig(config) {\n    if (_.isEmpty(config)) {\n      this.defaultConfig = {\n        tags: {\n          p: {},\n          a: {\n            href: true,\n            target: '_blank',\n            rel: 'nofollow'\n          }\n        }\n      };\n    } else {\n      this.defaultConfig = config;\n    }\n  }\n\n  /**\n   * Cleans string from unwanted tags\n   * @param {String} taintString - HTML string\n   * @param {Object} customConfig - custom sanitizer configuration. Method uses default if param is empty\n   * @return {String} clean HTML\n   */\n  clean(taintString, customConfig = {}) {\n    if (_.isEmpty(customConfig)) {\n      return this._sanitizerInstance.clean(taintString);\n    } else {\n      return Sanitizer.clean(taintString, customConfig);\n    }\n  }\n\n  /**\n   * Cleans string from unwanted tags\n   * @static\n   *\n   * Method allows to use default config\n   *\n   * @param {String} taintString - taint string\n   * @param {SanitizerConfig} customConfig - allowed tags\n   *\n   * @return {String} clean HTML\n   */\n  static clean(taintString, customConfig) {\n    let newInstance = Sanitizer(customConfig);\n\n    return newInstance.clean(taintString);\n  }\n}\n","/**\n * Codex Editor Saver\n *\n * @module Saver\n * @author Codex Team\n * @version 2.0.0\n */\n\n/**\n * @typedef {Object} SavedData\n * @property {Date} time - saving proccess time\n * @property {Object} items - extracted data\n * @property {String} version - CodexEditor version\n */\n\n/**\n * @classdesc This method reduces all Blocks asyncronically and calls Block's save method to extract data\n *\n * @typedef {Saver} Saver\n * @property {Element} html - Editor HTML content\n * @property {String} json - Editor JSON output\n */\nexport default class Saver extends Module {\n  /**\n   * @constructor\n   * @param config\n   */\n  constructor({config}) {\n    super({config});\n\n    this.output = null;\n    this.blocksData = [];\n  }\n\n  /**\n   * Composes new chain of Promises to fire them alternatelly\n   * @return {SavedData}\n   */\n  save() {\n    let blocks = this.Editor.BlockManager.blocks,\n      chainData = [];\n\n    blocks.forEach((block) => {\n      chainData.push(block.data);\n    });\n\n    return Promise.all(chainData)\n      .then((allExtractedData) => this.makeOutput(allExtractedData))\n      .then((outputData) => {\n        return outputData;\n      });\n  }\n\n  /**\n   * Creates output object with saved data, time and version of editor\n   * @param {Object} allExtractedData\n   * @return {SavedData}\n   */\n  makeOutput(allExtractedData) {\n    let items = [],\n      totalTime = 0;\n\n    console.groupCollapsed('[CodexEditor saving]:');\n\n    allExtractedData.forEach((extraction) => {\n      /** Group process info */\n      console.log(`${extraction.tool} saving info`, extraction);\n      totalTime += extraction.time;\n      items.push({\n        type: extraction.tool,\n        data: extraction.data\n      });\n    });\n\n    console.log('Total', totalTime);\n    console.groupEnd();\n\n    return {\n      time    : +new Date(),\n      items   : items,\n      version : VERSION,\n    };\n  }\n}\n\n// module.exports = (function (saver) {\n//\n//     let editor = codex.editor;\n//\n//     /**\n//      * @public\n//      * Save blocks\n//      */\n//     saver.save = function () {\n//\n//         /** Save html content of redactor to memory */\n//         editor.state.html = editor.nodes.redactor.innerHTML;\n//\n//         /** Clean jsonOutput state */\n//         editor.state.jsonOutput = [];\n//\n//         return saveBlocks(editor.nodes.redactor.childNodes);\n//\n//     };\n//\n//     /**\n//      * @private\n//      * Save each block data\n//      *\n//      * @param blocks\n//      * @returns {Promise.<TResult>}\n//      */\n//     let saveBlocks = function (blocks) {\n//\n//         let data = [];\n//\n//         for(let index = 0; index < blocks.length; index++) {\n//\n//             data.push(getBlockData(blocks[index]));\n//\n//         }\n//\n//         return Promise.all(data)\n//             .then(makeOutput)\n//             .catch(editor.core.log);\n//\n//     };\n//\n//     /** Save and validate block data */\n//     let getBlockData = function (block) {\n//\n//         return saveBlockData(block)\n//             .then(validateBlockData)\n//             .catch(editor.core.log);\n//\n//     };\n//\n//     /**\n//     * @private\n//     * Call block`s plugin save method and return saved data\n//     *\n//     * @param block\n//     * @returns {Object}\n//     */\n//     let saveBlockData = function (block) {\n//\n//         let pluginName = block.dataset.tool;\n//\n//         /** Check for plugin existence */\n//         if (!editor.tools[pluginName]) {\n//\n//             editor.core.log(`Plugin ${pluginName} not found`, 'error');\n//             return {data: null, pluginName: null};\n//\n//         }\n//\n//         /** Check for plugin having save method */\n//         if (typeof editor.tools[pluginName].save !== 'function') {\n//\n//             editor.core.log(`Plugin ${pluginName} must have save method`, 'error');\n//             return {data: null, pluginName: null};\n//\n//         }\n//\n//         /** Result saver */\n//         let blockContent   = block.childNodes[0],\n//             pluginsContent = blockContent.childNodes[0],\n//             position = pluginsContent.dataset.inputPosition;\n//\n//         /** If plugin wasn't available then return data from cache */\n//         if ( editor.tools[pluginName].available === false ) {\n//\n//             return Promise.resolve({data: codex.editor.state.blocks.items[position].data, pluginName});\n//\n//         }\n//\n//         return Promise.resolve(pluginsContent)\n//             .then(editor.tools[pluginName].save)\n//             .then(data => Object({data, pluginName}));\n//\n//     };\n//\n//     /**\n//     * Call plugin`s validate method. Return false if validation failed\n//     *\n//     * @param data\n//     * @param pluginName\n//     * @returns {Object|Boolean}\n//     */\n//     let validateBlockData = function ({data, pluginName}) {\n//\n//         if (!data || !pluginName) {\n//\n//             return false;\n//\n//         }\n//\n//         if (editor.tools[pluginName].validate) {\n//\n//             let result = editor.tools[pluginName].validate(data);\n//\n//             /**\n//              * Do not allow invalid data\n//              */\n//             if (!result) {\n//\n//                 return false;\n//\n//             }\n//\n//         }\n//\n//         return {data, pluginName};\n//\n//\n//     };\n//\n//     /**\n//     * Compile article output\n//     *\n//     * @param savedData\n//     * @returns {{time: number, version, items: (*|Array)}}\n//     */\n//     let makeOutput = function (savedData) {\n//\n//         savedData = savedData.filter(blockData => blockData);\n//\n//         let items = savedData.map(blockData => Object({type: blockData.pluginName, data: blockData.data}));\n//\n//         editor.state.jsonOutput = items;\n//\n//         return {\n//             id: editor.state.blocks.id || null,\n//             time: +new Date(),\n//             version: editor.version,\n//             items\n//         };\n//\n//     };\n//\n//     return saver;\n//\n// })({});\n","/**\n * Block Settings\n *\n *   ____ Settings Panel ____\n *  | ...................... |\n *  | .   Tool Settings    . |\n *  | ...................... |\n *  | .  Default Settings  . |\n *  | ...................... |\n *  |________________________|\n */\nexport default class BlockSettings extends Module {\n  /**\n   * @constructor\n   */\n  constructor({config}) {\n    super({config});\n\n    this.nodes = {\n      wrapper: null,\n      toolSettings: null,\n      defaultSettings: null\n    };\n  }\n\n  /**\n   * Module Events\n   * @return {{opened: string, closed: string}}\n   */\n  get events() {\n    return {\n      opened: 'block-settings-opened',\n      closed: 'block-settings-closed',\n    };\n  }\n\n  /**\n   * Block Settings CSS\n   * @return {{wrapper, wrapperOpened, toolSettings, defaultSettings, button}}\n   */\n  static get CSS() {\n    return {\n      // Settings Panel\n      wrapper: 'ce-settings',\n      wrapperOpened: 'ce-settings--opened',\n      toolSettings: 'ce-settings__plugin-zone',\n      defaultSettings: 'ce-settings__default-zone',\n\n      button: 'ce-settings__button'\n    };\n  }\n\n  /**\n   * Panel with block settings with 2 sections:\n   *  - Tool's Settings\n   *  - Default Settings [Move, Remove, etc]\n   *\n   * @return {Element}\n   */\n  make() {\n    this.nodes.wrapper = $.make('div', BlockSettings.CSS.wrapper);\n\n    this.nodes.toolSettings = $.make('div', BlockSettings.CSS.toolSettings);\n    this.nodes.defaultSettings = $.make('div', BlockSettings.CSS.defaultSettings);\n\n    $.append(this.nodes.wrapper, [this.nodes.toolSettings, this.nodes.defaultSettings]);\n  }\n\n  /**\n   * Add Tool's settings\n   */\n  addToolSettings() {\n    if (typeof this.Editor.BlockManager.currentBlock.tool.makeSettings === 'function') {\n      $.append(this.nodes.toolSettings, this.Editor.BlockManager.currentBlock.tool.makeSettings());\n    }\n  }\n\n  /**\n   * Add default settings\n   */\n  addDefaultSettings() {\n    $.append(this.nodes.defaultSettings, this.Editor.BlockManager.currentBlock.renderTunes());\n  }\n\n  /**\n   * Is Block Settings opened or not\n   * @returns {boolean}\n   */\n  get opened() {\n    return this.nodes.wrapper.classList.contains(BlockSettings.CSS.wrapperOpened);\n  }\n\n  /**\n   * Open Block Settings pane\n   */\n  open() {\n    this.nodes.wrapper.classList.add(BlockSettings.CSS.wrapperOpened);\n\n    /**\n     * Fill Tool's settings\n     */\n    this.addToolSettings();\n\n    /**\n     * Add default settings that presents for all Blocks\n     */\n    this.addDefaultSettings();\n\n    /** Tell to subscribers that block settings is opened */\n    this.Editor.Events.emit(this.events.opened);\n  }\n\n  /**\n   * Close Block Settings pane\n   */\n  close() {\n    this.nodes.wrapper.classList.remove(BlockSettings.CSS.wrapperOpened);\n\n    /** Clear settings */\n    this.nodes.toolSettings.innerHTML = '';\n    this.nodes.defaultSettings.innerHTML = '';\n\n    /** Tell to subscribers that block settings is closed */\n    this.Editor.Events.emit(this.events.closed);\n  }\n}\n","import BoldInlineTool from '../inline-tools/inline-tool-bold';\nimport ItalicInlineTool from '../inline-tools/inline-tool-italic';\nimport LinkInlineTool from '../inline-tools/inline-tool-link';\nimport Selection from '../selection';\nexport default class InlineToolbar extends Module {\n    /**\n     * @constructor\n     */\n    constructor({ config }) {\n        super({ config });\n        /**\n         * CSS styles\n         */\n        this.CSS = {\n            inlineToolbar: 'ce-inline-toolbar',\n            inlineToolbarShowed: 'ce-inline-toolbar--showed',\n            buttonsWrapper: 'ce-inline-toolbar__buttons',\n            actionsWrapper: 'ce-inline-toolbar__actions',\n        };\n        /**\n         * Inline Toolbar elements\n         */\n        this.nodes = {\n            wrapper: null,\n            buttons: null,\n            /**\n             * Zone below the buttons where Tools can create additional actions by 'renderActions()' method\n             * For example, input for the 'link' tool or textarea for the 'comment' tool\n             */\n            actions: null,\n        };\n        /**\n         * Margin above/below the Toolbar\n         */\n        this.toolbarVerticalMargin = 20;\n    }\n    /**\n     * Inline Toolbar Tools\n     * @todo Merge internal tools with external\n     */\n    get tools() {\n        if (!this.toolsInstances) {\n            this.toolsInstances = [\n                new BoldInlineTool(this.Editor.API.methods),\n                new ItalicInlineTool(this.Editor.API.methods),\n                new LinkInlineTool(this.Editor.API.methods),\n                ...this.Editor.Tools.inline.map((Tool) => new Tool(this.Editor.API.methods)),\n            ];\n        }\n        return this.toolsInstances;\n    }\n    /**\n     * Making DOM\n     */\n    make() {\n        this.nodes.wrapper = $.make('div', this.CSS.inlineToolbar);\n        this.nodes.buttons = $.make('div', this.CSS.buttonsWrapper);\n        this.nodes.actions = $.make('div', this.CSS.actionsWrapper);\n        /**\n         * Append Inline Toolbar to the Editor\n         */\n        $.append(this.nodes.wrapper, [this.nodes.buttons, this.nodes.actions]);\n        $.append(this.Editor.UI.nodes.wrapper, this.nodes.wrapper);\n        /**\n         * Append Inline Toolbar Tools\n         */\n        this.addTools();\n    }\n    /**\n     *\n     *\n     *  Moving / appearance\n     *  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n     *\n     */\n    /**\n     * Shows Inline Toolbar by keyup/mouseup\n     * @param {KeyboardEvent|MouseEvent} event\n     */\n    handleShowingEvent(event) {\n        if (!this.allowedToShow(event)) {\n            this.close();\n            return;\n        }\n        this.move();\n        this.open();\n        /** Check Tools state for selected fragment */\n        this.checkToolsState();\n    }\n    /**\n     * Move Toolbar to the selected text\n     */\n    move() {\n        const selectionRect = Selection.rect;\n        const wrapperOffset = this.Editor.UI.nodes.wrapper.getBoundingClientRect();\n        const newCoords = {\n            x: selectionRect.x - wrapperOffset.left,\n            y: selectionRect.y\n                + selectionRect.height\n                // + window.scrollY\n                - wrapperOffset.top\n                + this.toolbarVerticalMargin,\n        };\n        /**\n         * If we know selections width, place InlineToolbar to center\n         */\n        if (selectionRect.width) {\n            newCoords.x += Math.floor(selectionRect.width / 2);\n        }\n        this.nodes.wrapper.style.left = Math.floor(newCoords.x) + 'px';\n        this.nodes.wrapper.style.top = Math.floor(newCoords.y) + 'px';\n    }\n    /**\n     * Shows Inline Toolbar\n     */\n    open() {\n        this.nodes.wrapper.classList.add(this.CSS.inlineToolbarShowed);\n        this.tools.forEach((tool) => {\n            if (typeof tool.clear === 'function') {\n                tool.clear();\n            }\n        });\n    }\n    /**\n     * Hides Inline Toolbar\n     */\n    close() {\n        this.nodes.wrapper.classList.remove(this.CSS.inlineToolbarShowed);\n        this.tools.forEach((tool) => {\n            if (typeof tool.clear === 'function') {\n                tool.clear();\n            }\n        });\n    }\n    /**\n     * Need to show Inline Toolbar or not\n     * @param {KeyboardEvent|MouseEvent} event\n     */\n    allowedToShow(event) {\n        /**\n         * Tags conflicts with window.selection function.\n         * Ex. IMG tag returns null (Firefox) or Redactors wrapper (Chrome)\n         */\n        const tagsConflictsWithSelection = ['IMG', 'INPUT'];\n        if (event && tagsConflictsWithSelection.includes(event.target.tagName)) {\n            return false;\n        }\n        const currentSelection = Selection.get(), selectedText = Selection.text;\n        // old browsers\n        if (!currentSelection || !currentSelection.anchorNode) {\n            return false;\n        }\n        // empty selection\n        if (currentSelection.isCollapsed || selectedText.length < 1) {\n            return false;\n        }\n        // is enabled by current Block's Tool\n        const currentBlock = this.Editor.BlockManager.getBlock(currentSelection.anchorNode);\n        if (!currentBlock) {\n            return false;\n        }\n        const toolConfig = this.config.toolsConfig[currentBlock.name];\n        return toolConfig && toolConfig[this.Editor.Tools.apiSettings.IS_ENABLED_INLINE_TOOLBAR];\n    }\n    /**\n     *\n     *\n     *  Working with Tools\n     *  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n     *\n     */\n    /**\n     * Fill Inline Toolbar with Tools\n     */\n    addTools() {\n        this.tools.forEach((tool) => {\n            this.addTool(tool);\n        });\n    }\n    /**\n     * Add tool button and activate clicks\n     * @param {InlineTool} tool - Tool's instance\n     */\n    addTool(tool) {\n        const button = tool.render();\n        if (!button) {\n            _.log('Render method must return an instance of Node', 'warn', tool);\n            return;\n        }\n        this.nodes.buttons.appendChild(button);\n        if (typeof tool.renderActions === 'function') {\n            const actions = tool.renderActions();\n            this.nodes.actions.appendChild(actions);\n        }\n        this.Editor.Listeners.on(button, 'click', () => {\n            this.toolClicked(tool);\n        });\n    }\n    /**\n     * Inline Tool button clicks\n     * @param {InlineTool} tool - Tool's instance\n     */\n    toolClicked(tool) {\n        const range = Selection.range;\n        tool.surround(range);\n        this.checkToolsState();\n    }\n    /**\n     * Check Tools` state by selection\n     */\n    checkToolsState() {\n        this.tools.forEach((tool) => {\n            tool.checkState(Selection.get());\n        });\n    }\n}\n","/**\n * @class Toolbox\n * @classdesc Holder for Tools\n *\n * @typedef {Toolbox} Toolbox\n * @property {Boolean} opened - opening state\n * @property {Object} nodes   - Toolbox nodes\n * @property {Object} CSS     - CSS class names\n *\n */\nexport default class Toolbox extends Module {\n  /**\n   * @constructor\n   */\n  constructor({config}) {\n    super({config});\n\n    this.nodes = {\n      toolbox: null,\n      buttons: []\n    };\n\n    /**\n     * Opening state\n     * @type {boolean}\n     */\n    this.opened = false;\n  }\n\n  /**\n   * CSS styles\n   * @return {{toolbox: string, toolboxButton: string, toolboxOpened: string}}\n   */\n  static get CSS() {\n    return  {\n      toolbox: 'ce-toolbox',\n      toolboxButton: 'ce-toolbox__button',\n      toolboxOpened: 'ce-toolbox--opened',\n    };\n  }\n\n  /**\n   * Makes the Toolbox\n   */\n  make() {\n    this.nodes.toolbox = $.make('div', Toolbox.CSS.toolbox);\n    $.append(this.Editor.Toolbar.nodes.content, this.nodes.toolbox);\n\n    this.addTools();\n  }\n\n  /**\n   * Iterates available tools and appends them to the Toolbox\n   */\n  addTools() {\n    let tools = this.Editor.Tools.toolsAvailable;\n\n    for (let toolName in tools) {\n      this.addTool(toolName, tools[toolName]);\n    }\n  }\n\n  /**\n   * Append Tool to the Toolbox\n   *\n   * @param {string} toolName  - tool name\n   * @param {Tool}  tool      - tool class\n   */\n  addTool(toolName, tool) {\n    const api = this.Editor.Tools.apiSettings;\n\n    if (tool[api.IS_DISPLAYED_IN_TOOLBOX] && !tool[api.TOOLBAR_ICON_CLASS]) {\n      _.log('Toolbar icon class name is missed. Tool %o skipped', 'warn', toolName);\n      return;\n    }\n\n    /**\n     * @todo Add checkup for the render method\n     */\n    // if (typeof tool.render !== 'function') {\n    //\n    //     _.log('render method missed. Tool %o skipped', 'warn', tool);\n    //     return;\n    //\n    // }\n\n    /**\n     * Skip tools that pass 'displayInToolbox=false'\n     */\n    if (!tool[api.IS_DISPLAYED_IN_TOOLBOX]) {\n      return;\n    }\n\n    let button = $.make('li', [Toolbox.CSS.toolboxButton, tool[api.TOOLBAR_ICON_CLASS]], {\n      title: toolName\n    });\n\n    /**\n     * Save tool's name in the button data-name\n     */\n    button.dataset.name = toolName;\n\n    $.append(this.nodes.toolbox, button);\n\n    this.nodes.toolbox.appendChild(button);\n    this.nodes.buttons.push(button);\n\n    /**\n     * @todo add event with module Listeners\n     */\n    // this.Editor.Listeners.add();\n    button.addEventListener('click', event => {\n      this.buttonClicked(event);\n    }, false);\n  }\n\n  /**\n   * Toolbox button click listener\n   * 1) if block is empty -> replace\n   * 2) if block is not empty -> add new block below\n   *\n   * @param {MouseEvent} event\n   */\n  buttonClicked(event) {\n    let toolButton = event.target,\n      toolName = toolButton.dataset.name,\n      tool = this.Editor.Tools.toolClasses[toolName];\n\n    /**\n     * @type {Block}\n     */\n    let currentBlock = this.Editor.BlockManager.currentBlock;\n\n    /**\n     * We do replace if:\n     * - block is empty\n     * - block is not irreplaceable\n     * @type {Array}\n     */\n    if (!tool[this.Editor.Tools.apiSettings.IS_IRREPLACEBLE_TOOL] && currentBlock.isEmpty) {\n      this.Editor.BlockManager.replace(toolName);\n    } else {\n      this.Editor.BlockManager.insert(toolName);\n    }\n\n    /**\n     * @todo set caret to the new block\n     */\n\n    // window.setTimeout(function () {\n\n    /** Set caret to current block */\n    // editor.caret.setToBlock(currentInputIndex);\n\n    // }, 10);\n\n    /**\n     * Move toolbar when node is changed\n     */\n    this.Editor.Toolbar.move();\n  }\n\n  /**\n   * Open Toolbox with Tools\n   */\n  open() {\n    this.nodes.toolbox.classList.add(Toolbox.CSS.toolboxOpened);\n    this.opened = true;\n  }\n\n  /**\n   * Close Toolbox\n   */\n  close() {\n    this.nodes.toolbox.classList.remove(Toolbox.CSS.toolboxOpened);\n    this.opened = false;\n  }\n\n  /**\n   * Close Toolbox\n   */\n  toggle() {\n    if (!this.opened) {\n      this.open();\n    } else {\n      this.close();\n    }\n  }\n}\n","/**\n *\n * Toolbar is the node that moves up/down over current block\n *\n *  ______________________________________ Toolbar ____________________________________________\n * |                                                                                           |\n * |  ..................... Content ....................   ......... Block Actions ..........  |\n * |  .                                                .   .                                .  |\n * |  .                                                .   .        [Open Settings]         .  |\n * |  .  [Plus Button]  [Toolbox: {Tool1}, {Tool2}]    .   .                                .  |\n * |  .                                                .   .        [Settings Panel]        .  |\n * |  ..................................................   ..................................  |\n * |                                                                                           |\n * |___________________________________________________________________________________________|\n *\n *\n * Toolbox  its an Element contains tools buttons. Can be shown by Plus Button.\n *\n *  _______________ Toolbox _______________\n * |                                       |\n * | [Header] [Image] [List] [Quote] ...   |\n * |_______________________________________|\n *\n *\n * Settings Panel  is an Element with block settings:\n *\n *   ____ Settings Panel ____\n *  | ...................... |\n *  | .   Tool Settings    . |\n *  | ...................... |\n *  | .  Default Settings  . |\n *  | ...................... |\n *  |________________________|\n *\n *\n * @class\n * @classdesc Toolbar module\n *\n * @typedef {Toolbar} Toolbar\n * @property {Object} nodes\n * @property {Element} nodes.wrapper        - Toolbar main element\n * @property {Element} nodes.content        - Zone with Plus button and toolbox.\n * @property {Element} nodes.actions        - Zone with Block Settings and Remove Button\n * @property {Element} nodes.blockActionsButtons   - Zone with Block Buttons: [Settings]\n * @property {Element} nodes.plusButton     - Button that opens or closes Toolbox\n * @property {Element} nodes.toolbox        - Container for tools\n * @property {Element} nodes.settingsToggler - open/close Settings Panel button\n * @property {Element} nodes.settings          - Settings Panel\n * @property {Element} nodes.pluginSettings    - Plugin Settings section of Settings Panel\n * @property {Element} nodes.defaultSettings   - Default Settings section of Settings Panel\n */\nexport default class Toolbar extends Module {\n  /**\n   * @constructor\n   */\n  constructor({config}) {\n    super({config});\n\n    this.nodes = {\n      wrapper : null,\n      content : null,\n      actions : null,\n\n      // Content Zone\n      plusButton : null,\n\n      // Actions Zone\n      blockActionsButtons: null,\n      settingsToggler : null,\n    };\n  }\n\n  /**\n   * CSS styles\n   * @return {Object}\n   * @constructor\n   */\n  static get CSS() {\n    return {\n      toolbar: 'ce-toolbar',\n      content: 'ce-toolbar__content',\n      actions: 'ce-toolbar__actions',\n\n      toolbarOpened: 'ce-toolbar--opened',\n\n      // Content Zone\n      plusButton: 'ce-toolbar__plus',\n      plusButtonHidden: 'ce-toolbar__plus--hidden',\n\n      // Actions Zone\n      blockActionsButtons: 'ce-toolbar__actions-buttons',\n      settingsToggler: 'ce-toolbar__settings-btn',\n    };\n  }\n\n  /**\n   * Makes toolbar\n   */\n  make() {\n    this.nodes.wrapper = $.make('div', Toolbar.CSS.toolbar);\n\n    /**\n     * Make Content Zone and Actions Zone\n     */\n    ['content',  'actions'].forEach( el => {\n      this.nodes[el] = $.make('div', Toolbar.CSS[el]);\n      $.append(this.nodes.wrapper, this.nodes[el]);\n    });\n\n\n    /**\n     * Fill Content Zone:\n     *  - Plus Button\n     *  - Toolbox\n     */\n    this.nodes.plusButton = $.make('div', Toolbar.CSS.plusButton);\n    $.append(this.nodes.plusButton, $.svg('plus', 14, 14));\n    $.append(this.nodes.content, this.nodes.plusButton);\n    this.nodes.plusButton.addEventListener('click', event => this.plusButtonClicked(event), false);\n\n\n    /**\n     * Make a Toolbox\n     */\n    this.Editor.Toolbox.make();\n\n    /**\n     * Fill Actions Zone:\n     *  - Settings Toggler\n     *  - Remove Block Button\n     *  - Settings Panel\n     */\n    this.nodes.blockActionsButtons = $.make('div', Toolbar.CSS.blockActionsButtons);\n    this.nodes.settingsToggler  = $.make('span', Toolbar.CSS.settingsToggler);\n    const settingsIcon = $.svg('dots', 18, 4);\n\n    $.append(this.nodes.settingsToggler, settingsIcon);\n    $.append(this.nodes.blockActionsButtons, this.nodes.settingsToggler);\n    $.append(this.nodes.actions, this.nodes.blockActionsButtons);\n\n    /**\n     * Make and append Settings Panel\n     */\n    this.Editor.BlockSettings.make();\n    $.append(this.nodes.actions, this.Editor.BlockSettings.nodes.wrapper);\n\n    /**\n     * Append toolbar to the Editor\n     */\n    $.append(this.Editor.UI.nodes.wrapper, this.nodes.wrapper);\n\n    /**\n     * Bind events on the Toolbar elements\n     */\n    this.bindEvents();\n  }\n\n  /**\n   * Move Toolbar to the Current Block\n   * @param {Boolean} forceClose - force close Toolbar Settings and Toolbar\n   */\n  move(forceClose = true) {\n    if (forceClose) {\n      /** Close Toolbox when we move toolbar */\n      this.Editor.Toolbox.close();\n      this.Editor.BlockSettings.close();\n    }\n\n    let currentNode = this.Editor.BlockManager.currentNode;\n\n    /**\n     * If no one Block selected as a Current\n     */\n    if (!currentNode) {\n      return;\n    }\n\n    /**\n     * @todo Compute dynamically on prepare\n     * @type {number}\n     */\n    const defaultToolbarHeight = 49;\n    const defaultOffset = 34;\n\n    var newYCoordinate = currentNode.offsetTop - (defaultToolbarHeight / 2) + defaultOffset;\n\n    this.nodes.wrapper.style.transform = `translate3D(0, ${Math.floor(newYCoordinate)}px, 0)`;\n  }\n\n  /**\n   * Open Toolbar with Plus Button\n   */\n  open() {\n    this.nodes.wrapper.classList.add(Toolbar.CSS.toolbarOpened);\n  }\n\n  /**\n   * Close the Toolbar\n   */\n  close() {\n    this.nodes.wrapper.classList.remove(Toolbar.CSS.toolbarOpened);\n  }\n\n  /**\n   * Plus Button public methods\n   * @return {{hide: function(): void, show: function(): void}}\n   */\n  get plusButton() {\n    return {\n      hide: () => this.nodes.plusButton.classList.add(Toolbar.CSS.plusButtonHidden),\n      show: () => this.nodes.plusButton.classList.remove(Toolbar.CSS.plusButtonHidden)\n    };\n  }\n\n  /**\n   * Handler for Plus Button\n   * @param {MouseEvent} event\n   */\n  plusButtonClicked() {\n    this.Editor.Toolbox.toggle();\n  }\n\n  /**\n   * Bind events on the Toolbar Elements:\n   * - Block Settings\n   */\n  bindEvents() {\n    /**\n     * Settings toggler\n     */\n    this.Editor.Listeners.on(this.nodes.settingsToggler, 'click', (event) => {\n      this.settingsTogglerClicked(event);\n    });\n  }\n\n  /**\n   * Clicks on the Block Settings toggler\n   */\n  settingsTogglerClicked() {\n    if (this.Editor.BlockSettings.opened) {\n      this.Editor.BlockSettings.close();\n    } else {\n      this.Editor.BlockSettings.open();\n    }\n  }\n}\n","/**\n * @module Codex Editor Tools Submodule\n *\n * Creates Instances from Plugins and binds external config to the instances\n */\n\n/**\n * Each Tool must contain the following important objects:\n *\n * @typedef {Object} ToolConfig {@link docs/tools.md}\n * @property {String} iconClassname - this a icon in toolbar\n * @property {Boolean} displayInToolbox - will be displayed in toolbox. Default value is TRUE\n * @property {Boolean} enableLineBreaks - inserts new block or break lines. Default value is FALSE\n * @property {Boolean|String[]} inlineToolbar - Pass `true` to enable the Inline Toolbar with all Tools, all pass an array with specified Tools list |\n * @property render @todo add description\n * @property save @todo add description\n * @property settings @todo add description\n * @property validate - method that validates output data before saving\n */\n\n/**\n * @typedef {Function} Tool {@link docs/tools.md}\n * @property {Boolean}      displayInToolbox      - By default, tools won't be added in the Toolbox. Pass true to add.\n * @property {String}       iconClassName         - CSS class name for the Toolbox button\n * @property {Boolean}      irreplaceable         - Toolbox behaviour: replace or add new block below\n * @property render\n * @property save\n * @property settings\n * @property validate\n *\n * @todo update according to current API\n * @todo describe Tool in the {@link docs/tools.md}\n */\n\n/**\n * Class properties:\n *\n * @typedef {Tools} Tools\n * @property {Tools[]} toolsAvailable - available Tools\n * @property {Tools[]} toolsUnavailable - unavailable Tools\n * @property {Object} toolsClasses - all classes\n * @property {EditorConfig} config - Editor config\n */\nexport default class Tools extends Module {\n  /**\n   * Returns available Tools\n   * @return {Tool[]}\n   */\n  get available() {\n    return this.toolsAvailable;\n  }\n\n  /**\n   * Returns unavailable Tools\n   * @return {Tool[]}\n   */\n  get unavailable() {\n    return this.toolsUnavailable;\n  }\n\n  /**\n   * Return Tools for the Inline Toolbar\n   * @return {Array} - array of Inline Tool's classes\n   */\n  get inline() {\n    return Object.values(this.available).filter( tool => {\n      if (!tool[this.apiSettings.IS_INLINE]) {\n        return false;\n      }\n\n      /**\n       * Some Tools validation\n       */\n      const inlineToolRequiredMethods = ['render', 'surround', 'checkState'];\n      const notImplementedMethods = inlineToolRequiredMethods.filter( method => !new tool()[method] );\n\n      if (notImplementedMethods.length) {\n        _.log(`Incorrect Inline Tool: ${tool.name}. Some of required methods is not implemented %o`, 'warn', notImplementedMethods);\n        return false;\n      }\n\n      return true;\n    });\n  }\n\n  /**\n   * Constant for available Tools Settings\n   * @return {object}\n   */\n  get apiSettings() {\n    return {\n      IS_INLINE: 'isInline',\n      TOOLBAR_ICON_CLASS: 'iconClassName',\n      IS_DISPLAYED_IN_TOOLBOX: 'displayInToolbox',\n      IS_ENABLED_LINE_BREAKS: 'enableLineBreaks',\n      IS_IRREPLACEBLE_TOOL: 'irreplaceable',\n      IS_ENABLED_INLINE_TOOLBAR: 'inlineToolbar',\n    };\n  }\n\n  /**\n   * Static getter for default Tool config fields\n   * @return {ToolConfig}\n   */\n  get defaultConfig() {\n    return {\n      [this.apiSettings.TOOLBAR_ICON_CLASS] : false,\n      [this.apiSettings.IS_DISPLAYED_IN_TOOLBOX] : false,\n      [this.apiSettings.IS_ENABLED_LINE_BREAKS] : false,\n      [this.apiSettings.IS_IRREPLACEBLE_TOOL] : false,\n      [this.apiSettings.IS_ENABLED_INLINE_TOOLBAR]: false,\n    };\n  }\n\n  /**\n   * @constructor\n   *\n   * @param {EditorConfig} config\n   */\n  constructor({config}) {\n    super({config});\n\n    /**\n     * Map {name: Class, ...} where:\n     *  name  block type name in JSON. Got from EditorConfig.tools keys\n     * @type {Object}\n     */\n    this.toolClasses = {};\n\n    /**\n     * Available tools list\n     * {name: Class, ...}\n     * @type {Object}\n     */\n    this.toolsAvailable = {};\n\n    /**\n     * Tools that rejected a prepare method\n     * {name: Class, ... }\n     * @type {Object}\n     */\n    this.toolsUnavailable = {};\n  }\n\n  /**\n   * Creates instances via passed or default configuration\n   * @return {Promise}\n   */\n  prepare() {\n    if (!this.config.hasOwnProperty('tools')) {\n      return Promise.reject(\"Can't start without tools\");\n    }\n\n    for(let toolName in this.config.tools) {\n      this.toolClasses[toolName] = this.config.tools[toolName];\n    }\n\n    /**\n     * getting classes that has prepare method\n     */\n    let sequenceData = this.getListOfPrepareFunctions();\n\n    /**\n     * if sequence data contains nothing then resolve current chain and run other module prepare\n     */\n    if (sequenceData.length === 0) {\n      return Promise.resolve();\n    }\n\n    /**\n     * to see how it works {@link Util#sequence}\n     */\n    return _.sequence(sequenceData, (data) => {\n      this.success(data);\n    }, (data) => {\n      this.fallback(data);\n    });\n  }\n\n  /**\n   * Binds prepare function of plugins with user or default config\n   * @return {Array} list of functions that needs to be fired sequentially\n   */\n  getListOfPrepareFunctions() {\n    let toolPreparationList = [];\n\n    for(let toolName in this.toolClasses) {\n      let toolClass = this.toolClasses[toolName];\n\n      if (typeof toolClass.prepare === 'function') {\n        toolPreparationList.push({\n          function : toolClass.prepare,\n          data : {\n            toolName\n          }\n        });\n      } else {\n        /**\n         * If Tool hasn't a prepare method, mark it as available\n         */\n        this.toolsAvailable[toolName] = toolClass;\n      }\n    }\n\n    return toolPreparationList;\n  }\n\n  /**\n   * @param {ChainData.data} data - append tool to available list\n   */\n  success(data) {\n    this.toolsAvailable[data.toolName] = this.toolClasses[data.toolName];\n  }\n\n  /**\n   * @param {ChainData.data} data - append tool to unavailable list\n   */\n  fallback(data) {\n    this.toolsUnavailable[data.toolName] = this.toolClasses[data.toolName];\n  }\n\n  /**\n   * Return tool`a instance\n   *\n   * @param {String} tool  tool name\n   * @param {Object} data  initial data\n   *\n   * @todo throw exceptions if tool doesnt exist\n   *\n   */\n  construct(tool, data) {\n    let plugin = this.toolClasses[tool],\n      config = this.config.toolsConfig[tool];\n\n    let instance = new plugin(data, config || {});\n\n    return instance;\n  }\n\n  /**\n   * Check if passed Tool is an instance of Initial Block Tool\n   * @param {Tool} tool - Tool to check\n   * @return {Boolean}\n   */\n  isInitial(tool) {\n    return tool instanceof this.available[this.config.initialBlock];\n  }\n}\n","/**\n * Module UI\n *\n * @type {UI}\n */\n\n/**\n * Prebuilded sprite of SVG icons\n */\nimport sprite from '../../../build/sprite.svg';\n\n/**\n * @class\n *\n * @classdesc Makes CodeX Editor UI:\n *                <codex-editor>\n *                    <ce-redactor />\n *                    <ce-toolbar />\n *                    <ce-inline-toolbar />\n *                </codex-editor>\n *\n * @typedef {UI} UI\n * @property {EditorConfig} config   - editor configuration {@link CodexEditor#configuration}\n * @property {Object} Editor         - available editor modules {@link CodexEditor#moduleInstances}\n * @property {Object} nodes          -\n * @property {Element} nodes.holder  - element where we need to append redactor\n * @property {Element} nodes.wrapper  - <codex-editor>\n * @property {Element} nodes.redactor - <ce-redactor>\n */\nexport default class UI extends Module {\n  /**\n   * @constructor\n   *\n   * @param  {EditorConfig} config\n   */\n  constructor({config}) {\n    super({config});\n\n    this.nodes = {\n      holder: null,\n      wrapper: null,\n      redactor: null\n    };\n  }\n\n  /**\n   * Making main interface\n   */\n  prepare() {\n    return this.make()\n      /**\n       * Append SVG sprite\n       */\n      .then(() => this.appendSVGSprite())\n      /**\n       * Make toolbar\n       */\n      .then(() => this.Editor.Toolbar.make())\n      /**\n       * Make the Inline toolbar\n       */\n      .then(() => this.Editor.InlineToolbar.make())\n      /**\n       * Load and append CSS\n       */\n      .then(() => this.loadStyles())\n      /**\n       * Bind events for the UI elements\n       */\n      .then(() => this.bindEvents())\n\n    /** Make container for inline toolbar */\n    // .then(makeInlineToolbar_)\n\n    /** Add inline toolbar tools */\n    // .then(addInlineToolbarTools_)\n\n    /** Draw wrapper for notifications */\n    // .then(makeNotificationHolder_)\n\n    /** Add eventlisteners to redactor elements */\n    // .then(bindEvents_)\n\n      .catch(e => {\n        console.error(e);\n\n        // editor.core.log(\"Can't draw editor interface\");\n      });\n  }\n\n  /**\n     * CodeX Editor UI CSS class names\n     * @return {{editorWrapper: string, editorZone: string, block: string}}\n     */\n  get CSS() {\n    return {\n      editorWrapper : 'codex-editor',\n      editorZone    : 'codex-editor__redactor',\n    };\n  }\n\n  /**\n     * Makes CodeX Editor interface\n     * @return {Promise<any>}\n     */\n  make() {\n    return new Promise( (resolve, reject) => {\n      /**\n       * Element where we need to append CodeX Editor\n       * @type {Element}\n       */\n      this.nodes.holder = document.getElementById(this.config.holderId);\n\n      if (!this.nodes.holder) {\n        reject(Error(\"Holder wasn't found by ID: #\" + this.config.holderId));\n        return;\n      }\n\n      /**\n       * Create and save main UI elements\n       */\n      this.nodes.wrapper  = $.make('div', this.CSS.editorWrapper);\n      this.nodes.redactor = $.make('div', this.CSS.editorZone);\n\n      this.nodes.wrapper.appendChild(this.nodes.redactor);\n      this.nodes.holder.appendChild(this.nodes.wrapper);\n\n      resolve();\n    });\n  }\n\n  /**\n   * Appends CSS\n   */\n  loadStyles() {\n    /**\n     * Load CSS\n     */\n    let styles = require('../../styles/main.css');\n\n    /**\n     * Make tag\n     */\n    let tag = $.make('style', null, {\n      textContent: styles.toString()\n    });\n\n    /**\n     * Append styles\n     */\n    $.append(document.head, tag);\n  }\n\n  /**\n   * Bind events on the CodeX Editor interface\n   */\n  bindEvents() {\n    this.Editor.Listeners.on(this.nodes.redactor, 'click', event => this.redactorClicked(event), false );\n    this.Editor.Listeners.on(document, 'click', event => this.documentClicked(event), false );\n  }\n\n  /**\n   * All clicks on document\n   * @param {MouseEvent} event - Click\n   */\n  documentClicked(event) {\n    /**\n     * Close Inline Toolbar when nothing selected\n     * Do not fire check on clicks at the Inline Toolbar buttons\n     */\n    const clickedOnInlineToolbarButton = event.target.closest(`.${this.Editor.InlineToolbar.CSS.inlineToolbar}`);\n\n    if (!clickedOnInlineToolbarButton) {\n      this.Editor.InlineToolbar.handleShowingEvent(event);\n    }\n  }\n\n  /**\n   * All clicks on the redactor zone\n   *\n   * @param {MouseEvent} event\n   *\n   * @description\n   * 1. Save clicked Block as a current {@link BlockManager#currentNode}\n   *      it uses for the following:\n   *      - add CSS modifier for the selected Block\n   *      - on Enter press, we make a new Block under that\n   *\n   * 2. Move and show the Toolbar\n   *\n   * 3. Set a Caret\n   *\n   * 4. By clicks on the Editor's bottom zone:\n   *      - if last Block is empty, set a Caret to this\n   *      - otherwise, add a new empty Block and set a Caret to that\n   *\n   * 5. Hide the Inline Toolbar\n   *\n   * @see selectClickedBlock\n   *\n   */\n  redactorClicked(event) {\n    let clickedNode = event.target;\n\n    /**\n     * Select clicked Block as Current\n     */\n    try {\n      /**\n       * Renew Current Block\n       */\n      this.Editor.BlockManager.setCurrentBlockByChildNode(clickedNode);\n\n      /**\n       * Highlight Current Node\n       */\n      this.Editor.BlockManager.highlightCurrentNode();\n    } catch (e) {\n      /**\n       * If clicked outside first-level Blocks, set Caret to the last empty Block\n       */\n      this.Editor.Caret.setToTheLastBlock();\n    }\n\n    /**\n         *\n\n        /** Update current input index in memory when caret focused into existed input */\n    // if (event.target.contentEditable == 'true') {\n    //\n    //     editor.caret.saveCurrentInputIndex();\n    //\n    // }\n\n    // if (editor.content.currentNode === null) {\n    //\n    //     /**\n    //      * If inputs in redactor does not exits, then we put input index 0 not -1\n    //      */\n    //     var indexOfLastInput = editor.state.inputs.length > 0 ? editor.state.inputs.length - 1 : 0;\n    //\n    //     /** If we have any inputs */\n    //     if (editor.state.inputs.length) {\n    //\n    //         /** getting firstlevel parent of input */\n    //         firstLevelBlock = editor.content.getFirstLevelBlock(editor.state.inputs[indexOfLastInput]);\n    //\n    //     }\n    //\n    //     /** If input is empty, then we set caret to the last input */\n    //     if (editor.state.inputs.length && editor.state.inputs[indexOfLastInput].textContent === '' && firstLevelBlock.dataset.tool == editor.settings.initialBlockPlugin) {\n    //\n    //         editor.caret.setToBlock(indexOfLastInput);\n    //\n    //     } else {\n    //\n    //         /** Create new input when caret clicked in redactors area */\n    //         var NEW_BLOCK_TYPE = editor.settings.initialBlockPlugin;\n    //\n    //         editor.content.insertBlock({\n    //             type  : NEW_BLOCK_TYPE,\n    //             block : editor.tools[NEW_BLOCK_TYPE].render()\n    //         });\n    //\n    //         /** If there is no inputs except inserted */\n    //         if (editor.state.inputs.length === 1) {\n    //\n    //             editor.caret.setToBlock(indexOfLastInput);\n    //\n    //         } else {\n    //\n    //             /** Set caret to this appended input */\n    //             editor.caret.setToNextBlock(indexOfLastInput);\n    //\n    //         }\n    //\n    //     }\n    //\n    // } else {\n    //\n    //     /** Close all panels */\n    //     editor.toolbar.settings.close();\n    //     editor.toolbar.toolbox.close();\n    //\n    // }\n    //\n    /**\n     * Move toolbar and open\n     */\n    this.Editor.Toolbar.move();\n    this.Editor.Toolbar.open();\n    //\n    // var inputIsEmpty = !editor.content.currentNode.textContent.trim(),\n    //     currentNodeType = editor.content.currentNode.dataset.tool,\n    //     isInitialType = currentNodeType == editor.settings.initialBlockPlugin;\n    //\n    //\n\n    /**\n     * Hide the Plus Button\n     * */\n    this.Editor.Toolbar.plusButton.hide();\n\n    /**\n     * Show the Plus Button if:\n     * - Block is an initial-block (Text)\n     * - Block is empty\n     */\n    let isInitialBlock = this.Editor.Tools.isInitial(this.Editor.BlockManager.currentBlock.tool),\n      isEmptyBlock = this.Editor.BlockManager.currentBlock.isEmpty;\n\n    if (isInitialBlock && isEmptyBlock) {\n      this.Editor.Toolbar.plusButton.show();\n    }\n  }\n\n  /**\n   * Append prebuilded sprite with SVG icons\n   */\n  appendSVGSprite() {\n    let spriteHolder = $.make('div');\n\n    spriteHolder.innerHTML = sprite;\n\n    $.append(this.nodes.wrapper, spriteHolder);\n  }\n}\n\n// /**\n//  * Codex Editor UI module\n//  *\n//  * @author Codex Team\n//  * @version 1.2.0\n//  */\n//\n// module.exports = (function (ui) {\n//\n//     let editor = codex.editor;\n//\n//     /**\n//      * Basic editor classnames\n//      */\n//     ui.prepare = function () {\n//\n\n//\n//     };\n//\n//     /** Draw notifications holder */\n//     var makeNotificationHolder_ = function () {\n//\n//         /** Append block with notifications to the document */\n//         editor.nodes.notifications = editor.notifications.createHolder();\n//\n//     };\n//\n//\n//     var addInlineToolbarTools_ = function () {\n//\n//         var tools = {\n//\n//             bold: {\n//                 icon    : 'ce-icon-bold',\n//                 command : 'bold'\n//             },\n//\n//             italic: {\n//                 icon    : 'ce-icon-italic',\n//                 command : 'italic'\n//             },\n//\n//             link: {\n//                 icon    : 'ce-icon-link',\n//                 command : 'createLink'\n//             }\n//         };\n//\n//         var toolButton,\n//             tool;\n//\n//         for(var name in tools) {\n//\n//             tool = tools[name];\n//\n//             toolButton = editor.draw.toolbarButtonInline(name, tool.icon);\n//\n//             editor.nodes.inlineToolbar.buttons.appendChild(toolButton);\n//             /**\n//              * Add callbacks to this buttons\n//              */\n//             editor.ui.setInlineToolbarButtonBehaviour(toolButton, tool.command);\n//\n//         }\n//\n//     };\n//\n//     /**\n//      * @private\n//      * Bind editor UI events\n//      */\n//     var bindEvents_ = function () {\n//\n//         editor.core.log('ui.bindEvents fired', 'info');\n//\n//         // window.addEventListener('error', function (errorMsg, url, lineNumber) {\n//         //     editor.notifications.errorThrown(errorMsg, event);\n//         // }, false );\n//\n//         /** All keydowns on Document */\n//         editor.listeners.add(document, 'keydown', editor.callback.globalKeydown, false);\n//\n//         /** All keydowns on Redactor zone */\n//         editor.listeners.add(editor.nodes.redactor, 'keydown', editor.callback.redactorKeyDown, false);\n//\n//         /** All keydowns on Document */\n//         editor.listeners.add(document, 'keyup', editor.callback.globalKeyup, false );\n//\n//         /**\n//          * Mouse click to radactor\n//          */\n//         editor.listeners.add(editor.nodes.redactor, 'click', editor.callback.redactorClicked, false );\n//\n//         /**\n//          * Clicks to the Plus button\n//          */\n//         editor.listeners.add(editor.nodes.plusButton, 'click', editor.callback.plusButtonClicked, false);\n//\n//         /**\n//          * Clicks to SETTINGS button in toolbar\n//          */\n//         editor.listeners.add(editor.nodes.showSettingsButton, 'click', editor.callback.showSettingsButtonClicked, false );\n//\n//         /** Bind click listeners on toolbar buttons */\n//         for (var button in editor.nodes.toolbarButtons) {\n//\n//             editor.listeners.add(editor.nodes.toolbarButtons[button], 'click', editor.callback.toolbarButtonClicked, false);\n//\n//         }\n//\n//     };\n//\n//     ui.addBlockHandlers = function (block) {\n//\n//         if (!block) return;\n//\n//         /**\n//          * Block keydowns\n//          */\n//         editor.listeners.add(block, 'keydown', editor.callback.blockKeydown, false);\n//\n//         /**\n//          * Pasting content from another source\n//          * We have two type of sanitization\n//          * First - uses deep-first search algorithm to get sub nodes,\n//          * sanitizes whole Block_content and replaces cleared nodes\n//          * This method is deprecated\n//          * Method is used in editor.callback.blockPaste(event)\n//          *\n//          * Secont - uses Mutation observer.\n//          * Observer \"observe\" DOM changes and send changings to callback.\n//          * Callback gets changed node, not whole Block_content.\n//          * Inserted or changed node, which we've gotten have been cleared and replaced with diry node\n//          *\n//          * Method is used in editor.callback.blockPasteViaSanitize(event)\n//          *\n//          * @uses html-janitor\n//          * @example editor.callback.blockPasteViaSanitize(event), the second method.\n//          *\n//          */\n//         editor.listeners.add(block, 'paste', editor.paste.blockPasteCallback, false);\n//\n//         /**\n//          * Show inline toolbar for selected text\n//          */\n//         editor.listeners.add(block, 'mouseup', editor.toolbar.inline.show, false);\n//         editor.listeners.add(block, 'keyup', editor.toolbar.inline.show, false);\n//\n//     };\n//\n//     /** getting all contenteditable elements */\n//     ui.saveInputs = function () {\n//\n//         var redactor = editor.nodes.redactor;\n//\n//         editor.state.inputs = [];\n//\n//         /** Save all inputs in global variable state */\n//         var inputs = redactor.querySelectorAll('[contenteditable], input, textarea');\n//\n//         Array.prototype.map.call(inputs, function (current) {\n//\n//             if (!current.type || current.type == 'text' || current.type == 'textarea') {\n//\n//                 editor.state.inputs.push(current);\n//\n//             }\n//\n//         });\n//\n//     };\n//\n//     /**\n//      * Adds first initial block on empty redactor\n//      */\n//     ui.addInitialBlock = function () {\n//\n//         var initialBlockType = editor.settings.initialBlockPlugin,\n//             initialBlock;\n//\n//         if ( !editor.tools[initialBlockType] ) {\n//\n//             editor.core.log('Plugin %o was not implemented and can\\'t be used as initial block', 'warn', initialBlockType);\n//             return;\n//\n//         }\n//\n//         initialBlock = editor.tools[initialBlockType].render();\n//\n//         initialBlock.setAttribute('data-placeholder', editor.settings.placeholder);\n//\n//         editor.content.insertBlock({\n//             type  : initialBlockType,\n//             block : initialBlock\n//         });\n//\n//         editor.content.workingNodeChanged(initialBlock);\n//\n//     };\n//\n//     ui.setInlineToolbarButtonBehaviour = function (button, type) {\n//\n//         editor.listeners.add(button, 'mousedown', function (event) {\n//\n//             editor.toolbar.inline.toolClicked(event, type);\n//\n//         }, false);\n//\n//     };\n//\n//     return ui;\n//\n// })({});\n","/**\n * Element.closest()\n *\n * https://developer.mozilla.org/en-US/docs/Web/API/Element/closest\n */\nif (!Element.prototype.matches)\n  Element.prototype.matches = Element.prototype.msMatchesSelector ||\n        Element.prototype.webkitMatchesSelector;\n\nif (!Element.prototype.closest)\n  Element.prototype.closest = function (s) {\n    var el = this;\n\n    if (!document.documentElement.contains(el)) return null;\n    do {\n      if (el.matches(s)) return el;\n      el = el.parentElement || el.parentNode;\n    } while (el !== null);\n    return null;\n  };\n","/**\n * Working with selection\n * @typedef {Selection} Selection\n */\nexport default class Selection {\n  /**\n   * @constructor\n   */\n  constructor() {\n    this.instance = null;\n    this.selection = null;\n\n    /**\n     * This property can store Selection's range for restoring later\n     * @type {Range|null}\n     */\n    this.savedSelectionRange = null;\n  }\n\n  /**\n   * Returns window Selection\n   * {@link https://developer.mozilla.org/ru/docs/Web/API/Window/getSelection}\n   * @return {Selection}\n   */\n  static get() {\n    return window.getSelection();\n  }\n\n  /**\n   * Returns selected anchor\n   * {@link https://developer.mozilla.org/ru/docs/Web/API/Selection/anchorNode}\n   * @return {Node|null}\n   */\n  static get anchorNode() {\n    const selection = window.getSelection();\n\n    return selection ? selection.anchorNode : null;\n  }\n\n  /**\n   * Returns selection offset according to the anchor node\n   * {@link https://developer.mozilla.org/ru/docs/Web/API/Selection/anchorOffset}\n   * @return {Number|null}\n   */\n  static get anchorOffset() {\n    const selection = window.getSelection();\n\n    return selection ? selection.anchorOffset : null;\n  }\n\n  /**\n   * Is current selection range collapsed\n   * @return {boolean|null}\n   */\n  static get isCollapsed() {\n    const selection = window.getSelection();\n\n    return selection ? selection.isCollapsed : null;\n  }\n\n  /**\n   * Return first range\n   * @return {Range|null}\n   */\n  static get range() {\n    const selection = window.getSelection();\n\n    return selection && selection.rangeCount ? selection.getRangeAt(0) : null;\n  }\n\n  /**\n   * Calculates position and size of selected text\n   * @return {{x, y, width, height, top?, left?, bottom?, right?}}\n   */\n  static get rect() {\n    let sel = document.selection, range;\n    let rect = {\n      x: 0,\n      y: 0,\n      width: 0,\n      height: 0\n    };\n\n    if (sel && sel.type !== 'Control') {\n      range = sel.createRange();\n      rect.x = range.boundingLeft;\n      rect.y = range.boundingTop;\n      rect.width = range.boundingWidth;\n      rect.height = range.boundingHeight;\n\n      return rect;\n    }\n\n    if (!window.getSelection) {\n      _.log('Method window.getSelection is not supported', 'warn');\n      return rect;\n    }\n\n    sel = window.getSelection();\n\n    if (!sel.rangeCount) {\n      _.log('Method Selection.rangeCount() is not supported', 'warn');\n      return rect;\n    }\n\n    range = sel.getRangeAt(0).cloneRange();\n\n    if (range.getBoundingClientRect) {\n      rect = range.getBoundingClientRect();\n    }\n    // Fall back to inserting a temporary element\n    if (rect.x === 0 && rect.y === 0) {\n      let span = document.createElement('span');\n\n      if (span.getBoundingClientRect) {\n        // Ensure span has dimensions and position by\n        // adding a zero-width space character\n        span.appendChild( document.createTextNode('\\u200b') );\n        range.insertNode(span);\n        rect = span.getBoundingClientRect();\n\n        let spanParent = span.parentNode;\n\n        spanParent.removeChild(span);\n\n        // Glue any broken text nodes back together\n        spanParent.normalize();\n      }\n    }\n\n    return rect;\n  }\n\n  /**\n   * Returns selected text as String\n   * @returns {string}\n   */\n  static get text() {\n    return window.getSelection ? window.getSelection().toString() : '';\n  };\n\n  /**\n   * Save Selection's range\n   */\n  save() {\n    this.savedSelectionRange = Selection.range;\n  }\n\n  /**\n   * Restore saved Selection's range\n   */\n  restore() {\n    if (!this.savedSelectionRange) {\n      return;\n    }\n\n    const sel = window.getSelection();\n\n    sel.removeAllRanges();\n    sel.addRange(this.savedSelectionRange);\n  }\n\n  /**\n   * Clears saved selection\n   */\n  clearSaved() {\n    this.savedSelectionRange = null;\n  }\n\n  /**\n   * Looks ahead to find passed tag from current selection\n   *\n   * @param  {String} tagName       - tag to found\n   * @param  {String} [className]   - tag's class name\n   * @param  {Number} [searchDepth] - count of tags that can be included. For better performance.\n   * @return {HTMLElement|null}\n   */\n  findParentTag(tagName, className, searchDepth = 10) {\n    let selection = window.getSelection(),\n      parentTag = null;\n\n    /**\n     * If selection is missing or no anchorNode or focusNode were found then return null\n     */\n    if (!selection || !selection.anchorNode || !selection.focusNode) {\n      return null;\n    }\n\n    /**\n     * Define Nodes for start and end of selection\n     */\n    let boundNodes = [\n      /** the Node in which the selection begins */\n      selection.anchorNode,\n      /** the Node in which the selection ends */\n      selection.focusNode\n    ];\n\n    /**\n     * For each selection parent Nodes we try to find target tag [with target class name]\n     * It would be saved in parentTag variable\n     */\n    boundNodes.forEach(parent => {\n      /** Reset tags limit */\n      let searchDepthIterable = searchDepth;\n\n      while (searchDepthIterable > 0 && parent.parentNode) {\n        /**\n         * Check tag's name\n         */\n        if (parent.tagName === tagName) {\n          /**\n           * Optional additional check for class-name matching\n           */\n          if (className && parent.classList && !parent.classList.contains(className)) {\n            continue;\n          }\n\n          /**\n           * If we have found required tag with class then save the result and go out from cycle\n           */\n          parentTag = parent;\n          break;\n        }\n\n        /**\n         * Target tag was not found. Go up to the parent and check it\n         */\n        parent = parent.parentNode;\n        searchDepthIterable--;\n      }\n    });\n\n    /**\n     * Return found tag or null\n     */\n    return parentTag;\n  }\n\n  /**\n   * Expands selection range to the passed parent node\n   *\n   * @param {HTMLElement} node\n   */\n  expandToTag(node) {\n    let selection = window.getSelection();\n\n    selection.removeAllRanges();\n    let range = document.createRange();\n\n    range.selectNodeContents(node);\n    selection.addRange(range);\n  }\n}\n","/**\n * Codex Editor Util\n */\nexport default class Util {\n  /**\n   * Custom logger\n   *\n   * @param {string} msg  - message\n   * @param {string} type - logging type 'log'|'warn'|'error'|'info'\n   * @param {*} args      - argument to log with a message\n   */\n  static log(msg, type, args) {\n    type = type || 'log';\n\n    if (!args) {\n      args  = msg || 'undefined';\n      msg  = '[codex-editor]:      %o';\n    } else {\n      msg  = '[codex-editor]:      ' + msg;\n    }\n\n    try{\n      if ( 'console' in window && window.console[ type ] ) {\n        if ( args ) window.console[ type ]( msg, args );\n        else window.console[ type ]( msg );\n      }\n    } catch(e) {\n      // do nothing\n    }\n  }\n\n  /**\n   * Returns basic keycodes as constants\n   * @return {{}}\n   */\n  static get keyCodes() {\n    return {\n      BACKSPACE: 8,\n      TAB: 9,\n      ENTER: 13,\n      SHIFT: 16,\n      CTRL: 17,\n      ALT: 18,\n      ESC: 27,\n      SPACE: 32,\n      LEFT: 37,\n      UP: 38,\n      DOWN: 40,\n      RIGHT: 39,\n      DELETE: 46,\n      META: 91\n    };\n  }\n\n  /**\n   * @typedef {Object} ChainData\n   * @property {Object} data - data that will be passed to the success or fallback\n   * @property {Function} function - function's that must be called asynchronically\n   */\n\n  /**\n   * Fires a promise sequence asyncronically\n   *\n   * @param {Object[]} chains - list or ChainData's\n   * @param {Function} success - success callback\n   * @param {Function} fallback - callback that fires in case of errors\n   *\n   * @return {Promise}\n   */\n  static sequence(chains, success = () => {}, fallback = () => {}) {\n    return new Promise(function (resolve) {\n      /**\n       * pluck each element from queue\n       * First, send resolved Promise as previous value\n       * Each plugins \"prepare\" method returns a Promise, that's why\n       * reduce current element will not be able to continue while can't get\n       * a resolved Promise\n       */\n      chains.reduce(function (previousValue, currentValue, iteration) {\n        return previousValue\n          .then(() => waitNextBlock(currentValue, success, fallback))\n          .then(() => {\n            // finished\n            if (iteration === chains.length - 1) {\n              resolve();\n            }\n          });\n      }, Promise.resolve());\n    });\n\n    /**\n     * Decorator\n     *\n     * @param {ChainData} chainData\n     *\n     * @param {Function} successCallback\n     * @param {Function} fallbackCallback\n     *\n     * @return {Promise}\n     */\n    function waitNextBlock(chainData, successCallback, fallbackCallback) {\n      return new Promise(function (resolve) {\n        chainData.function()\n          .then(() => {\n            successCallback(chainData.data || {});\n          })\n          .then(resolve)\n          .catch(function () {\n            fallbackCallback(chainData.data || {});\n\n            // anyway, go ahead even it falls\n            resolve();\n          });\n      });\n    }\n  }\n\n  /**\n   * Make array from array-like collection\n   *\n   * @param {*} collection\n   *\n   * @return {Array}\n   */\n  static array(collection) {\n    return Array.prototype.slice.call(collection);\n  }\n\n  /**\n   * Checks if object is empty\n   *\n   * @param {Object} object\n   * @return {boolean}\n   */\n  static isEmpty(object) {\n    return Object.keys(object).length === 0 && object.constructor === Object;\n  }\n\n  /**\n   * Check if passed object is a Promise\n   * @param  {*}  object - object to check\n   * @return {Boolean}\n   */\n  static isPromise(object) {\n    return Promise.resolve(object) === object;\n  }\n\n  /**\n   * Check if passed element is contenteditable\n   * @param element\n   * @return {boolean}\n   */\n  static isContentEditable(element) {\n    return element.contentEditable === 'true';\n  }\n\n  /**\n   * Delays method execution\n   *\n   * @param method\n   * @param timeout\n   */\n  static delay(method, timeout) {\n    return function () {\n      let context = this,\n        args    = arguments;\n\n      window.setTimeout(() => method.apply(context, args), timeout);\n    };\n  }\n};\n","exports = module.exports = require(\"../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \":root {\\n  /**\\n   * Selection color\\n   */\\n  --selectionColor: rgba(61,166,239,0.63);\\n\\n  /**\\n   * Toolbar buttons\\n   */\\n  --bg-light: #eff2f5;\\n\\n  /**\\n   * All gray texts: placeholders, settings\\n   */\\n  --grayText: #707684;\\n\\n  /** Blue icons */\\n  --color-active-icon: #388AE5;\\n\\n  /**\\n   * Block content width\\n   */\\n  --content-width: 650px;\\n\\n  /**\\n   * Toolbar buttons height and width\\n   */\\n  --toolbar-buttons-size: 34px;\\n\\n  /**\\n   * Toolbar Plus Button and Toolbox buttons height and width\\n   */\\n  --toolbox-buttons-size: 20px;\\n\\n  /**\\n   * Confirm deletion bg\\n   */\\n  --color-confirm: #E24A4A;\\n}\\n/**\\n* Editor wrapper\\n*/\\n.codex-editor {\\n  position: relative;\\n  box-sizing: border-box;\\n}\\n.codex-editor .hide {\\n    display: none;\\n  }\\n.codex-editor__redactor {\\n    padding-bottom: 300px;\\n  }\\n.codex-editor svg {\\n    fill: currentColor;\\n    vertical-align: middle;\\n    max-height: 100%;\\n  }\\n/**\\n * Set color for native selection\\n */\\n::-moz-selection{\\n  background-color: rgba(61,166,239,0.63);\\n  background-color: var(--selectionColor);\\n}\\n::selection{\\n  background-color: rgba(61,166,239,0.63);\\n  background-color: var(--selectionColor);\\n}\\n/**\\n * Add placeholder to content editable elements with data attribute\\n * data-placeholder=\\\"Hello world!\\\"\\n */\\n[contentEditable=true][data-placeholder]:empty:not(:focus):before{\\n  content: attr(data-placeholder);\\n  color: #707684;\\n  color: var(--grayText);\\n}\\n.ce-toolbar {\\n  position: absolute;\\n  left: 0;\\n  right: 0;\\n  top: 0;\\n  /*opacity: 0;*/\\n  /*visibility: hidden;*/\\n  transition: opacity 100ms ease;\\n  will-change: opacity, transform;\\n  display: none;\\n}\\n.ce-toolbar--opened {\\n    display: block;\\n    /*opacity: 1;*/\\n    /*visibility: visible;*/\\n  }\\n.ce-toolbar__content {\\n    max-width: 650px;\\n    max-width: var(--content-width);\\n    margin: 0 auto;\\n    position: relative;\\n  }\\n.ce-toolbar__plus {\\n  color: #707684;\\n  color: var(--grayText);\\n  cursor: pointer;\\n  display: inline-block;\\n  width: 20px;\\n  width: var(--toolbox-buttons-size);\\n  height: 20px;\\n  height: var(--toolbox-buttons-size);\\n  line-height: 20px;\\n  line-height: var(--toolbox-buttons-size)\\n  }\\n.ce-toolbar__plus:not(:last-of-type){\\n  margin-right: 3px;\\n    }\\n.ce-toolbar__plus:hover {\\n  color: #388AE5;\\n  color: var(--color-active-icon);\\n    }\\n.ce-toolbar__plus {\\n\\n    position: absolute;\\n    top: -1px;\\n    left: calc(calc(20px + 10px) * -1);\\n    left: calc(calc(var(--toolbox-buttons-size) + 10px) * -1);\\n  }\\n.ce-toolbar__plus--hidden {\\n      display: none;\\n    }\\n/**\\n   * Block actions Zone\\n   * -------------------------\\n   */\\n.ce-toolbar__actions {\\n    position: absolute;\\n    right: 0;\\n    top: 0;\\n    padding-right: 16px;\\n  }\\n.ce-toolbar__actions-buttons {\\n      text-align: right;\\n    }\\n.ce-toolbar__settings-btn {\\n    display: inline-block;\\n    width: 24px;\\n    height: 24px;\\n    color: #707684;\\n    color: var(--grayText);\\n    cursor: pointer;\\n  }\\n.ce-toolbox {\\n    position: absolute;\\n    visibility: hidden;\\n    transition: opacity 100ms ease;\\n    will-change: opacity;\\n}\\n.ce-toolbox--opened {\\n        opacity: 1;\\n        visibility: visible;\\n    }\\n.ce-toolbox__button {\\n  color: #707684;\\n  color: var(--grayText);\\n  cursor: pointer;\\n  display: inline-block;\\n  width: 20px;\\n  width: var(--toolbox-buttons-size);\\n  height: 20px;\\n  height: var(--toolbox-buttons-size);\\n  line-height: 20px;\\n  line-height: var(--toolbox-buttons-size);\\n    }\\n.ce-toolbox__button:not(:last-of-type){\\n  margin-right: 3px;\\n    }\\n.ce-toolbox__button:hover {\\n  color: #388AE5;\\n  color: var(--color-active-icon);\\n    }\\n.ce-inline-toolbar {\\n  position: absolute;\\n  background-color: #FFFFFF;\\n  box-shadow: 0 8px 23px -6px rgba(21,40,54,0.31), 22px -14px 34px -18px rgba(33,48,73,0.26);\\n  border-radius: 4px;\\n  z-index: 2\\n}\\n.ce-inline-toolbar::before {\\n  content: '';\\n  width: 15px;\\n  height: 15px;\\n  position: absolute;\\n  top: -7px;\\n  left: 50%;\\n  margin-left: -7px;\\n  transform: rotate(-45deg);\\n  background-color: #fff;\\n  z-index: -1;\\n    }\\n.ce-inline-toolbar {\\n  padding: 6px;\\n  transform: translateX(-50%);\\n  display: none;\\n  box-shadow: 0 6px 12px -6px rgba(131, 147, 173, 0.46),\\n              5px -12px 34px -13px rgba(97, 105, 134, 0.6),\\n              0 26px 52px 3px rgba(147, 165, 186, 0.24);\\n}\\n.ce-inline-toolbar--showed {\\n    display: block;\\n  }\\n.ce-inline-tool {\\n  display: inline-block;\\n  width: 34px;\\n  height: 34px;\\n  line-height: 34px;\\n  text-align: center;\\n  border-radius: 3px;\\n  cursor: pointer;\\n  border: 0;\\n  outline: none;\\n  background-color: transparent;\\n  vertical-align: bottom;\\n  color: #707684;\\n  color: var(--grayText)\\n}\\n.ce-inline-tool:not(:last-of-type){\\n  margin-right: 5px;\\n    }\\n.ce-inline-tool:hover {\\n  background-color: #eff2f5;\\n  background-color: var(--bg-light);\\n    }\\n.ce-inline-tool {\\n  line-height: normal;\\n}\\n.ce-inline-tool--active {\\n  color: #388AE5;\\n  color: var(--color-active-icon);\\n    }\\n.ce-inline-tool--link .icon {\\n      margin-top: -2px;\\n    }\\n.ce-inline-tool--link .icon--unlink {\\n      display: none;\\n    }\\n.ce-inline-tool--unlink .icon--link {\\n      display: none;\\n    }\\n.ce-inline-tool--unlink .icon--unlink {\\n      display: inline-block;\\n    }\\n.ce-inline-tool-input {\\n    background-color: #eff2f5;\\n    background-color: var(--bg-light);\\n    outline: none;\\n    border: 0;\\n    border-radius: 3px;\\n    margin: 6px 0 0;\\n    font-size: 13px;\\n    padding: 8px;\\n    width: 100%;\\n    box-sizing: border-box;\\n    display: none\\n  }\\n.ce-inline-tool-input::-webkit-input-placeholder {\\n      color: #707684;\\n      color: var(--grayText);\\n    }\\n.ce-inline-tool-input:-ms-input-placeholder {\\n      color: #707684;\\n      color: var(--grayText);\\n    }\\n.ce-inline-tool-input::placeholder {\\n      color: #707684;\\n      color: var(--grayText);\\n    }\\n.ce-inline-tool-input--showed {\\n      display: block;\\n    }\\n.ce-settings {\\n  position: absolute;\\n  background-color: #FFFFFF;\\n  box-shadow: 0 8px 23px -6px rgba(21,40,54,0.31), 22px -14px 34px -18px rgba(33,48,73,0.26);\\n  border-radius: 4px;\\n  z-index: 2\\n}\\n.ce-settings::before {\\n  content: '';\\n  width: 15px;\\n  height: 15px;\\n  position: absolute;\\n  top: -7px;\\n  left: 50%;\\n  margin-left: -7px;\\n  transform: rotate(-45deg);\\n  background-color: #fff;\\n  z-index: -1;\\n    }\\n.ce-settings {\\n  right: 5px;\\n  top: 35px;\\n  min-width: 124px\\n}\\n.ce-settings::before{\\n    left: auto;\\n    right: 12px;\\n  }\\n.ce-settings {\\n\\n  display: none;\\n}\\n.ce-settings--opened {\\n    display: block;\\n  }\\n.ce-settings__plugin-zone:not(:empty){\\n      padding: 6px;\\n    }\\n.ce-settings__default-zone:not(:empty){\\n      padding: 6px;\\n    }\\n.ce-settings__button {\\n  display: inline-block;\\n  width: 34px;\\n  height: 34px;\\n  line-height: 34px;\\n  text-align: center;\\n  border-radius: 3px;\\n  cursor: pointer;\\n  border: 0;\\n  outline: none;\\n  background-color: transparent;\\n  vertical-align: bottom;\\n  color: #707684;\\n  color: var(--grayText)\\n  }\\n.ce-settings__button:not(:last-of-type){\\n  margin-right: 5px;\\n    }\\n.ce-settings__button:hover {\\n  background-color: #eff2f5;\\n  background-color: var(--bg-light);\\n    }\\n.ce-settings__button--active {\\n  color: #388AE5;\\n  color: var(--color-active-icon);\\n    }\\n.ce-settings__button--disabled {\\n        cursor: not-allowed !important;\\n        opacity: .3;\\n    }\\n.ce-settings__button--selected {\\n      color: #388AE5;\\n      color: var(--color-active-icon);\\n    }\\n.ce-settings__button--delete {\\n      transition: background-color 300ms ease;\\n      will-change: background-color;\\n    }\\n.ce-settings__button--delete .icon {\\n        transition: transform 200ms ease-out;\\n        will-change: transform;\\n      }\\n.ce-settings__button--confirm {\\n      background-color: #E24A4A;\\n      background-color: var(--color-confirm);\\n      color: #fff\\n    }\\n.ce-settings__button--confirm:hover {\\n        background-color: rgb(213, 74, 74) !important;\\n        background-color: rgb(213, 74, 74) !important;\\n      }\\n.ce-settings__button--confirm .icon {\\n        transform: rotate(90deg);\\n      }\\n.ce-block:first-of-type {\\n    margin-top: 0;\\n  }\\n.ce-block--selected {\\n    background-image: linear-gradient(17deg, rgba(243, 248, 255, 0.03) 63.45%, rgba(207, 214, 229, 0.27) 98%);\\n    border-radius: 3px;\\n  }\\n.ce-block__content {\\n    max-width: 650px;\\n    max-width: var(--content-width);\\n    margin: 0 auto;\\n  }\\n.wobble {\\n  animation-name: wobble;\\n  animation-duration: 400ms;\\n}\\n/**\\n * @author Nick Pettit - https://github.com/nickpettit/glide\\n */\\n@keyframes wobble {\\n  from {\\n    transform: translate3d(0, 0, 0);\\n  }\\n\\n  15% {\\n    transform: translate3d(-5%, 0, 0) rotate3d(0, 0, 1, -5deg);\\n  }\\n\\n  30% {\\n    transform: translate3d(2%, 0, 0) rotate3d(0, 0, 1, 3deg);\\n  }\\n\\n  45% {\\n    transform: translate3d(-3%, 0, 0) rotate3d(0, 0, 1, -3deg);\\n  }\\n\\n  60% {\\n    transform: translate3d(2%, 0, 0) rotate3d(0, 0, 1, 2deg);\\n  }\\n\\n  75% {\\n    transform: translate3d(-1%, 0, 0) rotate3d(0, 0, 1, -1deg);\\n  }\\n\\n  to {\\n    transform: translate3d(0, 0, 0);\\n  }\\n}\\n\", \"\"]);\n\n// exports\n"],"sourceRoot":""}